import { Modal, Button, Spinner, Badge, Input, Dropmenu, Option, Icon, Spacing, Tooltip, Separator, Select, Text, Tag, StageSelector, Radio, Checkbox, ButtonGroup, Textarea, Avatar, Dialog, Pill } from '@pipedrive/convention-ui-react';
import { isString, isNil, isNumber, isEmpty as isEmpty$1, trim, isUndefined, replace, isNaN as isNaN$1, trimStart, range, flatMap, omit, noop, defer, isObject, find as find$1, capitalize, isArray, debounce, differenceWith, isEqual, filter, toString, isNull, findIndex, isFunction, sortBy } from 'lodash';
import React, { useContext, useState, useRef, useMemo, useEffect, forwardRef, useCallback } from 'react';
import Formatter from '@pipedrive/formatter';
import getTranslator from '@pipedrive/translator-client/fe';
import awesomeDebouncePromise from 'awesome-debounce-promise';
import classNames from 'classnames';
import Downshift from 'downshift';
import moment$1 from 'moment';
import validate from 'validate.js';
import { get, put } from '@pipedrive/fetch';
import ReactDOM from 'react-dom';
import { extendMoment } from 'moment-range';
import Calendar from 'react-datepicker';
import TagsInput from 'react-tagsinput';
import Linkify from 'react-linkify';

const FormFieldsContext = /*#__PURE__*/React.createContext({
  translator: {
    getLanguage: () => 'en',
    gettext: f => f,
    pgettext: (context, text, replace) => text.replace('%s', replace)
  },
  currencies: [],
  users: [],
  defaultCurrency: 'EUR',
  languageCode: 'en',
  locale: 'en-US',
  formatter: new Formatter()
});

const getCurrencies = userSelf => {
  return userSelf.attributes.currencies;
};

const getUsers = companyUsers => {
  return companyUsers.models.reduce((users, model) => {
    if (model.attributes.active_flag) {
      // @ts-expect-error TODO: Fix discrepancy
      users.push(model.attributes);
    }

    return users;
  }, []);
};

const getDefaultCurrency = userSelf => {
  return userSelf.attributes.default_currency;
};

const getLocale = userSelf => {
  return userSelf.attributes.locale;
};

const getLanguage = userSelf => {
  return userSelf.getLanguage();
};

const getCountryCode = userSelf => {
  return userSelf.attributes.language.country_code;
};

const getPipelines = userSelf => {
  return userSelf.pipelines.map(model => model.attributes);
};

const getStages = userSelf => {
  return userSelf.attributes.stages;
};

const getFields = userSelf => {
  return userSelf.fields;
};

const getLocaleConvention = userSelf => {
  return userSelf.additionalData.locale_convention;
};

const getPhoneSettings = userSelf => {
  var _userSelf$settings, _userSelf$settings$at;

  return {
    user_id: userSelf.id,
    pattern: (_userSelf$settings = userSelf.settings) === null || _userSelf$settings === void 0 ? void 0 : (_userSelf$settings$at = _userSelf$settings.attributes) === null || _userSelf$settings$at === void 0 ? void 0 : _userSelf$settings$at.callto_link_syntax
  };
};
const parseContext = ({
  webappApi,
  ffContextData,
  ...rest
}) => {
  if (ffContextData) {
    return { ...ffContextData
    };
  }

  if (webappApi) {
    const {
      userSelf
    } = webappApi;
    return {
      currencies: getCurrencies(userSelf),
      users: getUsers(webappApi.companyUsers),
      defaultCurrency: getDefaultCurrency(userSelf),
      languageCode: getLanguage(userSelf),
      locale: getLocale(userSelf),
      stages: getStages(userSelf),
      pipelines: getPipelines(userSelf),
      fields: getFields(userSelf),
      formatter: new Formatter(getLocaleConvention(userSelf)),
      phoneSettings: getPhoneSettings(userSelf),
      ...rest
    };
  }

  return {
    formatter: new Formatter(),
    defaultCurrency: 'EUR',
    languageCode: 'en',
    ...rest
  };
};
const getFFContextData = async componentLoader => {
  const userSelf = await componentLoader.load('webapp:user');
  const userLanguage = userSelf.getLanguage();
  const [users, formatter, translator] = await Promise.all([componentLoader.load('webapp:users'), componentLoader.load('froot:formatter'), getTranslator('form-fields', userLanguage)]);
  return {
    translator,
    formatter,
    users: getUsers(users),
    currencies: getCurrencies(userSelf),
    defaultCurrency: getDefaultCurrency(userSelf),
    languageCode: userSelf.getLanguage(),
    countryCode: getCountryCode(userSelf),
    locale: userSelf.attributes.locale,
    stages: getStages(userSelf),
    pipelines: getPipelines(userSelf),
    fields: getFields(userSelf),
    phoneSettings: getPhoneSettings(userSelf)
  };
};

const getSuggestions = autocompleteService => {
  return async value => {
    return new Promise(resolve => {
      const options = {
        input: value
      };

      if (!autocompleteService) {
        return resolve([]);
      }

      autocompleteService.getPlacePredictions(options, suggestsGoogle => {
        if (!suggestsGoogle || !suggestsGoogle.length) {
          return resolve([]);
        }

        return resolve(suggestsGoogle);
      });
    });
  };
};
function loadGoogleMapsAPI(callback, languageCode, countryCode = '') {
  if (window.google) {
    return callback();
  }

  const delimiter = countryCode ? '-' : '';
  const languageString = `${languageCode}${delimiter}${countryCode}`;
  const src = `https://maps.googleapis.com/maps/api/js?language=${languageString}&libraries=places&client=gme-pipedriveinc`;
  const scriptElement = document.querySelector(`[src="${src}"]`);

  if (scriptElement) {
    scriptElement.addEventListener('load', callback);
    return;
  }

  const script = document.createElement('script');
  script.type = 'text/javascript';

  if (script.readyState) {
    script.onreadystatechange = function () {
      if (script.readyState === 'loaded' || script.readyState === 'complete') {
        script.onreadystatechange = null;
        return callback();
      }
    };
  } else {
    script.onload = callback;
  }

  script.src = src;
  document.getElementsByTagName('head')[0].appendChild(script);
  return null;
}

function styleInject(css, ref) {
  if (ref === void 0) ref = {};
  var insertAt = ref.insertAt;

  if (!css || typeof document === 'undefined') {
    return;
  }

  var head = document.head || document.getElementsByTagName('head')[0];
  var style = document.createElement('style');
  style.type = 'text/css';

  if (insertAt === 'top') {
    if (head.firstChild) {
      head.insertBefore(style, head.firstChild);
    } else {
      head.appendChild(style);
    }
  } else {
    head.appendChild(style);
  }

  if (style.styleSheet) {
    style.styleSheet.cssText = css;
  } else {
    style.appendChild(document.createTextNode(css));
  }
}

var css_248z$y = ".ff_v531__Address__map__7rv{\n\twidth:800px;\n\theight:600px;\n}\n\n.ff_v531__Address__footer__2Ik{\n\tdisplay:flex;\n\tflex-direction:row-reverse;\n}\n\n.ff_v531__Address__poweredByGoogle__23O{\n\twidth:144px;\n\theight:18px;\n\tbackground-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAAkCAYAAAApZeciAAARjUlEQVR4Ae2dBXTb2vL1x6GmzJehzBjbKb/YcsrMfJkZyvDS1HbgMTMzM7d9zMzMGCjaTrnxt+e7zvqPpwLLdUpLe62fnFqSZak5W3PmzFHI0/UoT7Nf2t49XJeaY8RT24xY6jXhWPJt+Pn1+Hl3KNa2dE7N8X6Ariwe19XJeHhE6k5OM6KpD4eiidMwnLQVWH/eiCc/F44mDUBXBo/r4iQ8PIxY262Icj7J5uIW7PdZ3h+QBwCBD65YW/GB5ec78H9wxf2ACg0vrmk8PCLRZHUonjri1ngUrdXRxExAHgkKfGjVusCHVqY7qPjQqgcAFRpeXLN4eOBuvdyIJs5e3MVKHcbrq7F+caTuxIjqxrZbquqOD4vUpeYh4mkMxRL/0fuE46kdgMIengHlhwc0ETRmmEvu9ZzYv4SuYnHEEoonzqjczmlONC+qSXcDZMXqmnSZEUs+g/3bXuiGpfYCYjw8A7LFwzOgqppjfWAe/84yn3iqOVzf5geUK5H9yfFIRj8NKIMH8AzIBg/PgHhoXZoPRr4SbCaAPC4dz4A8LPAMiPM5Ou+D3M7dgDwKg2dAHhZ4BoQk6Z6s6CeW+DGl0z5AHoXBMyAPCzwDQu7nJ9kGlLoH0OXmb1VV5S2RyoXNkWBtsxF8c0sk8Ea8bm8OB6ana6gIkCu+RuXnvlK88NyB0tpzB4vfjNc3nj1Ysv3soZK8Pm/qy9u7GvG2ZRj1i4fiyTcit1OH6GaR/83pUkDTG1t7ci4NgOYegDK4NqB/R4L9cd6bWyLBl/J1aDGCdU1GcPk/p07tCsgKyxVQEbgRDAIDgI/cqxzcBAaDG0ERXX0qATeDweAWUEr5qQj0Bj2AL8fj3ZxnIy8S1/UmdV07y4DKwe1gEOhzJadYwIAuZHe/TvQHdLlIrx5T1hwJ7GwO+4+gwaXNaAr7/9hiVK5OE/kA2fIRKjt7oGTnmYOlR84dLE2bU/zH84fKViM48QGyY/VH0sWojXrOqjYqFE3+xYgnZiFy/LnIoX0dUIacDejwvMpeON/XNoeDZ0yvhRFsAQ9YXQdesB7OcCMoBwvBPtAo2A2qc2ygI8BDoF59Ri1YCfoBrfHie0wlawXFdrPJWuPEdn6g1QesBjH1HevAZnALmSugrlcZmAdqxGdsBlr9wFqT48XBRnBjjoY+Xx2L2QcWZtZPKJQBCaO7x+T/8lkwycRsbxXXZzU5SF3PWeQg3MUnZDeoxN8BOTEnevJ2HrZ3AzdkQJL/VPkHtBiB71kZjwZRwNvTVVUlgEz5Gg2AwXwPpHOj+O3YpwSQGRzJoAbqK86Fl4lTMKgTl2JAR6v9d7DR5nYtAm+UJqQNqDHDeLANNNrwvM0dsBisBo0OxMAEIDVArH+arPWUanjFZK7NYrvbTAxyv8N3rLcwwtlim5HgGZN9teGNBlGH49WZ7Kevz3aHz9gKggUyoBgYA+IOx9yg/g+K1Pe8hazlA1v1/5ODAYWzu1/J7wNygosMeXs3cOEioA64O9EUCf7kosYVDqYQAfywJeL/eVPEf06vbzb8bwGkaf8udUWX6yfaZBAJpfD6w3MHin9+5iul50xM6C2ANGyYiGq+bGo20dQv8POf9bp8Dah1+vSeuBa/1+eK6/APXI8DuBa/1uvAHkASXkgDerFofBvBDDAdrAV1YrttoNzkl2k9aBQ8AkJgClgIdot1DWA0kHpWrO9lEUU0KkaaGaEwmJ3qLn2balTPAAMEM69PqM8fa2VAwgwbMvvdAx5TUeIgUKf2CYEgiChDbbA4n+5ghzLw1WAqmA42iAilpkAGVCdMcw9YCCpBFXhYXaM1QGqmWLeSrDVUbPcYILcGhNzGDwA5kJcBherapgDqAF2Jl2Q3KP8p5H+e5FwQIIYjJLz3Kt34YExLAUlgJi+RxgKzOYWu2JOcCwKUYQByQa+6yIQOlC0FJOHCyuxrkzgTrkttkUWZ1ftPDFcmlZcBId/zcnUtmvC6SEY5hw1/Jc7zX6Jbev6wUTkGUAe8kAbE7AQ3A63+YIvYbjmQmqQayDigVQpWie1qQFeLxl0JtF4EGhWrHH6xF8u7s+pizAdFJkY6VWyzB5Tq7yjYYtN9KlYRZTXw6eOp89phEtWtUV2fvkDrZrALNBbCgAQbQRnQmqCMdYzqKu4XvwvlZK6NYv8JgNx2wcLxxD8BOePegMLRE9MBMf+dN2kg7uyn/68xBS80VQcjgMxorg7uUFHSL2XjbP8CDUSkc1pEPRcQDUUAmQFj2qGioF/KfBAnnDPTTzKGkmgPxVILAWmqatIlbEL5GtCxqol9YDgnhbkm8DoCkISNGWb8Snkd8O8PAOqAFyS7HQ4hcz+Rw6gDPUUjkuY02SHsvl9sa8hGJN6/G2g9Lu6WjwsT0w12oficwTLPJN6/zyFZvMrkfLQBRR0SspPFtpscjrdBdYU71Bc0iBya3fFuAQ0FNKCn9LVVmia2fQJILRbrZgCtHsLAdoHiPJPQIHkjIDs4muFowA41ugYSYwAxyOU8ohrSmwBZwaNW3CXLjoIqxgNiMLr1SJahfKX0TYCs4M/jLpmKmMYDAhz9rFbf/d2ArJgdPTWYr2M+BtQaCW5UEd5eaTz/q5oyCDmfxpaw/7BJd/V0c9WYHoAYXpDqzztpsUmUcqPq0jiNmN1qke/xiYghqkZh+oh9XqSihuFA6nnQCPaCIos77hCy151i2/UWBrSc7HW32PZWstdwi6hulorYnLSxgAY0OofRuJ1iexmZ9RNmuMXkdyIk9guRC3HdT/bjNNoeAnSpwKi+JyMINjtAgBvWe7LNJDgNkB3opmyR+7Qa/ocBAY5o3iPNBP+eBsiWQyVb5D4wsYcBMboyHOZSBcgORIXfyseAdFTDxsoGiffn4Zw/i3Nvv3hUMHicu6atc/yjAHXwwkInT50biu7fB1z+0vtEPqhBGc188VkjLPIK/VQ+aIXYTr8vtV0lfeM21ElTlQbk4nrtcXs8HU2ovNogclagQAZUn2OJwEoduQndJdYNVf//20UXrRu5EBrMLtV9+JUesXILPyGRH1ImZsb/FlAHLYb/oGxQGAHqDcgOjJbNz05GB6KAGHS5DkozSR+g3oDsQLdrvtwHRAExMM9PZSXQaxIDANmBfd6clwGFgx9S0WAtXv8E0hpO2qMc4f7/zZ7QHZCGeOEiKtCjVfeY3M0qKTc9JvbpLd6/Xby/RLz/qEnE9LRInhepboE2MBLdR7fskgbkIm/RkOfxtoEOPSTe70POGlogA9qdqx+I400HUkNUF7RDI9RNzJVmxVI3XzQLPpZ4DFC+IILYria2vhJQhqvfgGLJT7utjUKB4psKYEAm+E+1hAPv4iS0Qx1UZqG6Mg66Uf9SqW7CNNJyHk7vKe+OIpm6Hfgy6xtMckYRE/O812aIfr/IpQRcMMHCgMaTverEdwm4QH7u/Sryc9LIAhnQi8lZ+npMMYl0nxYRVS+TEokbgWuxQeihZiPWVgnILTwyxJNZs7p19amJgDqAmbw7y0xm+2cAssWo3JbVBYsEHgLEoNv07qzu1JdLZgCyA/tsy+62lT4EiOHnXavrMQuQPalvuDUgPQKm+FOrEXyeq6IB5QIvpAHNJGdNMBlhmuAiL6KHyWMm+YEl4vMGgmnq3x26Qby/DJSKIfa1No2rAXQh93JrQNtE4yuj/LRS5WScNKuAOaDu5KxNKuLU8qtRwJ6iZOABylPVDUd78wiYGrk6hgrgEKCcwcPKjGjyb/oRrYAkbB7Z3Y7A2wBZkV69urg54v+N3Od/4eBYQAybR3YSuvhtgKxAtXQxXn+TlYQ+VDoWEBOOJzeoc3gbIAtw/U7ewV3OvAzI8K9SEc//msOVcyynixD5rKZk8EIa0OPA5yKxOgaweoj39jpUS+vRqPuB1mCZcBbdkOeA1vNiuHyUqt/RWiHWB8heXUD5JRrQGqeRQaHyDFoVLgYJfODJAhrQDLJXN1ErVGfx/UvAXtGtm60NNV9Vxdqm6ofP88gOktQvzcxxImvSJZy8ltXAGZLh6PGhgCR8V88eeg62c9IVkAW12VMS/D/LGoY/QP0xenVSjGi1Y5RrHiBzSmvVMPzP5DB8pgL6uEyi818FAaTJDMN/Pt9heM7n4PyPyfNjAwJkRiYS/DNyQbMASXih64CCZK0xNvUx94p1S4WRORXVTQJaReKX9hnR/ZoDtOaaFAbGQKnDyNZu0IOstQREwXLQOx8DUvmYnQ4RxXIQBctAL2WEtTrKsFBlgeuAamzyTj5lsBtJy7yrXC/yXD66RIXr2pZkP5pDGEks8S4kWjdF6tqCHOlE6lOT+RGubFAwrn+Y/aUMrF8MyAyYSlxV/Z7hkS6ZYG2ZW3EzVz5fPPzsXwBIAlOJqwroMzzS1f5l6g7o//NFupkrn3l9FoeKFwCS6DwWmzMXJ8pCRDZXmPQXLrUQ0aTOqY3nfPE8OUAA12PaDTxPLMu0jeArpBHrHBBTD0KgRBnCNDVSM1XXoKj1q00a3CBVev+kSB5bRisOZf23mGy3KccIbpvJyFKZGomLgp55GpCuedoC7tDHU3VL+0EPmwLMGAiq61YCQqChEwoRd4Ahyiy6g3VqPttAslYPkykdM6hA4m4XGk0LN6R84UezspkBsiAz+z34fbOkK/g5aoV+ZzYEDV4HSMMVzzCh72tz4YroF2p+in/HkZFej31eB0jDkQ1G7L52sbkkTiLn8zOs+2OhpmKk/f5SFCB+w+Rckxhy/yl3P7lY02k6hp6K8ZiaOPoAuB/UmMz/8eVwB64Hj4F7lfEwexySqiPU9tv1MfWQrkNUJRvPNpM5VHeDh0DU4bOUATmqp4r4mC0Wx2sAEy0iwnvUZ+wF94H71cThxwpkQPuUGW0F94BH1I2GCZCzVqnfrS5UQFW9JHUT/z2wvAwIdUXh/cmxgJw4Pmdqv6ZI4JuqUVljBN7A+SBAZrR/ifqh0PCb0mAceAPngwCZwbkxUxMyMSXZZctzMmpvRIFfc7wGYrhej4rpCGgUWA4aLWgASxweqzFezCmz4jHQ1ylRrRrWQlLSlc8qF+FkCg84fMdabQZ5GhCrF3jY6XgOw/olKiFtxipwZ4EMaBfooyfbKqIOZi81Sg9edIaQFwqEo6n3hqLJlLP5JL8D1rmtIeLZ7Yh4ngVNNkPRv241AosBOcGz21Fo+CyinSZL4/lK8a/PHSxbDMgJjoRwftvAMYtz/zNPM+EJqqLu6Wt5/FWMzLUIPgdaba7Fz2Ha1YA0xAuTBjUIrAPbwT6wBawAt7p4DtBM8ADYAWrBNrABjHbR9x8vqp77k7X6i+0mU27ygRFgLdgKajPG+SgwbPI1d4CZGQYAcnG8kWCdyfHCLorx7gRrwHZQC3aA9aIMoae4FoPIvSrATFApbgSV4EGwF+wDT4O5oCflrnXiJtaPOllohOVcDcwPnIchvYwfyMVD9+FYaifngdT0jbzgbgjPB0OUs4u7WU1G4NX4+ZkWo6JC3+lz4sdUyvPBMNy+i7tZMJ5X4+dnkBuqkAnnXOFKbowUrkAeqB68BdTLB5LBeH5vMfIHA1oexB8nfFMH/o+sngnIij/OG9aF655ADT+cja8H58cwehjU18LpcRyePBVafUXy+W7qXHlKp338Z4cAWTHv1e1d1Aji6wFdbnjR2QbkydNiPSXDU+HFj1hFdPcIulC/5LlhgKzgyCirbqgudS+gyw0WnWZAnjzpWqFngY86RV7Ug5zOH7LqgOLJNYA0s2uSN+D1r2Lbs/weoMsNLzrTgDx5MlSNWSfJE/Jb95kk2t/MU1R4cipPOUHk86j+g46Z/BBdCbDoNAPy5KlUFJTWgFLqVHlREBdfuitDSPxdTVy9rPCiswzIk6cpqiSgc+UpM8Uk9bpczIe7bBwVAbpSYNFpBuTJU28wMEMZebpsCkeTBgoKD+qnRzI8+ZbLEcQUjSsGLwgKZRhInjx5um40s/54X340B08zwZSV6qr6U4Oupr8i+/8Adnj5PFwBRDQAAAAASUVORK5CYII=');\n\tbackground-size:cover;\n}\n";
var styles$w = {
  "map": "ff_v531__Address__map__7rv",
  "footer": "ff_v531__Address__footer__2Ik",
  "poweredByGoogle": "ff_v531__Address__poweredByGoogle__23O"
};
styleInject(css_248z$y);

const AddressRead = ({
  value,
  modalTitle
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    languageCode,
    countryCode
  } = parseContext(useContext(FormFieldsContext));
  const [isVisible, setVisible] = useState(false);
  const mapElRef = useRef(null);

  if (!value) {
    return null;
  }

  const renderMap = address => {
    const GoogleMaps = window.google.maps;
    new GoogleMaps.Geocoder().geocode({
      address
    }, result => {
      if (!result) {
        return;
      }

      const latLng = result[0].geometry.location;
      const map = new GoogleMaps.Map(mapElRef.current, {
        center: latLng,
        zoom: 15,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      });
      const marker = new GoogleMaps.Marker({
        position: latLng
      });
      marker.setMap(map);
    });
  };

  const parseValue = () => {
    if (isString(value)) {
      return value;
    }

    return value === null || value === void 0 ? void 0 : value.description;
  };

  const openModal = async event => {
    setVisible(true);
    event.preventDefault();
    loadGoogleMapsAPI(() => {
      renderMap(parseValue());
    }, languageCode, countryCode);
  };

  const closeModal = () => {
    setVisible(false);
  };

  return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("a", {
    href: "#",
    onClick: openModal,
    "data-testid": "addressLink"
  }, parseValue()), /*#__PURE__*/React.createElement(Modal, {
    backdrop: false,
    closeOnEsc: true,
    visible: isVisible,
    header: modalTitle || translator.gettext('Address'),
    onClose: closeModal,
    footer: /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement(Button, {
      color: "green",
      onClick: closeModal
    }, translator.gettext('Close'))))
  }, /*#__PURE__*/React.createElement("div", {
    ref: mapElRef,
    className: styles$w.map
  })));
};

const InputIcon = ({
  isLoading,
  isNew,
  actionIcon,
  disableNewLabel
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));

  if (isLoading) {
    return /*#__PURE__*/React.createElement(Spinner, {
      size: "s",
      "data-testid": "spinner"
    });
  }

  if (actionIcon) {
    return actionIcon;
  }

  if (isNew && !disableNewLabel) {
    return /*#__PURE__*/React.createElement(Badge, {
      color: "blue"
    }, translator.gettext('new'));
  }

  return null;
};

var css_248z$x = ".ff_v531__InputSelect__wrapper__3As{\n\tdisplay:flex;\n\tposition:relative;\n}\n.ff_v531__InputSelect__suggestion__1y6{\n\tdisplay:flex;\n\talign-items:center;\n\twhite-space:pre;\n}\n.ff_v531__InputSelect__suggestion__1y6 span{\n\t\tdisplay:block;\n\t\toverflow:hidden;\n\t\twhite-space:nowrap;\n\t\ttext-overflow:ellipsis;\n\t}\n.ff_v531__InputSelect__suggestionIcon__3bT{\n\tmargin-right:10px;\n}\n.ff_v531__InputSelect__highlight__3rw{\n\tbackground-color:#fff570;\n\tcolor:#26292c;\n}\n.ff_v531__InputSelect__noMatchFound__1Gv{\n\tpointer-events:none;\n}\n.ff_v531__InputSelect__noMatchFound__1Gv span{\n\t\tcolor:#747678;\n\t}\n.ff_v531__InputSelect__input__2jq{\n\twidth:100%;\n\tflex:1;\n}\n.ff_v531__InputSelect__popover__bUo{\n\tz-index:6001;\n}\n.ff_v531__InputSelect__popover__bUo .cui4-popover__inner{\n\t\tmax-width:none;\n\t}\n.ff_v531__InputSelect__content__1mH{\n\tposition:absolute;\n\tright:0;\n\tdisplay:flex;\n\talign-items:center;\n\tpadding:0 10px;\n\ttext-transform:uppercase;\n\theight:32px;\n}\n.ff_v531__InputSelect__defaultSuggestions__PUG{\n\tmax-height:416px;\n}\n.ff_v531__InputSelect__popverRoot__jrA{\n\twidth:100%;\n}\n.ff_v531__InputSelect__warning__2f3{\n\tdisplay:flex;\n\talign-items:center;\n\tmargin-top:4px;\n\tfont:400 13px/16px 'Source Sans Pro',sans-serif;\n}\n.ff_v531__InputSelect__warning__2f3 .ff_v531__InputSelect__warningLink__1l2{\n\t\tpadding-left:8px;\n\t}\n.ff_v531__InputSelect__warning__2f3 .ff_v531__InputSelect__warningIcon__1_v{\n\t\tmargin-right:8px;\n\t}\n";
var styles$v = {
  "wrapper": "ff_v531__InputSelect__wrapper__3As",
  "suggestion": "ff_v531__InputSelect__suggestion__1y6",
  "suggestionIcon": "ff_v531__InputSelect__suggestionIcon__3bT",
  "highlight": "ff_v531__InputSelect__highlight__3rw",
  "noMatchFound": "ff_v531__InputSelect__noMatchFound__1Gv",
  "input": "ff_v531__InputSelect__input__2jq",
  "popover": "ff_v531__InputSelect__popover__bUo",
  "content": "ff_v531__InputSelect__content__1mH",
  "defaultSuggestions": "ff_v531__InputSelect__defaultSuggestions__PUG",
  "popverRoot": "ff_v531__InputSelect__popverRoot__jrA",
  "warning": "ff_v531__InputSelect__warning__2f3",
  "warningLink": "ff_v531__InputSelect__warningLink__1l2",
  "warningIcon": "ff_v531__InputSelect__warningIcon__1_v"
};
styleInject(css_248z$x);

const getPadding = (element, allowClear) => {
  let finalPadding = allowClear ? 26 : 12;

  if (element) {
    finalPadding = element.offsetWidth;

    if (allowClear) {
      finalPadding += 16;
    }
  }

  return finalPadding;
};
const parseValue = (value, getSuggestionValue) => {
  if (typeof value === 'string') {
    return value;
  }

  if (!value || !getSuggestionValue) {
    return '';
  }

  return getSuggestionValue(value);
};

/**
 * A component used in Deal, Person, Organization, Address and Autocomplete fields.
 * Displays the values returned from getSuggestions function as Select options.
 * Typically performs a request to /search endpoint, but can also be used as a generic Autocomplete field.
 *
 * @template T - Type of the suggestion
 * @param {InputSelectProps<T>} props - Props for InputSelect
 * @returns {React.ReactElement<DownshiftProps<T>, string>} Downshift component
 */

function InputSelect({
  allowNewItem = true,
  showNewLabel = false,
  disableNewLabel = false,
  alwaysGetSuggestions = false,
  getSuggestions = inputValue => Promise.resolve(null),
  getSuggestionValue = suggestion => suggestion,
  isNewValue,
  renderSuggestions,
  className,
  portalTo,
  placement = 'bottom-start',
  disabled,
  suggestionIcon,
  getSuggestionIcon = _ => suggestionIcon || '',
  value = '',
  dropdownTrigger = 0,
  onComponentChange = () => null,
  searchDelay = 350,
  inputProps = {},
  dropmenuProps = {},
  downshiftProps = {},
  actionIcon,
  allowClear,
  placeholder,
  autosuggest = true,
  suggestions,
  initialSuggestions
}) {
  const inputRef = useRef(null);
  const iconRef = useRef(null);
  const {
    translator
  } = parseContext(React.useContext(FormFieldsContext));
  const [isLoading, setIsLoading] = useState(false);
  const [selected, setSelected] = useState(false);
  const [isNew, setIsNew] = useState(showNewLabel);
  const [inputValueState, setInputValue] = useState();
  const [internalStateSuggestions, setSuggestions] = useState(initialSuggestions || null);

  const onSelect = selectedItem => {
    setSelected(true);

    if (onComponentChange && selectedItem) {
      setIsNew((isNewValue === null || isNewValue === void 0 ? void 0 : isNewValue(selectedItem)) || false);
      onComponentChange(selectedItem);
    }
  };

  function resetSuggestions() {
    if (initialSuggestions) {
      setSuggestions(initialSuggestions);
    } else {
      setSuggestions(null);
    }
  }

  const onUserAction = ({
    isOpen,
    type
  }) => {
    const {
      mouseUp,
      keyDownEscape,
      keyDownEnter
    } = Downshift.stateChangeTypes;
    const isOuterClickEvent = mouseUp === type || keyDownEscape === type || keyDownEnter === type;

    if (!isOpen && isOuterClickEvent && !disableNewLabel && allowNewItem && autosuggest) {
      resetSuggestions();

      if (isNewValue && isNewValue(value)) {
        setIsNew(true);
      }
    }
  };

  const onInputValueChange = async (inputValue, {
    isOpen,
    selectedItem
  }) => {
    if (!inputValue) {
      setIsNew(false);
      resetSuggestions();
      return;
    }

    if (!autosuggest || !isOpen && !alwaysGetSuggestions || dropdownTrigger > inputValue.length || isLoading || selectedItem && getSuggestionValue(selectedItem) === inputValue) {
      setSuggestions(null);
      return;
    }

    setSelected(false);
    setIsLoading(true);

    try {
      const results = await getSuggestions(inputValue);
      setIsLoading(false);
      setSuggestions(results);
    } catch (error) {
      setIsLoading(false);
    }
  };

  const onInputValueChangeDebounced = useMemo(() => awesomeDebouncePromise(onInputValueChange, searchDelay), [onInputValueChange]);

  const onInputValueChangeHandler = (inputValue, controllerState) => {
    setInputValue(inputValue);

    if (autosuggest && (!suggestions || alwaysGetSuggestions)) {
      onInputValueChangeDebounced(inputValue, controllerState);
    }
  };

  const itemToString = item => {
    if (!item) {
      return '';
    }

    return getSuggestionValue(item);
  }; // eslint-disable-next-line new-cap


  const IconComponent = InputIcon({
    isLoading,
    isNew,
    actionIcon,
    disableNewLabel
  });
  const [padding, setPadding] = useState();
  useEffect(() => {
    if (!iconRef || !iconRef.current) {
      setPadding(0);
      return;
    }

    const finalPadding = getPadding(iconRef.current, allowClear);
    setPadding(finalPadding);
  }, [IconComponent]);
  useEffect(() => {
    if (isNil(value) || isNewValue && !isNewValue(value)) {
      setIsNew(false);
    }

    if (!selected) {
      setInputValue(value);
    }
  }, [value]);

  const renderInput = ({
    getInputProps,
    inputValue,
    highlightedIndex,
    setState
  }) => {
    const {
      ref,
      onKeyDown,
      ...restDownshiftInputProps
    } = getInputProps();
    const {
      className: inputClassName,
      message,
      ...restCuiInputProps
    } = inputProps;

    const handleEnterOrEnterKeyPress = () => {
      setState({
        type: Downshift.stateChangeTypes.keyDownEscape
      });
    };

    return /*#__PURE__*/React.createElement("div", {
      className: classNames(className, 'cui4-input__box')
    }, /*#__PURE__*/React.createElement("div", {
      className: classNames('cui4-input', styles$v.input, inputClassName)
    }, /*#__PURE__*/React.createElement("div", {
      className: styles$v.wrapper
    }, /*#__PURE__*/React.createElement(Input, {
      forwardRef: inputRef,
      className: classNames(inputClassName, styles$v.input),
      style: {
        paddingRight: padding
      },
      inputRef: ref,
      allowClear: allowClear,
      disabled: disabled,
      color: message ? 'red' : undefined,
      message: message,
      placeholder: placeholder,
      onKeyDown: event => {
        onKeyDown(event);

        if (event.key === 'Enter' || event.key === 'Tab') {
          handleEnterOrEnterKeyPress();
          return;
        }
      },
      ...restDownshiftInputProps,
      ...restCuiInputProps
    }), IconComponent && /*#__PURE__*/React.createElement("div", {
      className: styles$v.content,
      ref: iconRef,
      style: {
        right: allowClear && IconComponent ? '18px' : '0'
      }
    }, IconComponent))));
  };

  const renderDefaultSuggestions = (getItemProps, highlightedIndex) => {
    const suggestionsList = suggestions || internalStateSuggestions;
    return /*#__PURE__*/React.createElement("div", {
      className: styles$v.defaultSuggestions
    }, (suggestionsList || []).map((item, index) => /*#__PURE__*/React.createElement("div", { ...getItemProps({
        item,
        index
      }),
      key: `${item}${index}`
    }, /*#__PURE__*/React.createElement(Option, {
      "data-testid": "option",
      highlighted: highlightedIndex === index,
      className: classNames(styles$v.suggestion)
    }, suggestionIcon && /*#__PURE__*/React.createElement(Icon, {
      icon: getSuggestionIcon(item),
      size: "s",
      color: "black-64",
      className: styles$v.suggestionIcon
    }), getSuggestionValue(item)))), (suggestionsList === null || suggestionsList === void 0 ? void 0 : suggestionsList.length) === 0 && /*#__PURE__*/React.createElement(Option, {
      className: styles$v.noMatchFound,
      manualHighlight: true
    }, translator.gettext('No match found')));
  };

  const renderDropMenu = ({
    isOpen,
    highlightedIndex,
    getItemProps,
    inputValue,
    setHighlightedIndex
  }, children) => {
    if (!autosuggest) {
      return children;
    }

    const width = inputRef.current ? inputRef.current.clientWidth : 'auto';
    const suggestionsList = suggestions || internalStateSuggestions;
    const renderDropmenuSuggestions = renderSuggestions ? renderSuggestions(suggestionsList || []) : renderDefaultSuggestions;
    const isVisible = isOpen && inputValue.length >= dropdownTrigger && !!(suggestionsList !== null && suggestionsList !== void 0 && suggestionsList.length);
    return /*#__PURE__*/React.createElement(Dropmenu, {
      content: /*#__PURE__*/React.createElement("div", {
        style: {
          width
        }
      }, isOpen && renderDropmenuSuggestions(getItemProps, highlightedIndex, setHighlightedIndex, inputValue || '')),
      popoverProps: {
        className: styles$v.popover,
        portalTo,
        placement,
        spacing: 'none',
        visible: isVisible
      },
      ...dropmenuProps
    }, children);
  };

  const stateReducer = ({
    inputValue
  }, changes) => {
    var _changes$inputValue;

    switch (changes.type) {
      case Downshift.stateChangeTypes.changeInput:
        onComponentChange(changes.inputValue);
        return { ...changes,
          // Hide dropdown, if all written text was deleted
          isOpen: !!((_changes$inputValue = changes.inputValue) !== null && _changes$inputValue !== void 0 && _changes$inputValue.length)
        };

      case Downshift.stateChangeTypes.mouseUp:
      case Downshift.stateChangeTypes.keyDownEnter:
      case Downshift.stateChangeTypes.keyDownEscape:
        if (!allowNewItem) {
          return { ...changes,
            inputValue: ''
          };
        }

        return { ...changes,
          // Give current input written value back to show it in input
          inputValue,
          isOpen: false
        };

      default:
        return changes;
    }
  };

  return /*#__PURE__*/React.createElement(Downshift, {
    inputValue: parseValue(inputValueState, getSuggestionValue),
    onInputValueChange: onInputValueChangeHandler,
    itemToString: itemToString,
    onSelect: onSelect,
    onUserAction: onUserAction,
    stateReducer: stateReducer,
    ...downshiftProps
  }, state => {
    const {
      onKeyDown
    } = state.getInputProps();
    return /*#__PURE__*/React.createElement("div", {
      onKeyDown: onKeyDown
    }, renderDropMenu(state, renderInput(state)));
  });
}

const popperProps = {
  modifiers: {
    preventOverflow: {
      escapeWithReference: true
    }
  }
}; // eslint-disable-next-line complexity

const isEmpty = wrapperValue => {
  if (isNumber(wrapperValue)) {
    return false;
  }

  if (wrapperValue !== 0 && isEmpty$1(wrapperValue) || isNil(wrapperValue)) {
    return true;
  }

  if (wrapperValue.label && wrapperValue.id) {
    return isEmpty$1(wrapperValue.id.toString());
  }

  if (wrapperValue.label !== undefined && wrapperValue.value !== undefined) {
    return isEmpty$1(wrapperValue.label) && isEmpty$1(wrapperValue.value);
  } // Empty check for the label field and compound field


  if (wrapperValue.label) {
    return isEmpty$1(wrapperValue.value.toString());
  } // Empty check for single the value fields


  return isEmpty$1(wrapperValue.toString());
};
const createBccLink = bcc => {
  return bcc ? `?bcc=${encodeURIComponent(bcc)}` : '';
};
const formatTextArea = inputValue => {
  let val = trim(inputValue);
  val = val.replace(/\n\s*\n/g, '\n\n');
  val = val.replace(/\n\s/g, '\n');
  val = val.replace(/\t/g, '');
  return val;
};
const localeMomentFormat = (locale, format) => {
  return moment$1().locale(locale || 'en-GB').creationData().locale.longDateFormat(format);
};

const getFormattedPhoneData = (settings, apiSettings) => {
  if (typeof (settings === null || settings === void 0 ? void 0 : settings.pattern) === 'string') {
    return settings.pattern;
  }

  if (typeof (apiSettings === null || apiSettings === void 0 ? void 0 : apiSettings.pattern) === 'string') {
    return apiSettings.pattern;
  }

  return 'skype:[number]?chat';
};

const createPhoneLink = (phone, propsSettings, apiSettings) => {
  if (!isString(phone)) {
    return '';
  }

  let formatted = getFormattedPhoneData(propsSettings, apiSettings);
  const cleanPhone = phone.replace(/(\s)/g, '');
  /*
      [number] -> the phone number value in the field
      [user_id] -> the id of the logged in user
      [deal_id] -> the deal id of the deal the user is on (if possible)
      [person_id] -> the id of the person the number is linked to (if possible)
      [org_id] -> the id of the organization the number is linked to (if possible)
  */

  formatted = formatted.split('[number]').join(cleanPhone); // other optional fields replaced with blank if no data provided
  // user_id can be found in user_self, other values need to be provided in `settings` prop

  formatted = formatted.split('[user_id]').join(String(apiSettings === null || apiSettings === void 0 ? void 0 : apiSettings.user_id));
  formatted = formatted.split('[deal_id]').join(String((propsSettings === null || propsSettings === void 0 ? void 0 : propsSettings.deal_id) || ''));
  formatted = formatted.split('[person_id]').join(String((propsSettings === null || propsSettings === void 0 ? void 0 : propsSettings.person_id) || ''));
  formatted = formatted.split('[org_id]').join(String((propsSettings === null || propsSettings === void 0 ? void 0 : propsSettings.org_id) || '')); // This prevents basic XSS when used like this (creates link with executable JS on click):
  //  href={createPhoneLink( ... )}

  return formatted.replace(/^(javascript|data):.*/, '');
}; // formatPhoneNumber converts 10 digit long phone numbers to US phone number format
// if user has "en_US" locale and "format_phone_numbers_enabled" setting is turned on.
// It has similar purpose as "format_visible_phone_nr" helper method in back-end.

const formatPhoneNumber = (phone, locale, format) => {
  if (format && locale === 'en-US') {
    if (phone.startsWith('+1')) {
      return `+1 ${phone.slice(2).trim().replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3')}`;
    }

    return phone.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
  }

  return phone;
};
const stringifyUserName = val => () => val || '';
const findUserById = (id, users) => users.find(user => user.id === id);
const initOptions = (fields, options, fieldType, fieldKey) => {
  if (options !== null && options !== void 0 && options.length) {
    return options;
  }

  if (fields && fieldType && fieldKey) {
    var _fields$attributes$fi, _fields$attributes$fi2;

    return ((_fields$attributes$fi = fields.attributes[fieldType]) === null || _fields$attributes$fi === void 0 ? void 0 : (_fields$attributes$fi2 = _fields$attributes$fi.find(field => field.key === fieldKey)) === null || _fields$attributes$fi2 === void 0 ? void 0 : _fields$attributes$fi2.options) || [];
  }

  return [];
};
const getValue$3 = ({
  value,
  defaultValue,
  callback = f => f,
  defaultReturn = {
    defaultValue: ''
  }
}) => {
  if (!isUndefined(value)) {
    return {
      value: callback(value)
    };
  }

  if (!isUndefined(defaultValue)) {
    return {
      defaultValue: callback(defaultValue)
    };
  }

  return defaultReturn;
};

const useValidation = translator => {
  const tooLong = `^${translator.gettext('Input can be maximum 255 characters long')}`;
  return {
    getValidation: ({
      value,
      custom
    }) => {
      const trimmedValues = trim(String(value));
      const constraints = {
        defaultValidation: {
          presence: {
            allowEmpty: true
          },
          length: {
            maximum: 255,
            message: tooLong
          }
        }
      };
      return validate({
        defaultValidation: trimmedValues
      }, custom || constraints);
    },
    getEmailValidation: ({
      value,
      custom
    }) => {
      const trimmedValues = trim(String(value));
      const constraints = {
        email: {
          presence: {
            allowEmpty: true
          },
          email: {
            message: `^${translator.gettext('Email is not valid')}`
          },
          length: {
            maximum: 255,
            message: tooLong
          }
        }
      };
      return validate({
        email: trimmedValues
      }, custom || constraints);
    },
    getNumberValidation: ({
      value,
      custom,
      monetary,
      formatter
    }) => {
      let trimmedValues = value;
      const constraints = {
        number: {
          presence: {
            allowEmpty: true
          },
          numericality: {
            message: `^${translator.gettext('Input is not a number')}`
          }
        }
      };

      if (formatter) {
        let validateValue = value.toString(); // @ts-expect-error TODO: fix to use `getLocaleConvention` but type definitions are not provided

        const {
          thousands_sep,
          decimal_point
        } = formatter.localeConvention;
        validateValue = validateValue.replace(/\s/g, '');
        validateValue = replace(validateValue, new RegExp(thousands_sep, 'g'), '');
        validateValue = replace(validateValue, decimal_point, '.');
        trimmedValues = isNaN$1(Number(validateValue)) ? value : // @ts-expect-error TODO: library defines as `Number` requirement but takes also `String`
        formatter === null || formatter === void 0 ? void 0 : formatter.unformat(value, monetary);
        return validate({
          number: trimmedValues
        }, custom || constraints);
      }

      return validate({
        number: value
      }, custom || constraints);
    },
    getDurationValidation: ({
      value,
      custom
    }) => {
      const constraints = {
        duration: {
          presence: {
            allowEmpty: true
          },
          format: {
            pattern: '\\d*:\\d*$',
            message: `^${translator.gettext('Input is not a valid duration time')}`
          }
        }
      };
      return validate({
        duration: value
      }, custom || constraints);
    },
    getPercentageValidation: ({
      value,
      custom
    }) => {
      const trimmedValues = Number(trimStart(value));
      const constraints = {
        percentage: {
          presence: {
            allowEmpty: true
          },
          numericality: {
            strict: true,
            greaterThanOrEqualTo: 0,
            lessThanOrEqualTo: 100,
            message: `^${translator.gettext('Input must be an integer between 0 and 100')}`
          }
        }
      };
      return validate({
        percentage: trimmedValues
      }, custom || constraints);
    },
    getTextAreaValidation: ({
      value,
      custom
    }) => {
      const formattedText = formatTextArea(value);
      const trimmedValues = trimStart(formattedText);
      const constraints = {
        textarea: {
          presence: {
            allowEmpty: true
          },
          length: {
            maximum: 65535,
            message: `^${translator.gettext('Input can be maximum 65 535 characters long')}`
          }
        }
      };
      return validate({
        textarea: trimmedValues
      }, custom || constraints);
    },
    handleValidation: ({
      formValue,
      validate: validateCallback,
      data,
      customValidation,
      formatter,
      monetary
    }) => {
      const isString = e => typeof e === 'string';

      const isEvent = e => typeof e === 'object' && !!e.currentTarget;

      const getValue = val => {
        if (isString(val)) {
          return val;
        }

        if (isEvent(val)) {
          return val.currentTarget.value;
        }

        return;
      };

      const value = getValue(formValue);

      if (!value) {
        return;
      }

      const validation = validateCallback({
        translator,
        data,
        value,
        custom: customValidation,
        formatter,
        monetary
      });
      const error = validation ? validation[Object.keys(validation)[0]][0] : '';
      return error;
    }
  };
};

const AddressFooter = () => {
  return /*#__PURE__*/React.createElement(Spacing, {
    all: "m",
    className: styles$w.footer
  }, /*#__PURE__*/React.createElement("div", {
    className: styles$w.poweredByGoogle
  }));
};

const Address = ({
  actionIcon,
  portalTo,
  disabled = false,
  onComponentChange,
  onValidation,
  error,
  value,
  ...restProps
}) => {
  const {
    translator,
    languageCode,
    countryCode
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState('');
  const [autocompleteService, setAutocompleteService] = useState(null);

  const googleCallback = () => {
    setAutocompleteService(new window.google.maps.places.AutocompleteService());
  };

  useEffect(() => {
    loadGoogleMapsAPI(googleCallback, languageCode, countryCode);
  }, []);

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const getSuggestionValue = suggestion => {
    if (typeof suggestion === 'string') {
      return suggestion;
    }

    return suggestion.description;
  };

  const getGeocodedData = suggestion => {
    if (typeof suggestion === 'string' || !window.google.maps) {
      return onComponentChange(suggestion);
    }

    new window.google.maps.Geocoder().geocode({
      address: suggestion.description
    }, (result, status) => {
      if (status !== google.maps.GeocoderStatus.OK) {
        return onComponentChange(suggestion);
      }

      return onComponentChange({ ...suggestion,
        geocoded: result
      });
    });
  };

  if (!autocompleteService) {
    return /*#__PURE__*/React.createElement(React.Fragment, null);
  }

  return /*#__PURE__*/React.createElement(InputSelect, {
    getSuggestionValue: getSuggestionValue,
    getSuggestions: getSuggestions(autocompleteService),
    dropdownTrigger: 2,
    inputProps: {
      onBlur: validate,
      message: error || validationError,
      autoComplete: 'new-street-address'
    },
    value: value,
    dropmenuProps: {
      footer: /*#__PURE__*/React.createElement(AddressFooter, null)
    },
    suggestionIcon: "address",
    portalTo: portalTo,
    disableNewLabel: true,
    onComponentChange: getGeocodedData,
    actionIcon: actionIcon,
    disabled: disabled,
    ...restProps,
    allowNewItem: true
  });
};

const AutocompleteRead = ({
  value
}) => {
  if (!value) {
    return null;
  }

  if (typeof value === 'string') {
    return value;
  }

  return /*#__PURE__*/React.createElement(React.Fragment, null, value.title);
};

const MANDATORY_SEARCH_TERM_ERROR = 'Search term must be provided';
var DataTypes;

(function (DataTypes) {
  DataTypes["org"] = "organizations";
  DataTypes["person"] = "persons";
  DataTypes["deal"] = "deals";
})(DataTypes || (DataTypes = {}));

var FieldDataTypes;

(function (FieldDataTypes) {
  FieldDataTypes["org"] = "organizationField";
  FieldDataTypes["person"] = "personField";
  FieldDataTypes["deal"] = "dealField";
})(FieldDataTypes || (FieldDataTypes = {}));

var FieldTypes;

(function (FieldTypes) {
  FieldTypes["org"] = "organization";
  FieldTypes["person"] = "person";
  FieldTypes["deal"] = "deal";
})(FieldTypes || (FieldTypes = {}));

async function find(type, term, limit = 100) {
  if (!term) {
    throw new Error(MANDATORY_SEARCH_TERM_ERROR);
  }

  const {
    data
  } = await get(`/api/v1/${type}/search?fields=${type === 'deals' ? 'title' : 'name'}`, {
    queryParams: {
      term,
      limit: String(limit)
    }
  });
  return data || [];
}
async function searchResults(fieldType, fieldKey, term, limit = 100) {
  if (!term) {
    throw new Error(MANDATORY_SEARCH_TERM_ERROR);
  }

  if (!fieldType) {
    throw new Error('Field type term must be provided');
  }

  if (!fieldKey) {
    throw new Error('Field key term must be provided');
  }

  const {
    data
  } = await get('/v1/itemSearch/field', {
    queryParams: {
      term,
      limit: String(limit),
      fieldType,
      fieldKey
    }
  });
  return data || [];
}
async function itemSearch(itemTypes, fields, term, limit = 100) {
  if (!term) {
    throw new Error(MANDATORY_SEARCH_TERM_ERROR);
  }

  if (!itemTypes) {
    throw new Error('Field itemTypes must be provided');
  }

  if (!fields) {
    throw new Error('Field fields term must be provided');
  }

  const {
    data
  } = await get('/v1/itemSearch', {
    queryParams: {
      term,
      limit: String(limit),
      itemTypes: itemTypes.join(','),
      fields: fields.join(',')
    }
  });
  return data.items || [];
}
async function updateCategory(fieldId, propOptions) {
  const res = await put(`/api/v1/productFields/${fieldId}`, {
    field_type: 'enum',
    options: propOptions
  });
  const {
    options
  } = res.data;
  return options || [];
}
async function getCategoryOptions(fieldId) {
  const res = await get(`/api/v1/productFields/${fieldId}`);
  const {
    options
  } = res.data;
  return options || [];
}

const Autocomplete = ({
  fieldType,
  fieldKey,
  error,
  value,
  onValidation,
  ...restProps
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState('');

  const getSuggestions = val => {
    const type = `${fieldType}Field`;
    return searchResults(type, fieldKey, val);
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const getSuggestion = suggest => {
    if (typeof suggest === 'string') {
      return suggest;
    }

    return suggest[fieldKey];
  };

  return /*#__PURE__*/React.createElement(InputSelect, { ...getValue$3({
      value
    }),
    getSuggestionValue: getSuggestion,
    getSuggestions: getSuggestions,
    dropdownTrigger: 2,
    allowNewItem: true,
    inputProps: {
      onBlur: validate,
      message: error || validationError
    },
    ...restProps
  });
};

const DATE_FORMAT$1 = 'YYYY-MM-DD';
const replaceSeparator = format => separator => {
  return format.replace(/[.\-/]/g, separator);
};
const getAllSeparators = format => {
  const separators = ['.', '/', '-'];
  return separators.map(replaceSeparator(format));
};
const getMoment = (date, format) => {
  if (!date || typeof date !== 'string') {
    return undefined;
  }

  const defaultFormat = moment$1(date, DATE_FORMAT$1); // SQL date format

  if (defaultFormat.isValid()) {
    return defaultFormat;
  }

  return undefined;
};
const formatDate = date => {
  if (moment$1.isMoment(date)) {
    return date.locale('en').format(DATE_FORMAT$1).toString();
  }

  return '';
};
const renderPopperContainer = ({
  children,
  element
}) => {
  return /*#__PURE__*/ReactDOM.createPortal(children, typeof element === 'boolean' ? document.body : element);
};
const renderPopperAttribute = portalTo => {
  if (!portalTo) {
    return null;
  }

  return {
    popperContainer: ({
      children
    }) => renderPopperContainer({
      children,
      element: portalTo
    })
  };
};
const parseSelectedDate = (selectedDate, format) => {
  if (moment$1.isMoment(selectedDate)) {
    return moment$1(selectedDate).format(format);
  }

  return '';
};
const getDateRangeProps = minEndDate => {
  return minEndDate ? {
    minDate: minEndDate
  } : null;
};
const getInitDate = value => {
  return value ? moment$1(new Date(value)) : undefined;
};

const moment = extendMoment(moment$1);
const setInterval = (startDate, endDate) => {
  if (!startDate || !endDate) {
    return undefined;
  }

  const interval = endDate.diff(startDate, 'days');
  return interval;
};
const substractOneMonth = startDate => {
  if (!startDate) {
    return [];
  }

  const beginingOfCurrentMonth = moment(startDate).startOf('month');
  const range = moment.range(beginingOfCurrentMonth, startDate);
  return Array.from(range.by('day', {
    excludeEnd: true
  }));
};
const getDateReadValue = (startDate, endDate) => {
  const defaultValueIndicator = '...';
  return `${startDate ? startDate : defaultValueIndicator} - ${endDate ? endDate : defaultValueIndicator}`;
};
const getAllowClearValues = (allowClear = undefined, allowClearStart = undefined, allowClearEnd = undefined) => {
  const allowClearStartValue = allowClear === undefined ? allowClearStart : allowClear;
  const allowClearEndValue = allowClear === undefined ? allowClearEnd : allowClear;
  return {
    allowClearStartValue,
    allowClearEndValue
  };
};

const DateRangeRead = ({
  value
}) => {
  var _getMoment, _getMoment2;

  const {
    locale
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  const {
    startDate,
    endDate
  } = value;
  const format = localeMomentFormat(locale, 'LL');
  const localeStartDate = (_getMoment = getMoment(startDate)) === null || _getMoment === void 0 ? void 0 : _getMoment.format(format);
  const localeEndDate = (_getMoment2 = getMoment(endDate)) === null || _getMoment2 === void 0 ? void 0 : _getMoment2.format(format);
  return /*#__PURE__*/React.createElement(React.Fragment, null, getDateReadValue(localeStartDate, localeEndDate));
};

var css_248z$w = ".react-datepicker-popper[data-placement^=\"bottom\"] .react-datepicker__triangle, .react-datepicker-popper[data-placement^=\"top\"] .react-datepicker__triangle, .react-datepicker__year-read-view--down-arrow, .react-datepicker__month-read-view--down-arrow, .react-datepicker__month-year-read-view--down-arrow{margin-left:-8px;position:absolute}.react-datepicker-popper[data-placement^=\"bottom\"] .react-datepicker__triangle, .react-datepicker-popper[data-placement^=\"top\"] .react-datepicker__triangle, .react-datepicker__year-read-view--down-arrow, .react-datepicker__month-read-view--down-arrow, .react-datepicker__month-year-read-view--down-arrow, .react-datepicker-popper[data-placement^=\"bottom\"] .react-datepicker__triangle::before, .react-datepicker-popper[data-placement^=\"top\"] .react-datepicker__triangle::before, .react-datepicker__year-read-view--down-arrow::before, .react-datepicker__month-read-view--down-arrow::before, .react-datepicker__month-year-read-view--down-arrow::before{box-sizing:content-box;position:absolute;border:8px solid transparent;height:0;width:1px}.react-datepicker-popper[data-placement^=\"bottom\"] .react-datepicker__triangle::before, .react-datepicker-popper[data-placement^=\"top\"] .react-datepicker__triangle::before, .react-datepicker__year-read-view--down-arrow::before, .react-datepicker__month-read-view--down-arrow::before, .react-datepicker__month-year-read-view--down-arrow::before{content:\"\";z-index:-1;border-width:8px;left:-8px;border-bottom-color:#aeaeae}.react-datepicker-popper[data-placement^=\"bottom\"] .react-datepicker__triangle{top:0;margin-top:-8px}.react-datepicker-popper[data-placement^=\"bottom\"] .react-datepicker__triangle, .react-datepicker-popper[data-placement^=\"bottom\"] .react-datepicker__triangle::before{border-top:none;border-bottom-color:#f0f0f0}.react-datepicker-popper[data-placement^=\"bottom\"] .react-datepicker__triangle::before{top:-1px;border-bottom-color:#aeaeae}.react-datepicker-popper[data-placement^=\"top\"] .react-datepicker__triangle, .react-datepicker__year-read-view--down-arrow, .react-datepicker__month-read-view--down-arrow, .react-datepicker__month-year-read-view--down-arrow{bottom:0;margin-bottom:-8px}.react-datepicker-popper[data-placement^=\"top\"] .react-datepicker__triangle, .react-datepicker__year-read-view--down-arrow, .react-datepicker__month-read-view--down-arrow, .react-datepicker__month-year-read-view--down-arrow, .react-datepicker-popper[data-placement^=\"top\"] .react-datepicker__triangle::before, .react-datepicker__year-read-view--down-arrow::before, .react-datepicker__month-read-view--down-arrow::before, .react-datepicker__month-year-read-view--down-arrow::before{border-bottom:none;border-top-color:#fff}.react-datepicker-popper[data-placement^=\"top\"] .react-datepicker__triangle::before, .react-datepicker__year-read-view--down-arrow::before, .react-datepicker__month-read-view--down-arrow::before, .react-datepicker__month-year-read-view--down-arrow::before{bottom:-1px;border-top-color:#aeaeae}.react-datepicker-wrapper, .react-datepicker{display:inline-block}.react-datepicker{font-family:\"Helvetica Neue\",Helvetica,Arial,sans-serif;font-size:.8rem;background-color:#fff;color:#000;border:1px solid #aeaeae;border-radius:.3rem;position:relative}.react-datepicker--time-only .react-datepicker__triangle{left:35px}.react-datepicker--time-only .react-datepicker__time-container{border-left:0}.react-datepicker--time-only .react-datepicker__time, .react-datepicker--time-only .react-datepicker__time-box{border-radius:0.3rem}.react-datepicker__triangle{position:absolute;left:50px}.react-datepicker-popper{z-index:1}.react-datepicker-popper[data-placement^=\"bottom\"]{margin-top:10px}.react-datepicker-popper[data-placement^=\"top\"]{margin-bottom:10px}.react-datepicker-popper[data-placement^=\"right\"]{margin-left:8px}.react-datepicker-popper[data-placement^=\"right\"] .react-datepicker__triangle{left:auto;right:42px}.react-datepicker-popper[data-placement^=\"left\"]{margin-right:8px}.react-datepicker-popper[data-placement^=\"left\"] .react-datepicker__triangle{left:42px;right:auto}.react-datepicker__header{text-align:center;background-color:#f0f0f0;border-bottom:1px solid #aeaeae;border-top-left-radius:.3rem;border-top-right-radius:.3rem;padding-top:8px;position:relative}.react-datepicker__header--time{padding-bottom:8px;padding-left:5px;padding-right:5px}.react-datepicker__year-dropdown-container--select, .react-datepicker__month-dropdown-container--select, .react-datepicker__month-year-dropdown-container--select, .react-datepicker__year-dropdown-container--scroll, .react-datepicker__month-dropdown-container--scroll, .react-datepicker__month-year-dropdown-container--scroll{display:inline-block;margin:0 2px}.react-datepicker__current-month, .react-datepicker-time__header{margin-top:0;color:#000;font-weight:bold;font-size:.944rem}.react-datepicker-time__header{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.react-datepicker__navigation{background:none;line-height:1.7rem;text-align:center;cursor:pointer;position:absolute;top:10px;width:0;padding:0;border:.45rem solid transparent;z-index:1;height:10px;width:10px;text-indent:-999em;overflow:hidden}.react-datepicker__navigation--previous{left:10px;border-right-color:#ccc}.react-datepicker__navigation--previous:hover{border-right-color:#b3b3b3}.react-datepicker__navigation--previous--disabled, .react-datepicker__navigation--previous--disabled:hover{border-right-color:#e6e6e6;cursor:default}.react-datepicker__navigation--next{right:10px;border-left-color:#ccc}.react-datepicker__navigation--next--with-time:not(.react-datepicker__navigation--next--with-today-button){right:80px}.react-datepicker__navigation--next:hover{border-left-color:#b3b3b3}.react-datepicker__navigation--next--disabled, .react-datepicker__navigation--next--disabled:hover{border-left-color:#e6e6e6;cursor:default}.react-datepicker__navigation--years{position:relative;top:0;display:block;margin-left:auto;margin-right:auto}.react-datepicker__navigation--years-previous{top:4px;border-top-color:#ccc}.react-datepicker__navigation--years-previous:hover{border-top-color:#b3b3b3}.react-datepicker__navigation--years-upcoming{top:-4px;border-bottom-color:#ccc}.react-datepicker__navigation--years-upcoming:hover{border-bottom-color:#b3b3b3}.react-datepicker__month-container{float:left}.react-datepicker__month{margin:.4rem;text-align:center}.react-datepicker__time-container{float:right;border-left:1px solid #aeaeae;width:70px}.react-datepicker__time-container--with-today-button{display:inline;border:1px solid #aeaeae;border-radius:0.3rem;position:absolute;right:-72px;top:0}.react-datepicker__time-container .react-datepicker__time{position:relative;background:white}.react-datepicker__time-container .react-datepicker__time .react-datepicker__time-box{width:70px;overflow-x:hidden;margin:0 auto;text-align:center}.react-datepicker__time-container .react-datepicker__time .react-datepicker__time-box ul.react-datepicker__time-list{list-style:none;margin:0;height:calc(195px + 0.85rem);overflow-y:scroll;padding-right:0px;padding-left:0px;width:100%;box-sizing:content-box}.react-datepicker__time-container .react-datepicker__time .react-datepicker__time-box ul.react-datepicker__time-list li.react-datepicker__time-list-item{height:30px;padding:5px 10px}.react-datepicker__time-container .react-datepicker__time .react-datepicker__time-box ul.react-datepicker__time-list li.react-datepicker__time-list-item:hover{cursor:pointer;background-color:#f0f0f0}.react-datepicker__time-container .react-datepicker__time .react-datepicker__time-box ul.react-datepicker__time-list li.react-datepicker__time-list-item--selected{background-color:#216ba5;color:white;font-weight:bold}.react-datepicker__time-container .react-datepicker__time .react-datepicker__time-box ul.react-datepicker__time-list li.react-datepicker__time-list-item--selected:hover{background-color:#216ba5}.react-datepicker__time-container .react-datepicker__time .react-datepicker__time-box ul.react-datepicker__time-list li.react-datepicker__time-list-item--disabled{color:#ccc}.react-datepicker__time-container .react-datepicker__time .react-datepicker__time-box ul.react-datepicker__time-list li.react-datepicker__time-list-item--disabled:hover{cursor:default;background-color:transparent}.react-datepicker__week-number{color:#ccc;display:inline-block;width:1.7rem;line-height:1.7rem;text-align:center;margin:.166rem}.react-datepicker__week-number.react-datepicker__week-number--clickable{cursor:pointer}.react-datepicker__week-number.react-datepicker__week-number--clickable:hover{border-radius:.3rem;background-color:#f0f0f0}.react-datepicker__day-names, .react-datepicker__week{white-space:nowrap}.react-datepicker__day-name, .react-datepicker__day, .react-datepicker__time-name{color:#000;display:inline-block;width:1.7rem;line-height:1.7rem;text-align:center;margin:.166rem}.react-datepicker__day{cursor:pointer}.react-datepicker__day:hover{border-radius:.3rem;background-color:#f0f0f0}.react-datepicker__day--today{font-weight:bold}.react-datepicker__day--highlighted{border-radius:.3rem;background-color:#3dcc4a;color:#fff}.react-datepicker__day--highlighted:hover{background-color:#32be3f}.react-datepicker__day--highlighted-custom-1{color:magenta}.react-datepicker__day--highlighted-custom-2{color:green}.react-datepicker__day--selected, .react-datepicker__day--in-selecting-range, .react-datepicker__day--in-range{border-radius:.3rem;background-color:#216ba5;color:#fff}.react-datepicker__day--selected:hover, .react-datepicker__day--in-selecting-range:hover, .react-datepicker__day--in-range:hover{background-color:#1d5d90}.react-datepicker__day--keyboard-selected{border-radius:.3rem;background-color:#2a87d0;color:#fff}.react-datepicker__day--keyboard-selected:hover{background-color:#1d5d90}.react-datepicker__day--in-selecting-range:not(.react-datepicker__day--in-range){background-color:rgba(33,107,165,0.5)}.react-datepicker__month--selecting-range .react-datepicker__day--in-range:not(.react-datepicker__day--in-selecting-range){background-color:#f0f0f0;color:#000}.react-datepicker__day--disabled{cursor:default;color:#ccc}.react-datepicker__day--disabled:hover{background-color:transparent}.react-datepicker__input-container{position:relative;display:inline-block}.react-datepicker__year-read-view, .react-datepicker__month-read-view, .react-datepicker__month-year-read-view{border:1px solid transparent;border-radius:.3rem}.react-datepicker__year-read-view:hover, .react-datepicker__month-read-view:hover, .react-datepicker__month-year-read-view:hover{cursor:pointer}.react-datepicker__year-read-view:hover .react-datepicker__year-read-view--down-arrow, .react-datepicker__year-read-view:hover .react-datepicker__month-read-view--down-arrow, .react-datepicker__month-read-view:hover .react-datepicker__year-read-view--down-arrow, .react-datepicker__month-read-view:hover .react-datepicker__month-read-view--down-arrow, .react-datepicker__month-year-read-view:hover .react-datepicker__year-read-view--down-arrow, .react-datepicker__month-year-read-view:hover .react-datepicker__month-read-view--down-arrow{border-top-color:#b3b3b3}.react-datepicker__year-read-view--down-arrow, .react-datepicker__month-read-view--down-arrow, .react-datepicker__month-year-read-view--down-arrow{border-top-color:#ccc;float:right;margin-left:20px;top:8px;position:relative;border-width:.45rem}.react-datepicker__year-dropdown, .react-datepicker__month-dropdown, .react-datepicker__month-year-dropdown{background-color:#f0f0f0;position:absolute;width:50%;left:25%;top:30px;z-index:1;text-align:center;border-radius:.3rem;border:1px solid #aeaeae}.react-datepicker__year-dropdown:hover, .react-datepicker__month-dropdown:hover, .react-datepicker__month-year-dropdown:hover{cursor:pointer}.react-datepicker__year-dropdown--scrollable, .react-datepicker__month-dropdown--scrollable, .react-datepicker__month-year-dropdown--scrollable{height:150px;overflow-y:scroll}.react-datepicker__year-option, .react-datepicker__month-option, .react-datepicker__month-year-option{line-height:20px;width:100%;display:block;margin-left:auto;margin-right:auto}.react-datepicker__year-option:first-of-type, .react-datepicker__month-option:first-of-type, .react-datepicker__month-year-option:first-of-type{border-top-left-radius:.3rem;border-top-right-radius:.3rem}.react-datepicker__year-option:last-of-type, .react-datepicker__month-option:last-of-type, .react-datepicker__month-year-option:last-of-type{-webkit-user-select:none;user-select:none;border-bottom-left-radius:.3rem;border-bottom-right-radius:.3rem}.react-datepicker__year-option:hover, .react-datepicker__month-option:hover, .react-datepicker__month-year-option:hover{background-color:#ccc}.react-datepicker__year-option:hover .react-datepicker__navigation--years-upcoming, .react-datepicker__month-option:hover .react-datepicker__navigation--years-upcoming, .react-datepicker__month-year-option:hover .react-datepicker__navigation--years-upcoming{border-bottom-color:#b3b3b3}.react-datepicker__year-option:hover .react-datepicker__navigation--years-previous, .react-datepicker__month-option:hover .react-datepicker__navigation--years-previous, .react-datepicker__month-year-option:hover .react-datepicker__navigation--years-previous{border-top-color:#b3b3b3}.react-datepicker__year-option--selected, .react-datepicker__month-option--selected, .react-datepicker__month-year-option--selected{position:absolute;left:15px}.react-datepicker__close-icon{background-color:transparent;border:0;cursor:pointer;outline:0;padding:0;vertical-align:middle;position:absolute;height:16px;width:16px;top:25%;right:7px}.react-datepicker__close-icon::after{background-color:#216ba5;border-radius:50%;bottom:0;box-sizing:border-box;color:#fff;content:\"\\00d7\";cursor:pointer;font-size:12px;height:16px;width:16px;line-height:1;margin:-8px auto 0;padding:2px;position:absolute;right:0px;text-align:center}.react-datepicker__today-button{background:#f0f0f0;border-top:1px solid #aeaeae;cursor:pointer;text-align:center;font-weight:bold;padding:5px 0;clear:left}.react-datepicker__portal{position:fixed;width:100vw;height:100vh;background-color:rgba(0,0,0,0.8);left:0;top:0;justify-content:center;align-items:center;display:flex;z-index:2147483647}.react-datepicker__portal .react-datepicker__day-name, .react-datepicker__portal .react-datepicker__day, .react-datepicker__portal .react-datepicker__time-name{width:3rem;line-height:3rem}@media (max-width: 400px), (max-height: 550px){.react-datepicker__portal .react-datepicker__day-name, .react-datepicker__portal .react-datepicker__day, .react-datepicker__portal .react-datepicker__time-name{width:2rem;line-height:2rem}}.react-datepicker__portal .react-datepicker__current-month, .react-datepicker__portal .react-datepicker-time__header{font-size:1.44rem}.react-datepicker__portal .react-datepicker__navigation{border:.81rem solid transparent}.react-datepicker__portal .react-datepicker__navigation--previous{border-right-color:#ccc}.react-datepicker__portal .react-datepicker__navigation--previous:hover{border-right-color:#b3b3b3}.react-datepicker__portal .react-datepicker__navigation--previous--disabled, .react-datepicker__portal .react-datepicker__navigation--previous--disabled:hover{border-right-color:#e6e6e6;cursor:default}.react-datepicker__portal .react-datepicker__navigation--next{border-left-color:#ccc}.react-datepicker__portal .react-datepicker__navigation--next:hover{border-left-color:#b3b3b3}.react-datepicker__portal .react-datepicker__navigation--next--disabled, .react-datepicker__portal .react-datepicker__navigation--next--disabled:hover{border-left-color:#e6e6e6;cursor:default}\n";
styleInject(css_248z$w);

var css_248z$v = ".ff_v531__DatePicker-header__wrapper__1mA{\n\tdisplay:flex;\n\tjustify-content:space-between;\n}\n.ff_v531__DatePicker-header__month__11b, .ff_v531__DatePicker-header__year__3pb{\n\tdisplay:inline-block;\n\tcursor:pointer;\n\tposition:absolute;\n\tmargin:0;\n\tleft:0;\n\ttop:0;\n\tright:0;\n\tbottom:0;\n\topacity:0;\n}\n.ff_v531__DatePicker-header__selects__3Lp{\n\tdisplay:flex;\n\tline-height:normal;\n\tmargin-bottom:6px;\n}\n.ff_v531__DatePicker-header__selects__3Lp .ff_v531__DatePicker-header__label__1Bu{\n\t\tdisplay:inline-block;\n\t\tposition:relative;\n\t\toverflow:hidden;\n\t\tmargin:8px 2px;\n\t\tfont-size:15px;\n\t\tfont-weight:600;\n\t\tbackground-color:#ffffff;\n\t\tcolor:#317ae2;\n\t\tcursor:pointer;\n\t}\n.ff_v531__DatePicker-header__month__11b{\n\ttext-align-last:center;\n}\n.ff_v531__DatePicker-header__prev__3jO{\n\tmargin-left:8px;\n}\n.ff_v531__DatePicker-header__next__2TS{\n\tmargin-right:8px;\n}\n";
var styles$u = {
  "wrapper": "ff_v531__DatePicker-header__wrapper__1mA",
  "month": "ff_v531__DatePicker-header__month__11b",
  "year": "ff_v531__DatePicker-header__year__3pb",
  "selects": "ff_v531__DatePicker-header__selects__3Lp",
  "label": "ff_v531__DatePicker-header__label__1Bu",
  "prev": "ff_v531__DatePicker-header__prev__3jO",
  "next": "ff_v531__DatePicker-header__next__2TS"
};
styleInject(css_248z$v);

const DATE_FORMAT = 'YYYY-MM-DD';

const DatePickerHeader = ({
  date,
  changeYear,
  changeMonth,
  decreaseMonth,
  increaseMonth,
  nextMonthButtonDisabled,
  minEndDate,
  selectsEnd
}) => {
  const currentYear = date.year();
  const years = range(currentYear - 10, currentYear + 11, 1);
  const months = moment$1.months();

  const isPrevMonthButtonDisabled = () => {
    if (selectsEnd && minEndDate) {
      const formattedDate = date && date.format(DATE_FORMAT);
      const formattedMinDate = minEndDate && moment$1(minEndDate).format(DATE_FORMAT);
      const isSame = moment$1(formattedDate).isSame(formattedMinDate, 'month');
      const isBefore = moment$1(formattedDate).isBefore(formattedMinDate);
      return isSame || isBefore;
    }

    return;
  };

  const changeMonthHandler = ({
    target: {
      value
    }
  }) => changeMonth(value);

  const changeYearHandler = ({
    target: {
      value
    }
  }) => changeYear(value);

  return /*#__PURE__*/React.createElement("div", {
    className: styles$u.wrapper
  }, /*#__PURE__*/React.createElement(Button, {
    className: styles$u.prev,
    onClick: decreaseMonth,
    disabled: isPrevMonthButtonDisabled()
  }, /*#__PURE__*/React.createElement(Icon, {
    size: "s",
    icon: "arrow-left"
  })), /*#__PURE__*/React.createElement("div", {
    className: styles$u.selects
  }, /*#__PURE__*/React.createElement("div", {
    className: styles$u.label
  }, months[date.month()], /*#__PURE__*/React.createElement("select", {
    className: styles$u.month,
    value: months[date.month()],
    onChange: changeMonthHandler
  }, months.map(option => /*#__PURE__*/React.createElement("option", {
    key: option,
    value: option
  }, option)))), /*#__PURE__*/React.createElement("div", {
    className: styles$u.label
  }, currentYear, /*#__PURE__*/React.createElement("select", {
    className: styles$u.year,
    value: currentYear,
    onChange: changeYearHandler
  }, years.map(option => /*#__PURE__*/React.createElement("option", {
    key: option,
    value: option
  }, option))))), /*#__PURE__*/React.createElement(Button, {
    className: styles$u.next,
    onClick: increaseMonth,
    disabled: nextMonthButtonDisabled
  }, /*#__PURE__*/React.createElement(Icon, {
    size: "s",
    icon: "arrow-right"
  })));
};

const DatePickerInput = /*#__PURE__*/forwardRef(({
  onChange,
  error,
  inputProps,
  inputValue,
  datePickerPlaceholder,
  ...restProps
}, ref) => {
  const getDelimiter = value => {
    return value.split('').find(item => !!item.match(/^[.\-/]+$/)) || '.-/';
  };

  const handleChange = event => {
    const newValue = event.currentTarget.value;
    const delimiter = getDelimiter(newValue);
    const pattern = new RegExp(`^[0-9${delimiter}]+$`);

    if (!newValue.match(pattern) && newValue) {
      return;
    }

    if (onChange) {
      onChange(event);
    }
  };

  const color = error ? 'red' : undefined;
  return /*#__PURE__*/React.createElement(Input, { ...restProps,
    ref: ref,
    onChange: handleChange,
    message: typeof error === 'string' ? error : undefined,
    color: color,
    placeholder: datePickerPlaceholder,
    ...inputProps
  });
});

var css_248z$u = ".ff_v531__DatePicker__popper__3KT[data-placement^='bottom']{\n\t\tmargin-top:0;\n\t}\n\t.ff_v531__DatePicker__popper__3KT[data-placement]{\n\t\tz-index:6001;\n\t}\n\t.ff_v531__DatePicker__wrapper__2Tw .react-datepicker-wrapper, .ff_v531__DatePicker__wrapper__2Tw .react-datepicker__input-container{\n\t\t\twidth:100%;\n\t\t}\n\t.ff_v531__DatePicker__wrapper__2Tw .react-datepicker__close-icon::after{\n\t\t\t\tcolor:#747678;\n\t\t\t\tbackground-color:transparent;\n\t\t\t\tfont-size:23px;\n\t\t\t\theight:auto;\n\t\t\t\twidth:auto;\n\t\t\t\ttop:3px;\n\t\t\t\tright:2px;\n\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker\\--time-only{\n\t\t\tborder:0 !important;\n\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__header{\n\t\t\theight:69px;\n\t\t\tbackground-color:#ffffff;\n\t\t\tborder:0;\n\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__header\\--time{\n\t\t\t\tdisplay:none;\n\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__header\\--time-box{\n\t\t\t\t\twidth:100px;\n\t\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day{\n\t\t\tmargin:2px;\n\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day:hover{\n\t\t\t\tcolor:rgb(49,122,226);\n\t\t\t\tbackground-color:rgba(49,122,226,.32);\n\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day-names{\n\t\t\t\tborder-bottom:1px solid #e5e5e5;\n\t\t\t\tborder-top:1px solid #e5e5e5;\n\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day-name{\n\t\t\t\tcolor:rgba(38,41,44,.64);\n\t\t\t\tfont-size:11px;\n\t\t\t\tline-height:16px;\n\t\t\t\tfont-weight:400;\n\t\t\t\ttext-align:center;\n\t\t\t\tvertical-align:middle;\n\t\t\t\tpadding:4px 0;\n\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--today:not(.ff_v531__DatePicker__react-datepicker--time-only--in-selecting-range__1Z0){\n\t\t\t\t\tcolor:rgba(38,41,44,.64);\n\t\t\t\t\tbackground-color:#f7f7f7;\n\t\t\t\t\tfont-weight:600;\n\t\t\t\t\tborder-radius:3px;\n\t\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--outside-month{\n\t\t\t\tcolor:rgba(38,41,44,.32);\n\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--selected, .ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--keyboard-selected, .ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--range-start, .ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--range-end{\n\t\t\t\tcolor:#ffffff !important;\n\t\t\t\tbackground-color:#317ae2 !important;\n\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--in-selecting-range:not(.ff_v531__DatePicker__react-datepicker__day--in-range__1TC){\n\t\t\t\t\tcolor:rgb(49,122,226);\n\t\t\t\t\tbackground-color:rgba(49,122,226,.32);\n\t\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--in-selecting-range:not(.ff_v531__DatePicker__react-datepicker__day--selecting-range-start__Cya):not(.ff_v531__DatePicker__react-datepicker__day--today__1nV):not(.ff_v531__DatePicker__react-datepicker__day--in-range__1TC){\n\t\t\t\t\tcolor:#26292c;\n\t\t\t\t\tbackground-color:transparent;\n\t\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--selecting-range-start, .ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--in-range:not(.ff_v531__DatePicker__react-datepicker__day--range-start__1JD):not(.ff_v531__DatePicker__react-datepicker__day--range-end__2Ip){\n\t\t\t\t\tcolor:rgb(49,122,226);\n\t\t\t\t\tbackground-color:rgba(49,122,226,.32);\n\t\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--disabled{\n\t\t\t\tpointer-events:none;\n\t\t\t\tbackground-color:transparent;\n\t\t\t}\n\t.ff_v531__DatePicker__datepicker__3hq .react-datepicker__day\\--disabled:hover{\n\t\t\t\t\tbackground-color:transparent;\n\t\t\t\t}\n";
var styles$t = {
  "popper": "ff_v531__DatePicker__popper__3KT",
  "wrapper": "ff_v531__DatePicker__wrapper__2Tw",
  "datepicker": "ff_v531__DatePicker__datepicker__3hq",
  "react-datepicker--time-only--in-selecting-range": "ff_v531__DatePicker__react-datepicker--time-only--in-selecting-range__1Z0",
  "react-datepicker__day--in-range": "ff_v531__DatePicker__react-datepicker__day--in-range__1TC",
  "react-datepicker__day--selecting-range-start": "ff_v531__DatePicker__react-datepicker__day--selecting-range-start__Cya",
  "react-datepicker__day--today": "ff_v531__DatePicker__react-datepicker__day--today__1nV",
  "react-datepicker__day--range-start": "ff_v531__DatePicker__react-datepicker__day--range-start__1JD",
  "react-datepicker__day--range-end": "ff_v531__DatePicker__react-datepicker__day--range-end__2Ip"
};
styleInject(css_248z$u);

const validator = ({
  value,
  data,
  translator
}) => {
  const {
    locale
  } = data;
  const dateFormat = localeMomentFormat(locale, 'L');
  const dateLength = dateFormat.length;
  const invalidDateLocaleErrorMessage = translator.gettext('Invalid date format');
  const dateConstraints = {
    datePicker: {
      presence: {
        allowEmpty: true
      },
      datetime: {
        dateOnly: true,
        message: `^${invalidDateLocaleErrorMessage}`
      },
      length: {
        is: dateLength,
        wrongLength: `^${invalidDateLocaleErrorMessage}`
      }
    }
  };
  validate.extend(validate.validators.datetime, {
    parse: currentValue => +moment$1.utc(currentValue, dateFormat),
    format: () => moment$1.utc(value).format(dateFormat)
  });
  return validate({
    datePicker: trimStart(value)
  }, dateConstraints);
};

const DatePicker = /*#__PURE__*/React.forwardRef(({
  value,
  className = '',
  calendarClassName = '',
  popperClassName = '',
  showTimeSelect,
  showTimeSelectOnly,
  portalTo,
  disabled,
  minEndDate,
  onRawChange,
  selectsEnd,
  onComponentChange,
  selected,
  error,
  placeholder,
  allowClear,
  startDate,
  endDate,
  onValidation,
  ...rest
}, ref) => {
  const {
    locale,
    translator
  } = parseContext(useContext(FormFieldsContext));
  const [validationError, setValidationError] = useState('');
  const [inputValueState, setInputValueState] = useState();
  const [selectedDateState, setSelectedDateState] = useState();
  const {
    handleValidation
  } = useValidation(translator);
  const format = localeMomentFormat(locale, 'L');

  if (selected && !(selected !== null && selected !== void 0 && selected.isSame(selectedDateState))) {
    setSelectedDateState(selected);
    setInputValueState(moment$1(selected).format(format));
  }

  useEffect(() => {
    const inputValue = getMoment(value);
    setInputValueState((inputValue === null || inputValue === void 0 ? void 0 : inputValue.format(format)) || '');
    setSelectedDateState(value ? inputValue : null);
  }, [value]); // Raw event firing from react-datepicker so we can handle input value directly
  // without getting mangled Moment date object when the date is only partially entered.

  const onInputChange = event => {
    const inputValue = event.currentTarget.value;
    return setInputValueState(inputValue);
  };

  const validationHandler = formValue => {
    const data = {
      locale,
      showTimeSelect
    };
    const errorMessage = handleValidation({
      formValue,
      validate: validator,
      data
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const onChange = date => {
    const initDate = getInitDate(value);
    const selectedDateIsValid = (date === null || date === void 0 ? void 0 : date.isValid()) || (initDate === null || initDate === void 0 ? void 0 : initDate.isValid());
    const selectedDate = selectedDateIsValid ? date : null;
    const inputValue = parseSelectedDate(selectedDate, format);
    setInputValueState(inputValue);
    setSelectedDateState(selectedDate);

    if (onRawChange) {
      onRawChange(date);
    }

    if (onComponentChange) {
      const formattedDate = formatDate(selectedDate);
      onComponentChange(formattedDate);
    }
    /**
     * Handle validation after selectDate has fired to clear possible error state
     * that has been the state before a valid selection.
     */


    validationHandler(inputValue);
  };

  const renderCustomHeader = renderProps => {
    return /*#__PURE__*/React.createElement(DatePickerHeader, { ...renderProps,
      minEndDate: minEndDate,
      selectsEnd: selectsEnd
    });
  };
  /**
   * For date format we also enable more permissive 'l' format
   * to enter dates without leading zeroes.
   *
   * Return 'M/D/YYYY' in specific locale
   */


  const withoutLeadingZeroFormat = localeMomentFormat(locale, 'l'); // Enable permissive separator entry to not invalidate the user entry when
  // the separator entered does not match the locale defined.

  const dateFormat = flatMap([withoutLeadingZeroFormat, format], getAllSeparators);
  const dateRangeProps = getDateRangeProps(minEndDate);
  return /*#__PURE__*/React.createElement("div", {
    className: classNames(className, styles$t.wrapper)
  }, /*#__PURE__*/React.createElement(Calendar, {
    popperClassName: classNames(popperClassName, styles$t.popper, styles$t.datepicker),
    ref: ref,
    dateFormat: dateFormat,
    readOnly: disabled,
    onChange: onChange,
    value: inputValueState,
    onChangeRaw: onInputChange,
    selected: selectedDateState,
    ...renderPopperAttribute(portalTo),
    renderCustomHeader: renderCustomHeader,
    onBlur: validationHandler,
    customInput: /*#__PURE__*/React.createElement(DatePickerInput, {
      datePickerPlaceholder: placeholder || format,
      error: error || validationError
    }),
    isClearable: allowClear,
    startDate: startDate,
    endDate: endDate,
    ...dateRangeProps,
    ...rest
  }));
});

const DatePickerRead = props => {
  const {
    value
  } = props;
  const {
    locale
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  const format = localeMomentFormat(locale, 'LL');
  const dateValue = moment$1(value).format(format);
  return /*#__PURE__*/React.createElement(React.Fragment, null, dateValue);
};

var css_248z$t = ".ff_v531__Error__error__YlD{\n\tcolor:#f94839;\n\tmargin-top:4px;\n\tfont-size:13px;\n}\n.ff_v531__Error__select__1Mm .cui4-select__box{\n\t\tborder:1px solid #f94839;\n\t}\n";
var errorStyles = {
  "error": "ff_v531__Error__error__YlD",
  "select": "ff_v531__Error__select__1Mm"
};
styleInject(css_248z$t);

const Error$1 = ({
  message
}) => {
  if (!message) {
    return null;
  }

  return /*#__PURE__*/React.createElement("div", {
    className: errorStyles.error
  }, message);
};

const staticClassNamePrefix = 'ff';

var css_248z$s = ".ff_v531__DateRange__wrapper__2_m{\n\tdisplay:flex;\n\tjustify-content:flex-start;\n\talign-items:flex-end;\n}\n\n\t.ff_v531__DateRange__wrapper__2_m .ff_v531__DateRange__separator__1eA{\n\t\tdisplay:flex;\n\t\talign-items:center;\n\t\theight:32px;\n\t\tpadding:0 8px;\n\t}\n";
var styles$s = {
  "wrapper": "ff_v531__DateRange__wrapper__2_m",
  "separator": "ff_v531__DateRange__separator__1eA"
};
styleInject(css_248z$s);

const DateRange = ({
  placeholderTextStart,
  placeholderTextEnd,
  startOpen,
  value,
  onComponentChange = () => null,
  openNextAfterSelection,
  error,
  className,
  allowClear,
  allowClearStart,
  allowClearEnd,
  ...rest
}) => {
  const datePickerRefObj = useRef(null);
  const {
    locale
  } = parseContext(useContext(FormFieldsContext));
  localeMomentFormat(locale, 'L');
  const {
    allowClearStartValue,
    allowClearEndValue
  } = getAllowClearValues(allowClear, allowClearStart, allowClearEnd);
  const [startDateState, setStartDate] = useState();
  const [endDateState, setEndDate] = useState();
  const [intervalState, setIntervalState] = useState();
  useEffect(() => {
    const startDateMoment = getMoment(value === null || value === void 0 ? void 0 : value.startDate);
    const endDateMoment = getMoment(value === null || value === void 0 ? void 0 : value.endDate);
    setStartDate(startDateMoment);
    setEndDate(endDateMoment);
    setIntervalState(setInterval(startDateMoment, endDateMoment));
  }, [value]);

  const adjustEndDate = (startDate, interval) => {
    if (typeof interval === 'number' && interval >= 0 && startDate) {
      const newStartDate = startDate.clone();
      const newEndDate = newStartDate.add(Math.abs(interval), 'days');
      onComponentChange({
        startDate: formatDate(startDate),
        endDate: formatDate(newEndDate)
      });
      setEndDate(newEndDate);
    }
  };

  const handleChangeStart = newStartDate => {
    const calendarRef = datePickerRefObj && datePickerRefObj.current;
    const endDate = endDateState || undefined;

    if (endDate && (newStartDate !== null && newStartDate !== void 0 && newStartDate.isAfter(endDate) || newStartDate !== null && newStartDate !== void 0 && newStartDate.isSame(endDate))) {
      adjustEndDate(newStartDate, intervalState);
    } else {
      setIntervalState(setInterval(newStartDate, endDateState));

      if (onComponentChange) {
        onComponentChange({
          startDate: formatDate(newStartDate),
          endDate: formatDate(endDateState)
        });
      }
    }

    setStartDate(newStartDate);

    if (openNextAfterSelection && calendarRef) {
      calendarRef.setOpen(true);
    }
  };

  const handleChangeEnd = endDate => {
    setEndDate(endDate);
    setIntervalState(setInterval(startDateState, endDate));

    if (onComponentChange) {
      onComponentChange({
        startDate: formatDate(startDateState),
        endDate: formatDate(endDate)
      });
    }
  };

  return /*#__PURE__*/React.createElement("div", {
    className: classNames(className)
  }, /*#__PURE__*/React.createElement("div", {
    className: styles$s.wrapper
  }, /*#__PURE__*/React.createElement(DatePicker, {
    className: `${staticClassNamePrefix}-date-range-start-picker`,
    selectsStart: true,
    startDate: startDateState,
    endDate: endDateState,
    startOpen: startOpen,
    selected: startDateState,
    onRawChange: handleChangeStart,
    placeholder: placeholderTextStart,
    value: value === null || value === void 0 ? void 0 : value.startDate,
    error: !!error,
    onComponentChange: () => null,
    allowClear: allowClearStartValue,
    ...omit(rest, ['onComponentChange'])
  }), /*#__PURE__*/React.createElement("div", {
    className: styles$s.separator
  }, "-"), /*#__PURE__*/React.createElement(DatePicker, {
    className: `${staticClassNamePrefix}-date-range-end-picker`,
    ref: datePickerRefObj,
    startDate: startDateState,
    endDate: endDateState,
    disabled: !startDateState,
    selected: endDateState,
    onRawChange: handleChangeEnd,
    placeholder: placeholderTextEnd,
    minEndDate: startDateState,
    excludeDates: substractOneMonth(startDateState),
    value: value === null || value === void 0 ? void 0 : value.endDate,
    error: !!error,
    onComponentChange: () => null,
    allowClear: allowClearEndValue,
    ...omit(rest, ['onComponentChange'])
  })), /*#__PURE__*/React.createElement(Error$1, {
    message: error
  }));
};

var css_248z$r = ".ff_v531__Link__link__26_{\n\ttext-decoration:none;\n\tcolor:#317ae2;\n\tpadding-right:4px;\n}\n\n\t.ff_v531__Link__link__26_:hover{\n\t\ttext-decoration:underline;\n\t}\n";
var styles$r = {
  "link": "ff_v531__Link__link__26_"
};
styleInject(css_248z$r);

const Link = ({
  openLinksInNewTab,
  href,
  value = '',
  onClick,
  children,
  ...restProps
}) => {
  const clickHandler = event => {
    event.stopPropagation();

    if (onClick) {
      event === null || event === void 0 ? void 0 : event.preventDefault();
      onClick(value);
    }
  };

  return /*#__PURE__*/React.createElement("a", { ...(openLinksInNewTab ? {
      target: '_blank'
    } : {}),
    href: onClick ? '#' : href,
    className: styles$r.link,
    onClick: clickHandler,
    ...restProps
  }, children);
};

const DealRead = ({
  value,
  openLinksInNewTab
}) => {
  if (!value) {
    return null;
  }

  return /*#__PURE__*/React.createElement(Link, {
    openLinksInNewTab: openLinksInNewTab,
    href: `/deal/${value.id}`
  }, value.title);
};

function useQuickInfoCard() {
  const {
    webappApi
  } = useContext(FormFieldsContext);
  const [QuickInfoCard, setQuickInfoCard] = useState(null);
  React.useEffect(() => {
    const fetchQuickInfoCard = async () => {
      if (webappApi && webappApi.componentLoader) {
        const {
          default: QuickInfoCardComponent
        } = await webappApi.componentLoader.load('quick-info-card');
        setQuickInfoCard(() => props => /*#__PURE__*/React.createElement(QuickInfoCardComponent, {
          webappApi: webappApi,
          ...props
        }));
      }
    };

    fetchQuickInfoCard();
  }, []);
  return QuickInfoCard;
}

var css_248z$q = ".ff_v531__EntitySuggestions__duplicatesOptionslist__1tb{\n\tmax-height:364px;\n\toverflow:auto;\n}\n.ff_v531__EntitySuggestions__option__2gG .cui4-option-check{\n\tright:12px;\n}\n.ff_v531__EntitySuggestions__optionIcon__22k{\n\tposition:absolute;\n\tright:12px;\n\tdisplay:none;\n\ttop:calc(50% - 16px);\n}\n.ff_v531__EntitySuggestions__optionIcon__22k .cui4-icon{\n\t\tdisplay:block;\n\t\tfill:#ffffff;\n\t}\n.ff_v531__EntitySuggestions__optionIcon__22k .cui4-icon:hover{\n\t\t\tfill:#ffffff;\n\t\t}\n.ff_v531__EntitySuggestions__optionIcon__22k:hover .cui4-icon{\n\t\t\tfill:#ffffff !important;\n\t\t}\n.ff_v531__EntitySuggestions__option__2gG{\n\tpadding:8px 40px 8px 16px;\n\tbox-sizing:border-box;\n\tcursor:pointer;\n\tposition:relative;\n\tcolor:#26292c;\n}\n.ff_v531__EntitySuggestions__option__2gG .ff_v531__EntitySuggestions__name__2S5{\n\t\twhite-space:nowrap;\n\t\toverflow:hidden;\n\t\ttext-overflow:ellipsis;\n\t}\n.ff_v531__EntitySuggestions__option__2gG .ff_v531__EntitySuggestions__details__24V{\n\t\tcolor:#747678;\n\t\tfont-size:13px;\n\t}\n.ff_v531__EntitySuggestions__option__2gG:hover, .ff_v531__EntitySuggestions__option__2gG.ff_v531__EntitySuggestions__optionHighlighted__3Ew{\n\t\tbackground:#317ae2;\n\t\tcolor:#ffffff;\n\t}\n.ff_v531__EntitySuggestions__option__2gG:hover .ff_v531__EntitySuggestions__optionIcon__22k, .ff_v531__EntitySuggestions__option__2gG.ff_v531__EntitySuggestions__optionHighlighted__3Ew .ff_v531__EntitySuggestions__optionIcon__22k{\n\t\t\tdisplay:block;\n\t\t\tcursor:pointer;\n\t\t\tcolor:#ffffff;\n\t\t}\n.ff_v531__EntitySuggestions__option__2gG:hover .ff_v531__EntitySuggestions__details__24V, .ff_v531__EntitySuggestions__option__2gG.ff_v531__EntitySuggestions__optionHighlighted__3Ew .ff_v531__EntitySuggestions__details__24V{\n\t\t\tcolor:#ffffff;\n\t\t}\n.ff_v531__EntitySuggestions__option__2gG:hover .cui4-option-check, .ff_v531__EntitySuggestions__option__2gG.ff_v531__EntitySuggestions__optionHighlighted__3Ew .cui4-option-check{\n\t\t\tdisplay:none;\n\t\t}\n.ff_v531__EntitySuggestions__addNew__2Gf{\n\tpadding:8px 16px;\n\tdisplay:flex;\n\talign-items:center;\n\tmargin-top:4px;\n\tcursor:pointer;\n}\n.ff_v531__EntitySuggestions__addNew__2Gf span{\n\t\tmargin-left:8px;\n\t\tfont-weight:600;\n\t\tcolor:#317ae2;\n\t}\n.ff_v531__EntitySuggestions__addNew__2Gf svg{\n\t\tfill:#317ae2;\n\t}\n.ff_v531__EntitySuggestions__tooltip__2Tg{\n\tz-index:6001;\n}\n.ff_v531__EntitySuggestions__tooltipContent__6X7{\n\tmax-width:200px;\n}\n";
var styles$q = {
  "duplicatesOptionslist": "ff_v531__EntitySuggestions__duplicatesOptionslist__1tb",
  "option": "ff_v531__EntitySuggestions__option__2gG",
  "optionIcon": "ff_v531__EntitySuggestions__optionIcon__22k",
  "name": "ff_v531__EntitySuggestions__name__2S5",
  "details": "ff_v531__EntitySuggestions__details__24V",
  "optionHighlighted": "ff_v531__EntitySuggestions__optionHighlighted__3Ew",
  "addNew": "ff_v531__EntitySuggestions__addNew__2Gf",
  "tooltip": "ff_v531__EntitySuggestions__tooltip__2Tg",
  "tooltipContent": "ff_v531__EntitySuggestions__tooltipContent__6X7"
};
styleInject(css_248z$q);

const DetailsIcon = ({
  type,
  item,
  tooltipText,
  QuickInfoCard
}) => {
  const renderButton = () => /*#__PURE__*/React.createElement(Button, {
    color: "ghost-alternative",
    href: `/${type}/${item.id}`,
    target: "_blank",
    rel: "noopener noreferrer",
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement(Icon, {
    icon: "redirect",
    color: "white",
    size: "s"
  }));

  if (QuickInfoCard) {
    return /*#__PURE__*/React.createElement(QuickInfoCard, {
      type: type,
      id: item.id,
      popoverProps: {
        portalTo: document.body,
        mouseLeaveDelay: 0,
        placement: 'right'
      },
      source: "contact_suggestions"
    }, renderButton());
  }

  return /*#__PURE__*/React.createElement(Tooltip, {
    className: styles$q.tooltip,
    placement: "left",
    content: /*#__PURE__*/React.createElement("div", {
      className: styles$q.tooltipContent
    }, tooltipText),
    portalTo: document.body
  }, renderButton());
};

const Title = ({
  item,
  getSuggestionTitle
}) => {
  return /*#__PURE__*/React.createElement("div", {
    className: styles$q.name
  }, getSuggestionTitle(item) || item.formattedName || item.name || item.title);
};

// for the components that use EntitySuggestions

const ADD_NEW_DUMMY_ITEM = {
  id: 0,
  name: 'add-new',
  formattedName: 'add-new',
  details: '',
  email: '',
  is_hidden: false,
  org_id: 0,
  org_name: ''
};

const EntitySuggestions = ({
  items,
  highlightedIndex,
  setHighlightedIndex,
  type,
  getItemProps,
  onClickOption,
  onClickAddNew,
  getSuggestionTitle = item => '',
  allowNewItem = true,
  texts,
  inputValue,
  suggestionValueKey
}) => {
  const QuickInfoCard = useQuickInfoCard();
  const filteredItems = items.filter(item => {
    return item.id !== ADD_NEW_DUMMY_ITEM.id && item.name !== ADD_NEW_DUMMY_ITEM.name;
  });

  const renderAddNewOption = () => {
    if (!allowNewItem) {
      return;
    }

    const onMouseEnter = () => {
      if (setHighlightedIndex) {
        setHighlightedIndex(filteredItems.length + 1);
      }
    };

    const item = isString(suggestionValueKey) ? {
      [suggestionValueKey]: inputValue,
      is_new: true
    } : inputValue;
    const elementProps = getItemProps ? getItemProps({
      item
    }) : {};

    const onClick = () => onClickAddNew ? onClickAddNew(inputValue) : noop;

    return /*#__PURE__*/React.createElement(React.Fragment, null, filteredItems.length > 0 && /*#__PURE__*/React.createElement(Separator, null), /*#__PURE__*/React.createElement("div", { ...elementProps
    }, /*#__PURE__*/React.createElement(Option, {
      "data-testid": "entity-suggestion-add-new",
      className: styles$q.addNew,
      highlighted: highlightedIndex === filteredItems.length,
      onClick: onClick,
      onMouseEnter: onMouseEnter
    }, /*#__PURE__*/React.createElement(Icon, {
      size: "s",
      icon: "plus"
    }), /*#__PURE__*/React.createElement("span", null, texts.addNew))));
  };

  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
    className: styles$q.duplicatesOptionslist
  }, filteredItems.map((item, index) => {
    const onClick = () => onClickOption ? onClickOption(item) : noop;

    const additionalRootElementProps = getItemProps ? getItemProps({
      item,
      index
    }) : {};

    const onMouseEnter = () => {
      if (setHighlightedIndex) {
        setHighlightedIndex(index);
      }
    };

    return /*#__PURE__*/React.createElement("div", {
      key: item.id,
      onClick: onClick,
      ...additionalRootElementProps
    }, /*#__PURE__*/React.createElement(Option, {
      "data-testid": "option",
      className: classNames({
        [styles$q.option]: true,
        [styles$q.optionHighlighted]: highlightedIndex === index
      }),
      onMouseEnter: onMouseEnter
    }, /*#__PURE__*/React.createElement(Title, {
      getSuggestionTitle: getSuggestionTitle,
      item: item
    }), item.details && /*#__PURE__*/React.createElement("div", {
      className: styles$q.details
    }, item.details), /*#__PURE__*/React.createElement("div", {
      className: styles$q.optionIcon
    }, /*#__PURE__*/React.createElement(DetailsIcon, {
      QuickInfoCard: QuickInfoCard,
      type: type,
      item: item,
      tooltipText: texts.tooltip
    }))));
  })), renderAddNewOption());
};

const Deal = ({
  value,
  error,
  allowNewItem = false,
  showDealRelatedOrg = false,
  showNewLabel = false,
  onBlur = noop,
  onValidation,
  ...restProps
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState('');

  const getSuggestionTitle = deal => {
    if (typeof deal === 'string') {
      return deal;
    }

    const dealOrg = showDealRelatedOrg && deal.org_name ? ` (${deal.org_name})` : '';
    return `${deal.title}${dealOrg}`;
  };

  const renderDealSuggestions = deals => (getItemProps, highlightedIndex, setHighlightedIndex, inputValue) => {
    return /*#__PURE__*/React.createElement(EntitySuggestions, {
      inputValue: inputValue,
      items: deals,
      highlightedIndex: highlightedIndex,
      setHighlightedIndex: setHighlightedIndex,
      getItemProps: getItemProps,
      type: "deal",
      allowNewItem: allowNewItem,
      getSuggestionTitle: getSuggestionTitle,
      texts: {
        tooltip: translator.gettext('Show deal details'),
        addNew: translator.pgettext('Text for adding new deal button"', "Add '%s' as new deal", inputValue)
      }
    });
  };

  const getDeals = async value => {
    const dealSearchResponse = await find(DataTypes.deal, value);
    return dealSearchResponse === null || dealSearchResponse === void 0 ? void 0 : dealSearchResponse.items.map(({
      item: deal
    }) => {
      var _deal$organization, _deal$organization2, _deal$person, _deal$person2;

      return {
        id: deal.id,
        title: deal.title,
        currency: deal.currency,
        org_id: (_deal$organization = deal.organization) === null || _deal$organization === void 0 ? void 0 : _deal$organization.id,
        org_name: (_deal$organization2 = deal.organization) === null || _deal$organization2 === void 0 ? void 0 : _deal$organization2.name,
        person_id: (_deal$person = deal.person) === null || _deal$person === void 0 ? void 0 : _deal$person.id,
        person_name: (_deal$person2 = deal.person) === null || _deal$person2 === void 0 ? void 0 : _deal$person2.name
      };
    });
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const getIsDealNew = dealValue => {
    if (!allowNewItem) {
      return false;
    }

    if (isObject(dealValue)) {
      return !dealValue.id;
    }

    if (isString(dealValue)) {
      return true;
    }

    return false;
  };

  return /*#__PURE__*/React.createElement(InputSelect, {
    inputProps: {
      icon: 'deal',
      onBlur: event => {
        event.persist();
        defer(() => {
          validate(event);
          onBlur(event);
        });
      },
      message: error || validationError
    },
    getSuggestionValue: getSuggestionTitle,
    getSuggestions: getDeals,
    renderSuggestions: renderDealSuggestions,
    isNewValue: allowNewItem ? isString : undefined,
    showNewLabel: showNewLabel || getIsDealNew(value),
    dropdownTrigger: 2,
    value: value,
    allowNewItem: true,
    ...restProps
  });
};

var TypeName;

(function (TypeName) {
  TypeName["LEAD"] = "lead";
  TypeName["DEAL"] = "deal";
})(TypeName || (TypeName = {}));

const DealOrLeadRead = ({
  value,
  openLinksInNewTab
}) => {
  if (!value) {
    return null;
  }

  const getLink = (type, id) => {
    switch (type) {
      case TypeName.LEAD:
        return `/leads/${id}`;

      case TypeName.DEAL:
      default:
        return `/deal/${id}`;
    }
  };

  return /*#__PURE__*/React.createElement(Link, {
    openLinksInNewTab: openLinksInNewTab,
    href: getLink(value.type, value.id)
  }, value.title);
};

var css_248z$p = ".ff_v531__DealOrLead__popoverContent__1lH{\n\tmax-height:240px;\n}\n";
var styles$p = {
  "popoverContent": "ff_v531__DealOrLead__popoverContent__1lH"
};
styleInject(css_248z$p);

const useValueWithCurrency = () => {
  const {
    formatter,
    currencies
  } = parseContext(useContext(FormFieldsContext));
  return (value, currency) => {
    var _currencies$;

    if (!value || !currency) {
      return null;
    }

    let code = currencies ? (_currencies$ = currencies[0]) === null || _currencies$ === void 0 ? void 0 : _currencies$.code : 'EUR';
    const selected = find$1(currencies, {
      code: currency
    });

    if (selected) {
      code = selected.code;
    }

    return formatter.format(value, code);
  };
};

var css_248z$o = ".ff_v531__ResultItem__dealStatus__1ue{\n\ttext-transform:capitalize;\n}\n.ff_v531__ResultItem__resultDetails__POn{\n\tmargin-top:4px;\n\tfont-size:13px;\n\tmax-width:100%;\n\twhite-space:nowrap;\n\toverflow:hidden;\n\ttext-overflow:ellipsis;\n}\n.ff_v531__ResultItem__resultDetails__POn span:not(:last-child)::after{\n\t\tcontent:' \\B7  ';\n\t\tcolor:#26292c;\n\t}\n.ff_v531__ResultItem__option__RTx{\n\tpadding:8px 4px;\n\tdisplay:flex;\n\talign-items:center;\n}\n.ff_v531__ResultItem__option__RTx:hover .ff_v531__ResultItem__dealStatus__1ue, .ff_v531__ResultItem__option__RTx.ff_v531__ResultItem__optionHighlighted__3dF .ff_v531__ResultItem__dealStatus__1ue, .ff_v531__ResultItem__option__RTx:hover .ff_v531__ResultItem__resultDetails__POn span::after, .ff_v531__ResultItem__option__RTx.ff_v531__ResultItem__optionHighlighted__3dF .ff_v531__ResultItem__resultDetails__POn span::after{\n\t\t\tcolor:#ffffff;\n\t\t}\n.ff_v531__ResultItem__resultIcon__1cj{\n\tmargin:8px;\n}\n.ff_v531__ResultItem__dealStatusWon__Q7b{\n\tcolor:#08a742;\n}\n.ff_v531__ResultItem__dealStatusLost__gWg{\n\tcolor:#f94839;\n}\n.ff_v531__ResultItem__resultWrapper__-jM{\n\tmax-width:100%;\n}\n.ff_v531__ResultItem__resultBody__QYE{\n\tmax-width:calc(100% - 65px);\n}\n.ff_v531__ResultItem__resultTitle__xI3{\n\tdisplay:block;\n\tmax-width:100%;\n\twhite-space:nowrap;\n\toverflow:hidden;\n\ttext-overflow:ellipsis;\n}\n";
var styles$o = {
  "dealStatus": "ff_v531__ResultItem__dealStatus__1ue",
  "resultDetails": "ff_v531__ResultItem__resultDetails__POn",
  "option": "ff_v531__ResultItem__option__RTx",
  "optionHighlighted": "ff_v531__ResultItem__optionHighlighted__3dF",
  "resultIcon": "ff_v531__ResultItem__resultIcon__1cj",
  "dealStatusWon": "ff_v531__ResultItem__dealStatusWon__Q7b",
  "dealStatusLost": "ff_v531__ResultItem__dealStatusLost__gWg",
  "resultWrapper": "ff_v531__ResultItem__resultWrapper__-jM",
  "resultBody": "ff_v531__ResultItem__resultBody__QYE",
  "resultTitle": "ff_v531__ResultItem__resultTitle__xI3"
};
styleInject(css_248z$o);

const ResultItem = ({
  index,
  item,
  getItemProps,
  setHighlightedIndex,
  highlightedIndex
}) => {
  const getValueWithCurrency = useValueWithCurrency();
  const {
    id,
    type,
    org_name: orgName,
    person_name: personName,
    value,
    currency
  } = item;

  const onMouseEnter = () => {
    if (setHighlightedIndex) {
      setHighlightedIndex(index);
    }
  };

  const additionalRootElementProps = getItemProps ? getItemProps({
    item,
    index
  }) : {};

  const renderDealStatus = status => {
    return /*#__PURE__*/React.createElement("span", {
      className: classNames({
        [styles$o.dealStatus]: true,
        [styles$o.dealStatusLost]: status === 'lost',
        [styles$o.dealStatusWon]: status === 'won'
      }),
      "data-testid": "option-status"
    }, status);
  };

  const renderValueWithCurrency = () => {
    return /*#__PURE__*/React.createElement("span", null, getValueWithCurrency(value, currency));
  };

  return /*#__PURE__*/React.createElement("div", {
    key: id,
    ...additionalRootElementProps,
    className: styles$o.resultWrapper
  }, /*#__PURE__*/React.createElement(Option, {
    "data-testid": "option",
    className: classNames({
      [styles$o.option]: true,
      [styles$o.optionHighlighted]: highlightedIndex === index
    }),
    onMouseEnter: onMouseEnter,
    highlighted: highlightedIndex === index
  }, /*#__PURE__*/React.createElement(Icon, {
    className: styles$o.resultIcon,
    icon: type,
    size: "s",
    color: "black-64",
    "data-testid": "option-icon"
  }), /*#__PURE__*/React.createElement("div", {
    className: styles$o.resultBody
  }, /*#__PURE__*/React.createElement("span", {
    className: styles$o.resultTitle
  }, item.title), /*#__PURE__*/React.createElement("div", {
    className: styles$o.resultDetails
  }, item.type === TypeName.DEAL && item.status && renderDealStatus(item.status), value && currency && renderValueWithCurrency(), personName && /*#__PURE__*/React.createElement("span", null, personName), orgName && /*#__PURE__*/React.createElement("span", null, orgName)))));
};

const prioritizeDeal = searchResult => {
  if (!searchResult) {
    return [];
  }

  return searchResult.sort((a, b) => b.result_score - a.result_score || (a.item.type === TypeName.DEAL ? -1 : 1));
};

const DealOrLead = ({
  disabled = false,
  value,
  error,
  onBlur = noop,
  onValidation,
  allowClear,
  ...restProps
}) => {
  const [validationError, setValidationError] = useState('');
  const [isLoading, setLoading] = useState(false);
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);

  const renderSuggestions = searchResults => (getItemProps, highlightedIndex, setHighlightedIndex) => {
    return /*#__PURE__*/React.createElement("div", {
      className: styles$p.popoverContent
    }, searchResults.map((item, index) => {
      return /*#__PURE__*/React.createElement(ResultItem, {
        index: index,
        item: item,
        key: item.id,
        getItemProps: getItemProps,
        setHighlightedIndex: setHighlightedIndex,
        highlightedIndex: highlightedIndex
      });
    }));
  };

  const getSuggestionValue = suggestion => {
    if (typeof suggestion === 'string') {
      return suggestion;
    }

    return suggestion.title;
  };

  const mapApiResultsToEntity = item => {
    var _item$organization, _item$organization2, _item$person, _item$person2;

    return {
      id: item.id,
      title: item.title,
      status: item.status,
      org_id: (_item$organization = item.organization) === null || _item$organization === void 0 ? void 0 : _item$organization.id,
      org_name: (_item$organization2 = item.organization) === null || _item$organization2 === void 0 ? void 0 : _item$organization2.name,
      person_id: (_item$person = item.person) === null || _item$person === void 0 ? void 0 : _item$person.id,
      person_name: (_item$person2 = item.person) === null || _item$person2 === void 0 ? void 0 : _item$person2.name,
      value: item.value,
      type: item.type,
      currency: item.currency
    };
  };

  const getSearchResults = async searchValue => {
    setLoading(true);
    const searchResponse = await itemSearch(['deal', 'lead'], ['title'], searchValue);
    setLoading(false);
    return prioritizeDeal(searchResponse).map(({
      item
    }) => mapApiResultsToEntity(item));
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  return /*#__PURE__*/React.createElement(InputSelect, {
    inputProps: {
      onBlur: event => {
        event.persist();
        defer(() => {
          validate(event);
          onBlur(event);
        });
      },
      icon: 'deal',
      message: error || validationError,
      allowClear: allowClear && !isLoading
    },
    getSuggestionValue: getSuggestionValue,
    getSuggestions: getSearchResults,
    renderSuggestions: renderSuggestions,
    dropdownTrigger: 2,
    value: value,
    disabled: disabled,
    ...restProps
  });
};

var css_248z$n = ".ff_v531__Phone__phoneIcon__iJn{\n\tpadding:0 6px 0 4px;\n\theight:16px;\n\twidth:16px;\n}\n.ff_v531__Phone__arrow__2ut{\n\tdisplay:flex;\n}\n.ff_v531__Phone__phoneButton__1tJ{\n\ttext-align:left;\n\twhite-space:nowrap;\n\twidth:100%;\n}\n.ff_v531__Phone__phoneButton__1tJ:not(:first-child){\n\t\tmargin-top:4px;\n\t}\n.ff_v531__Phone__phoneLabel__1JE{\n\tcolor:#b9babb !important;\n\tmargin:0 6px;\n}\n.ff_v531__Phone__phoneValue__1AS{\n\tdisplay:flex;\n\twidth:100%;\n\tfont-size:13px;\n\toverflow:hidden;\n}\n.ff_v531__Phone__phoneValue__1AS a{\n\t\tcolor:#26292c;\n\t\ttext-decoration:none;\n\t\ttext-overflow:ellipsis;\n\t\toverflow:hidden;\n\t}\n";
var styles$n = {
  "phoneIcon": "ff_v531__Phone__phoneIcon__iJn",
  "arrow": "ff_v531__Phone__arrow__2ut",
  "phoneButton": "ff_v531__Phone__phoneButton__1tJ",
  "phoneLabel": "ff_v531__Phone__phoneLabel__1JE",
  "phoneValue": "ff_v531__Phone__phoneValue__1AS"
};
styleInject(css_248z$n);

const Caller = ({
  value,
  settings,
  locale,
  format
}) => {
  return /*#__PURE__*/React.createElement(Button, {
    className: styles$n.phoneButton,
    href: createPhoneLink(value.value, settings),
    size: "s"
  }, /*#__PURE__*/React.createElement(Icon, {
    className: styles$n.phoneIcon,
    icon: "call"
  }), /*#__PURE__*/React.createElement("div", {
    className: styles$n.phoneValue
  }, /*#__PURE__*/React.createElement("a", {
    href: `callto:${value.value}`
  }, formatPhoneNumber(value.value, locale, format)), value.label && /*#__PURE__*/React.createElement("div", {
    className: styles$n.phoneLabel
  }, "(", value.label, ")")), /*#__PURE__*/React.createElement("div", {
    className: styles$n.arrow
  }, /*#__PURE__*/React.createElement(Icon, {
    icon: "triangle-down",
    size: "s"
  })));
};

const getSelectedLabel = (item, options) => {
  var _options$find, _options$2;

  if (!item) {
    var _options$;

    return (_options$ = options[0]) === null || _options$ === void 0 ? void 0 : _options$.value;
  }

  return ((_options$find = options.find(option => option.value === item.label)) === null || _options$find === void 0 ? void 0 : _options$find.value) || ((_options$2 = options[0]) === null || _options$2 === void 0 ? void 0 : _options$2.value);
};
const getDefaultLabel = options => {
  var _options$find2;

  return ((_options$find2 = options.find(option => !option.disabled)) === null || _options$find2 === void 0 ? void 0 : _options$find2.value) || 'undefined';
}; // Parse value to determine if it's empty
// In this case return default value for select dropdown

const getInitialValue = (value = [], options, primary) => {
  if (isArray(value) && value.length && options[0]) {
    return value.reduce((arr, item, i) => {
      if (!item) {
        return arr;
      }

      const {
        value: labelValue
      } = item;
      const selectedLabel = getSelectedLabel(item, options);
      arr.push({
        value: labelValue,
        label: selectedLabel,
        primary: i === 0
      });
      return arr;
    }, []);
  }

  if (!isArray(value) && value) {
    const selectedLabel = getSelectedLabel(value, options);
    return [{ ...value,
      label: selectedLabel,
      primary
    }];
  }

  return [{
    value: '',
    label: getDefaultLabel(options),
    primary
  }];
}; // Parse value to make it alwasy array
const getTranslatedLabel = (options, label) => {
  var _options$find3;

  const translatedLabel = ((_options$find3 = options.find(option => option.value === (label === null || label === void 0 ? void 0 : label.toLowerCase()))) === null || _options$find3 === void 0 ? void 0 : _options$find3.label) || label;
  return capitalize(translatedLabel);
};

var css_248z$m = ".ff_v531__DefaultPhone__readValue__kUt{\n\tdisplay:flex;\n}\n.ff_v531__DefaultPhone__readLabel__Unf{\n\tcolor:#747678;\n\tword-break:normal;\n}\n";
var styles$m = {
  "readValue": "ff_v531__DefaultPhone__readValue__kUt",
  "readLabel": "ff_v531__DefaultPhone__readLabel__Unf"
};
styleInject(css_248z$m);

const getOptions$3 = translator => {
  return [{
    label: translator.gettext('Work'),
    value: 'work'
  }, {
    label: translator.gettext('Home'),
    value: 'home'
  }, {
    label: translator.gettext('Mobile'),
    value: 'mobile'
  }, {
    label: translator.gettext('Other'),
    value: 'other'
  }];
};

const DefaultPhoneRead$1 = ({
  value,
  settings,
  caller
}) => {
  const {
    translator,
    locale,
    phoneSettings
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  const options = getOptions$3(translator);
  const arrayValue = isArray(value) ? value : [value];
  const formatNumber = settings && settings.format_phone_numbers_enabled;
  return /*#__PURE__*/React.createElement("div", null, arrayValue.map(({
    value: labelValue,
    label
  }, i) => {
    if (caller) {
      return /*#__PURE__*/React.createElement(Caller, {
        value: {
          value: labelValue,
          label
        },
        settings: settings,
        format: formatNumber,
        locale: locale
      });
    }

    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: styles$m.readValue
    }, /*#__PURE__*/React.createElement(Link, {
      href: createPhoneLink(labelValue, settings, phoneSettings)
    }, formatPhoneNumber(labelValue, locale, formatNumber)), /*#__PURE__*/React.createElement("div", {
      className: styles$m.readLabel
    }, `(${getTranslatedLabel(options, label)})`));
  }));
};

var css_248z$l = ".ff_v531__InputSelectCompound__inputWrap__1_R{\n\tposition:relative;\n\tflex:1;\n}\n\n.ff_v531__InputSelectCompound__input__1kd{\n\twidth:100% !important;\n}\n\n.ff_v531__InputSelectCompound__select__1hE{\n\tflex:1;\n\tmargin-left:8px;\n\theight:32px;\n\tmax-width:50%;\n}\n\n.ff_v531__InputSelectCompound__select__1hE .cui4-input{\n\t\twidth:100%;\n\t}\n\n.ff_v531__InputSelectCompound__compoundComponent__3mN{\n\tdisplay:flex;\n\tflex-direction:row;\n}\n";
var styles$l = {
  "inputWrap": "ff_v531__InputSelectCompound__inputWrap__1_R",
  "input": "ff_v531__InputSelectCompound__input__1kd",
  "select": "ff_v531__InputSelectCompound__select__1hE",
  "compoundComponent": "ff_v531__InputSelectCompound__compoundComponent__3mN"
};
styleInject(css_248z$l);

const getValue$2 = (value, isDefaultValue) => {
  if (!isDefaultValue) {
    return {
      value
    };
  }

  return {
    defaultValue: value
  };
};
/**
 * A component used in Email, DefaultPhone, InstantMessage and Monetary fields.
 * Consists of Input and Select components.
 *
 * @param {InputSelectCompoundProps} props - Props for InputSelectCompoundProps
 * @returns {React.ReactElement<InputSelectCompoundProps>} InputSelectCompound component
 */


const InputSelectCompound = ({
  options = [],
  type,
  handleBlur: handleBlurProp,
  error,
  disabled,
  portalTo,
  inputRef,
  className,
  autofocus,
  filter,
  actionIcon,
  primary,
  onChange,
  inputValue,
  isDefaultValue,
  selectedLabel,
  selectProps = {},
  inputProps = {},
  placeholder,
  placement,
  onValidation
}) => {
  const selectRef = /*#__PURE__*/React.createRef();
  const [label, setLabel] = useState(selectedLabel);
  const [stateValue, setValue] = useState(inputValue);
  const [errorState, setError] = useState('');
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);
  const {
    className: inputClassName,
    ...restCuiInputProps
  } = inputProps;
  const {
    className: selectClassName,
    ...restCuiSelectProps
  } = selectProps;

  const onInputChange = event => {
    if (onChange) {
      setValue(event.currentTarget.value);
      onChange({
        value: event.currentTarget.value,
        label,
        primary
      });
    }
  };

  const onSelectChange = labelValue => {
    if (onChange) {
      setLabel(labelValue);
      onChange({
        value: stateValue,
        label: labelValue,
        primary
      });
    }
  };

  const scrollToSelected = async visible => {
    if (visible) {
      const SEARCH_BAR_HEIGHT = 49; // This await is to fix missing maxHeight from CUI on the dropdown init.

      const dropDownOptions = await selectRef.current.popupElement.current.querySelector('[class*=options]');
      const selectedElement = dropDownOptions.querySelector('.cui4-option-check');

      if (selectedElement && dropDownOptions.scrollTo) {
        const offset = selectedElement.parentElement.offsetTop > 8 ? selectedElement.parentElement.offsetTop : 0;
        dropDownOptions.scrollTo(0, offset - SEARCH_BAR_HEIGHT);
      }
    }
  };

  const handleBlur = e => {
    if (handleBlurProp) {
      handleBlurProp(e);
    } else {
      if (!handleValidation) {
        return;
      }

      const errorMessage = handleValidation({
        formValue: e,
        validate: getValidation
      });
      setError(errorMessage);
      onValidation && onValidation(!errorMessage);
    }
  };

  return /*#__PURE__*/React.createElement("div", {
    className: classNames(className, styles$l.compoundComponent)
  }, /*#__PURE__*/React.createElement("div", {
    className: styles$l.inputWrap
  }, /*#__PURE__*/React.createElement(Input, {
    className: classNames(inputClassName, styles$l.input),
    autoFocus: autofocus,
    ...getValue$2(inputValue, isDefaultValue),
    type: type,
    onBlur: handleBlur,
    onMouseOut: handleBlur,
    message: error || errorState,
    disabled: disabled,
    color: error ? 'red' : undefined,
    onChange: onInputChange,
    inputRef: inputRef,
    "data-testid": "compound-input",
    placeholder: placeholder,
    ...restCuiInputProps
  }), primary && actionIcon), /*#__PURE__*/React.createElement(Select, {
    className: classNames(selectClassName, styles$l.select),
    filter: filter,
    popperProps: popperProps,
    portalTo: portalTo,
    ...getValue$2(selectedLabel, isDefaultValue),
    onChange: onSelectChange,
    disabled: disabled,
    onVisibilityChange: scrollToSelected,
    ref: selectRef,
    // @ts-expect-error TODO: Check CUI types
    placement: placement,
    ...restCuiSelectProps
  }, options.map((option, key) => {
    const isCurrentLabel = selectedLabel === option.value;
    return /*#__PURE__*/React.createElement(Select.Option, {
      disabled: !isCurrentLabel && option.disabled,
      key: key,
      value: option.value
    }, option.label);
  })));
};

var css_248z$k = ".ff_v531__InputSelectAddMore__wrapper__1sY{\n\tdisplay:flex;\n\tflex-direction:column;\n}\n.ff_v531__InputSelectAddMore__itemWrap__w4T{\n\tdisplay:flex;\n}\n.ff_v531__InputSelectAddMore__item__3jk{\n\tpadding-bottom:5px;\n\twidth:100%;\n}\n.ff_v531__InputSelectAddMore__link__fxh{\n\tcursor:pointer;\n}\n.ff_v531__InputSelectAddMore__disabled__3f1 a{\n\t\tcolor:#747678;\n\t\tcursor:not-allowed;\n\t}\n.ff_v531__InputSelectAddMore__remove__340{\n\tmargin-left:5px;\n}\n";
var styles$k = {
  "wrapper": "ff_v531__InputSelectAddMore__wrapper__1sY",
  "itemWrap": "ff_v531__InputSelectAddMore__itemWrap__w4T",
  "item": "ff_v531__InputSelectAddMore__item__3jk",
  "link": "ff_v531__InputSelectAddMore__link__fxh",
  "disabled": "ff_v531__InputSelectAddMore__disabled__3f1",
  "remove": "ff_v531__InputSelectAddMore__remove__340"
};
styleInject(css_248z$k);

const InputSelectItem = ({
  selectedLabel,
  value,
  onChange,
  validate,
  options = [],
  error,
  onValidation,
  ...rest
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState('');

  const handleBlur = e => {
    if (!handleValidation) {
      return;
    }

    const errorMessage = handleValidation({
      formValue: e,
      validate
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  return /*#__PURE__*/React.createElement("div", {
    className: styles$k.item
  }, /*#__PURE__*/React.createElement(InputSelectCompound, {
    handleBlur: handleBlur,
    onChange: onChange,
    ...rest,
    inputValue: value,
    options: options,
    selectedLabel: selectedLabel,
    error: error || validationError
  }));
};

const InputSelectAddMore = ({
  value,
  options = [],
  onComponentChange = () => null,
  validate,
  single,
  disabled,
  isDefault,
  disableAdd,
  addMoreText,
  ...rest
}) => {
  const [items, setItems] = useState(() => getInitialValue(value, options, true));
  useEffect(() => {
    setItems(getInitialValue(value, options, true));
  }, [value]);

  const onChange = index => {
    return ({
      value: labelValue,
      label,
      primary
    }) => {
      const newArr = [...items];
      newArr.forEach(item => item.changed = false);
      newArr[index] = {
        value: labelValue,
        label,
        primary,
        changed: true
      };
      setItems(newArr);

      if (onComponentChange) {
        onComponentChange(single ? {
          value: labelValue,
          label
        } : newArr);
      }
    };
  };

  const handleRemove = index => {
    return () => {
      const newArr = [...items];
      newArr.splice(index, 1);
      setItems(newArr);

      if (onComponentChange) {
        onComponentChange(newArr);
      }
    };
  };

  const addMore = e => {
    e.preventDefault();
    const newArr = [...items, ...getInitialValue([], options, false)];
    setItems(newArr);

    if (onComponentChange) {
      onComponentChange(newArr);
    }
  };

  return /*#__PURE__*/React.createElement("div", {
    className: styles$k.wrapper
  }, /*#__PURE__*/React.createElement("section", null, items.map(({
    value: labelValue,
    label,
    primary
  }, i) => {
    return /*#__PURE__*/React.createElement("div", {
      key: `${i}${items.length}`,
      className: styles$k.itemWrap
    }, /*#__PURE__*/React.createElement(InputSelectItem, {
      selectedLabel: label,
      options: options,
      value: labelValue,
      validate: validate,
      onChange: onChange(i),
      primary: primary,
      onComponentChange: onComponentChange,
      disabled: disabled,
      isDefaultValue: isDefault,
      ...rest
    }), items.length > 1 && /*#__PURE__*/React.createElement(Button, {
      color: "ghost",
      onClick: handleRemove(i),
      className: styles$k.remove
    }, /*#__PURE__*/React.createElement(Icon, {
      icon: "trash"
    })));
  })), !single && !disableAdd && /*#__PURE__*/React.createElement(Text, {
    className: classNames({
      [styles$k.disabled]: disabled
    })
  }, /*#__PURE__*/React.createElement("a", {
    href: "#",
    className: styles$k.link,
    onClick: disabled ? noop : addMore
  }, "+ ", addMoreText)));
};

const DefaultPhone = ({
  onComponentChange,
  single = false,
  options: propsOptions,
  ...restProps
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation
  } = useValidation(translator);
  const options = propsOptions !== null && propsOptions !== void 0 && propsOptions.length ? propsOptions : getOptions$3(translator);
  return /*#__PURE__*/React.createElement(InputSelectAddMore, {
    single: single,
    onComponentChange: onComponentChange,
    validate: getValidation,
    options: options,
    addMoreText: translator.gettext('Add phone'),
    ...restProps
  });
};

var css_248z$j = ".ff_v531__Email__readValue__3v6{\n\tdisplay:flex;\n}\n.ff_v531__Email__readLabel__12q{\n\tcolor:#747678;\n\tword-break:normal;\n}\n";
var styles$j = {
  "readValue": "ff_v531__Email__readValue__3v6",
  "readLabel": "ff_v531__Email__readLabel__12q"
};
styleInject(css_248z$j);

const getOptions$2 = translator => {
  return [{
    label: translator.gettext('Work'),
    value: 'work'
  }, {
    label: translator.gettext('Home'),
    value: 'home'
  }, {
    label: translator.gettext('Other'),
    value: 'other'
  }];
};
const getTrimmedValue = items => {
  return [items].flat().map(({
    value,
    ...restProps
  }) => ({ ...restProps,
    value: isString(value) ? value.trim() : value
  }));
};
const getInitialValueTrimmed = value => {
  if (isNil(value)) {
    return value;
  }

  return getTrimmedValue(value);
};

const EmailRead = ({
  value,
  ccEmail,
  onClick
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  const bccLink = createBccLink(ccEmail);
  const options = getOptions$2(translator);
  const arrayValue = isArray(value) ? value : [value];
  return /*#__PURE__*/React.createElement(React.Fragment, null, arrayValue.map(({
    value: labelValue,
    label
  }, i) => {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: styles$j.readValue
    }, /*#__PURE__*/React.createElement(Link, {
      onClick: onClick,
      href: `mailto:${labelValue}${bccLink}`,
      value: labelValue
    }, labelValue), /*#__PURE__*/React.createElement("div", {
      className: styles$j.readLabel
    }, `(${getTranslatedLabel(options, label)})`));
  }));
};

const Email = ({
  value: passedValue,
  single = false,
  onComponentChange,
  options: propsOptions,
  ...rest
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getEmailValidation
  } = useValidation(translator);
  const options = propsOptions !== null && propsOptions !== void 0 && propsOptions.length ? propsOptions : getOptions$2(translator);
  const value = getInitialValueTrimmed(passedValue);

  const handleComponentChange = items => {
    onComponentChange(getTrimmedValue(items));
  };

  return /*#__PURE__*/React.createElement(InputSelectAddMore, {
    value: value,
    onComponentChange: handleComponentChange,
    validate: getEmailValidation,
    single: single,
    options: options,
    addMoreText: translator.gettext('Add email'),
    ...rest
  });
};

var css_248z$i = ".ff_v531__InstantMessage__readValue__3an{\n\tdisplay:flex;\n}\n\n.ff_v531__InstantMessage__readIM__1WR{\n\tpadding-right:4px;\n\tvertical-align:top;\n}\n";
var styles$i = {
  "readValue": "ff_v531__InstantMessage__readValue__3an",
  "readIM": "ff_v531__InstantMessage__readIM__1WR"
};
styleInject(css_248z$i);

const InstantMessageRead = ({
  value
}) => {
  if (!value) {
    return null;
  }

  const options = [{
    label: 'Google',
    value: 'google'
  }, {
    label: 'AIM',
    value: 'aim'
  }, {
    label: 'Yahoo',
    value: 'yahoo'
  }, {
    label: 'Skype',
    value: 'skype'
  }, {
    label: 'QQ',
    value: 'qq'
  }, {
    label: 'ICQ',
    value: 'icq'
  }, {
    label: 'MSN',
    value: 'msn'
  }, {
    label: 'Jabber',
    value: 'jabber'
  }, {
    label: 'iCloud',
    value: 'icloud'
  }];
  const arrayValues = isArray(value) ? value : [value];
  return /*#__PURE__*/React.createElement(React.Fragment, null, arrayValues.map(({
    value: labelValue,
    label
  }, i) => {
    const selected = options.find(option => option.value === String(label.toLowerCase()));
    const selectedLabel = selected ? selected.label : options[0].label;
    return /*#__PURE__*/React.createElement("div", {
      className: styles$i.readValue,
      key: i
    }, /*#__PURE__*/React.createElement("div", {
      className: styles$i.readIM
    }, labelValue), /*#__PURE__*/React.createElement("div", null, `(${capitalize(selectedLabel)})`));
  }));
};

const InstantMessage = ({
  value,
  onComponentChange,
  error,
  single = false,
  options: propsOptions,
  onValidation,
  ...rest
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState('');
  const defaultOptions = [{
    label: 'Google',
    value: 'google'
  }, {
    label: 'AIM',
    value: 'aim'
  }, {
    label: 'Yahoo',
    value: 'yahoo'
  }, {
    label: 'Skype',
    value: 'skype'
  }, {
    label: 'QQ',
    value: 'qq'
  }, {
    label: 'ICQ',
    value: 'icq'
  }, {
    label: 'MSN',
    value: 'msn'
  }, {
    label: 'Jabber',
    value: 'jabber'
  }, {
    label: 'iCloud',
    value: 'icloud'
  }];

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const options = propsOptions !== null && propsOptions !== void 0 && propsOptions.length ? propsOptions : defaultOptions;
  const labelValue = value ? value.value : '';
  return /*#__PURE__*/React.createElement(InputSelectAddMore, {
    single: single,
    value: value,
    onComponentChange: onComponentChange,
    validate: getValidation,
    handleBlur: validate,
    inputValue: labelValue,
    error: error || validationError,
    options: options,
    addMoreText: translator.gettext('Add instant messenger'),
    ...rest
  });
};

const LabelRead = ({
  value
}) => {
  if (!(value !== null && value !== void 0 && value.color)) {
    return null;
  }

  const {
    color,
    label
  } = value;
  return /*#__PURE__*/React.createElement(Badge, {
    color: color
  }, label);
};

var css_248z$h = ".ff_v531__Label__label__3Dv{\n\twidth:100%;\n}\n";
var styles$h = {
  "label": "ff_v531__Label__label__3Dv"
};
styleInject(css_248z$h);

const getOptions$1 = (options, translator) => {
  const translatedLabel = translator.gettext('(none)');

  if (!options.length || options[0].id !== '') {
    return [{
      label: translatedLabel,
      color: '',
      id: ''
    }].concat(options);
  }

  return options;
};
const getValue$1 = value => {
  return (value === null || value === void 0 ? void 0 : value.id) || '';
};

const Label = ({
  value,
  options = [],
  placeholder = ' ',
  disabled = false,
  portalTo,
  onComponentChange,
  selectProps,
  fieldType,
  fieldKey,
  error
}) => {
  const [selected, setSelected] = useState(getValue$1(value));
  const {
    translator,
    fields
  } = parseContext(useContext(FormFieldsContext));
  const [optionsState, setOptionsState] = useState(() => initOptions(fields, options, fieldType, fieldKey));
  useEffect(() => {
    setSelected(getValue$1(value));
  }, [value]);
  useEffect(() => setOptionsState(getOptions$1(optionsState, translator)), []);

  const onSelectChange = newSelected => {
    const selectedLabel = optionsState && optionsState.find(label => label.id === newSelected);
    setSelected(newSelected);

    if (onComponentChange) {
      onComponentChange(selectedLabel);
    }
  };

  const className = `${styles$h.label} ${error ? errorStyles.select : ''}`;
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Select, {
    popperProps: popperProps,
    value: selected,
    disabled: disabled,
    placeholder: placeholder,
    onChange: onSelectChange,
    portalTo: portalTo,
    className: className,
    ...selectProps
  }, optionsState.map(({
    id,
    label,
    color
  }) => {
    if (color === null || id === null || !label) {
      return null;
    }

    return /*#__PURE__*/React.createElement(Select.Option, {
      key: id,
      value: id
    }, id ? /*#__PURE__*/React.createElement(Badge, {
      color: color
    }, label) : label);
  })), /*#__PURE__*/React.createElement(Error$1, {
    message: error
  }));
};

const MonetaryRead = ({
  value
}) => {
  const {
    formatter,
    currencies
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  let code = currencies ? currencies[0].code : 'EUR';
  const {
    label,
    value: labelValue = ''
  } = value;
  const selected = find$1(currencies, {
    code: label
  });

  if (selected) {
    code = selected.code;
  } // @ts-expect-error TODO: library defines as `Number` requirement but takes also `String`


  const formattedValue = formatter.format(labelValue, code);
  return /*#__PURE__*/React.createElement(React.Fragment, null, formattedValue);
};

// while returning `code` for default state/established currencies.

const getCurrencySymbol = ({
  is_custom_flag,
  symbol,
  code
}) => {
  if (is_custom_flag) {
    return symbol;
  }

  return code;
};
const getMonetaryOptions = currencies => {
  if (!currencies) {
    return [];
  }

  return currencies.reduce((accumulator, currency) => {
    if (currency.active_flag) {
      accumulator.push({
        label: `${currency.name} (${getCurrencySymbol(currency)})`,
        value: currency.code,
        symbol: currency.symbol
      });
    }

    return accumulator;
  }, []);
};
const getLabel = (options, defaultCurrency, labelValue) => {
  if (labelValue) {
    var _options$;

    const selectedCurrency = options.find(option => option.value === labelValue);
    const selectedCurrencyLabel = selectedCurrency ? selectedCurrency.value : (_options$ = options[0]) === null || _options$ === void 0 ? void 0 : _options$.value;
    return selectedCurrencyLabel;
  } else {
    const currencyResult = options.find(el => el.value === defaultCurrency);

    if (currencyResult) {
      return currencyResult.value;
    } else {
      var _options$2;

      return (_options$2 = options[0]) === null || _options$2 === void 0 ? void 0 : _options$2.value;
    }
  }
};
const getValue = (value, defaultValue) => {
  if (!isUndefined(value) && !isUndefined(value === null || value === void 0 ? void 0 : value.value)) {
    return String(value.value);
  }

  if (!isUndefined(defaultValue) && !isUndefined(defaultValue === null || defaultValue === void 0 ? void 0 : defaultValue.value)) {
    return String(defaultValue.value);
  }

  return;
};

const MonetaryComponent = ({
  disabled,
  value,
  defaultValue,
  onComponentChange,
  error,
  inputProps,
  selectProps,
  portalTo,
  onValidation,
  ...rest
}) => {
  delete rest.options;
  const isDefault = !!isUndefined(defaultValue) && isUndefined(value);
  const {
    translator,
    defaultCurrency,
    currencies = [],
    formatter
  } = parseContext(useContext(FormFieldsContext));
  const options = getMonetaryOptions(currencies) || [];
  const {
    getNumberValidation,
    handleValidation
  } = useValidation(translator);
  const [labelState, setLabel] = useState(getLabel(options, defaultCurrency, (value === null || value === void 0 ? void 0 : value.label) || (defaultValue === null || defaultValue === void 0 ? void 0 : defaultValue.label)));
  const [validationError, setValidationError] = useState(error);
  useEffect(() => {
    const tmp = getLabel(options, defaultCurrency, value === null || value === void 0 ? void 0 : value.label);
    setLabel(tmp);
  }, [value]);

  const onChange = ({
    value: labelValue,
    label
  }) => {
    const values = {
      label,
      value: labelValue
    };
    setLabel(label);

    if (onComponentChange) {
      onComponentChange(values);
    }
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getNumberValidation,
      monetary: true,
      formatter
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const monetaryValue = getValue(value, defaultValue);
  return /*#__PURE__*/React.createElement(InputSelectCompound, {
    inputProps: inputProps,
    selectProps: selectProps,
    filter: true,
    options: options,
    error: error || validationError,
    disabled: disabled,
    selectedLabel: labelState,
    inputValue: monetaryValue,
    handleBlur: validate,
    onChange: onChange,
    isDefaultValue: isDefault,
    onComponentChange: onComponentChange,
    portalTo: portalTo,
    ...rest
  });
};

const MultipleContactsRead = ({
  value,
  openLinksInNewTab = false
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  return /*#__PURE__*/React.createElement("span", null, value.map((person, i) => {
    const separator = i === value.length - 1 ? '' : ', ';
    const content = person.is_hidden ? `(${translator.gettext('hidden')})` : /*#__PURE__*/React.createElement(Link, {
      openLinksInNewTab: openLinksInNewTab,
      href: `/person/${person.id}`
    }, person.name);
    return /*#__PURE__*/React.createElement("span", {
      key: i,
      "data-testid": "contact"
    }, content, separator);
  }));
};

const getPersons = async personValue => {
  const persons = await find(DataTypes.person, personValue);
  return persons === null || persons === void 0 ? void 0 : persons.items.map(({
    item: person
  }) => {
    var _person$organization, _person$organization2;

    const formattedName = `${person.name}${person.organization ? ` (${person.organization.name})` : ''}`;
    const hasEmail = person.emails.length > 0;
    const hasPhone = person.phones.length > 0;
    const details = hasEmail ? person.emails[0] : hasPhone ? person.phones[0] : null;
    return {
      id: person.id,
      name: person.name,
      formattedName,
      details,
      is_hidden: person.is_hidden,
      email: hasEmail ? person.emails[0] : null,
      org_id: (_person$organization = person.organization) === null || _person$organization === void 0 ? void 0 : _person$organization.id,
      org_name: (_person$organization2 = person.organization) === null || _person$organization2 === void 0 ? void 0 : _person$organization2.name
    };
  });
};

const getOrganizations = async orgValue => {
  const organizations = await find(DataTypes.org, orgValue);
  return organizations === null || organizations === void 0 ? void 0 : organizations.items.map(({
    item: organization
  }) => ({
    id: organization.id,
    name: organization.name,
    details: organization.address
  }));
};

var css_248z$g = ".ff_v531__InputMultiSelect__wrapper__2ay{\n\tdisplay:flex;\n\tposition:relative;\n\tborder:1px solid #cbcccd;\n\tborder-radius:2px;\n\tbackground:#ffffff;\n\tbox-shadow:inset 0 1px 2px #eeeeee;\n\tflex-wrap:wrap;\n\talign-items:center;\n\twidth:unset;\n}\n\n\t.ff_v531__InputMultiSelect__wrapper__2ay > .ff_v531__InputMultiSelect__selectedTag__9LT{\n\t\tmargin:4px 0 4px 8px;\n\t}\n\n\t.ff_v531__InputMultiSelect__wrapper__2ay > .ff_v531__InputMultiSelect__selectedTag__9LT .cui4-tag__content{\n\t\t\tcolor:#26292c;\n\t\t\tdisplay:flex;\n\t\t\talign-items:center;\n\t\t}\n\n\t.ff_v531__InputMultiSelect__wrapper__2ay > .ff_v531__InputMultiSelect__selectedTag__9LT ~ .ff_v531__InputMultiSelect__selectedTag__9LT{\n\t\tmargin-left:4px;\n\t}\n\n\t.ff_v531__InputMultiSelect__wrapper__2ay:focus-within{\n\t\tborder-color:#317ae2;\n\t}\n\n\t.ff_v531__InputMultiSelect__wrapper__2ay.ff_v531__InputMultiSelect__errorWrapper__15O{\n\t\tborder:1px solid #f94839;\n\t}\n\n\t.ff_v531__InputMultiSelect__disabledInputWrapper__TGK{\n\tbackground-color:#f7f7f7;\n}\n\n\t.ff_v531__InputMultiSelect__inputIcon__3-i{\n\tmargin-left:8px;\n}\n\n\t.ff_v531__InputMultiSelect__input__ZAT{\n\tmin-width:150px;\n\tflex:1;\n}\n\n\t.ff_v531__InputMultiSelect__input__ZAT input[type='text']{\n\t\tborder:none;\n\t\tbox-shadow:none;\n\t\tmin-width:150px;\n\t\tflex:1;\n\t\tbackground:transparent;\n\t}\n\n\t.ff_v531__InputMultiSelect__input__ZAT input[type='text']:focus{\n\t\t\toutline:none;\n\t\t\tborder:none;\n\t\t\tbox-shadow:none;\n\t\t}\n\n\t.ff_v531__InputMultiSelect__tagWarning__3Zy{\n\tmargin:0 2px 0 4px;\n}\n\n\t.ff_v531__InputMultiSelect__newBadge__3ZK, .ff_v531__InputMultiSelect__loadingSpinner__2KZ{\n\tposition:absolute;\n\tright:6px;\n\ttop:calc(50% - 8px);\n}\n\n\t.ff_v531__InputMultiSelect__popover__jfH{\n\tz-index:6001;\n}\n";
var styles$g = {
  "wrapper": "ff_v531__InputMultiSelect__wrapper__2ay",
  "selectedTag": "ff_v531__InputMultiSelect__selectedTag__9LT",
  "errorWrapper": "ff_v531__InputMultiSelect__errorWrapper__15O",
  "disabledInputWrapper": "ff_v531__InputMultiSelect__disabledInputWrapper__TGK",
  "inputIcon": "ff_v531__InputMultiSelect__inputIcon__3-i",
  "input": "ff_v531__InputMultiSelect__input__ZAT",
  "tagWarning": "ff_v531__InputMultiSelect__tagWarning__3Zy",
  "newBadge": "ff_v531__InputMultiSelect__newBadge__3ZK",
  "loadingSpinner": "ff_v531__InputMultiSelect__loadingSpinner__2KZ",
  "popover": "ff_v531__InputMultiSelect__popover__jfH"
};
styleInject(css_248z$g);

const ClearIcon = ({
  isLoading,
  allowClear,
  selectedItems,
  setSelectedItems,
  onComponentChange,
  clearInput
}) => {
  if (!(!isLoading && allowClear && selectedItems && selectedItems.length)) {
    return null;
  }

  return /*#__PURE__*/React.createElement(Icon, {
    size: "s",
    icon: "cross",
    className: "cui4-input__clear",
    onClick: () => {
      setSelectedItems([]);
      onComponentChange([]);
      clearInput();
    }
  });
};

/**
 * A component used in MultipleContacts fields.
 * Similar to InputSelect component, displays the values returned from getSuggestions function as Select options.
 * When selecting an item, adds it to the input as a Tag element.
 * Typically performs a request to /search endpoint, but can also be used as a generic Autocomplete field.
 *
 * @template T - Type of the suggestion
 * @param {InputMultiSelectProps<T>} props - Props for InputMultiSelectProps
 * @returns {React.ReactElement<DownshiftProps<T>, string>} Downshift component
 */

function InputMultiSelect({
  getSuggestions = inputValue => Promise.resolve([]),
  getSuggestionValue: passedGetSuggestionValue,
  suggestionValueKey = 'name',
  className,
  portalTo,
  placement = 'bottom-start',
  suggestionIcon,
  renderSuggestions,
  renderSelectedItem,
  getSuggestionIcon = _ => suggestionIcon || '',
  error,
  value,
  warning,
  disabled,
  dropdownTrigger = 0,
  onComponentChange = () => null,
  searchDelay = 500,
  placeholder,
  inputProps = {},
  dropmenuProps = {},
  tagProps = {},
  downshiftProps = {},
  allowNewItems,
  maxSelectedItems
}) {
  const inputRef = useRef(null);
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const [isLoading, setIsLoading] = useState(false);
  const [suggestions, setSuggestions] = useState(null);
  const [selectedItems, setSelectedItems] = useState(value || []);
  useEffect(() => {
    setSelectedItems(value || []);
  }, [value]);

  const getSuggestionValue = item => {
    if (!item) {
      return '';
    }

    if (!passedGetSuggestionValue) {
      return item[suggestionValueKey];
    }

    return passedGetSuggestionValue(item);
  };

  const onInputValueChange = async (inputValue, {
    selectedItem
  }) => {
    if (!inputValue || dropdownTrigger > inputValue.length || isLoading || selectedItem && getSuggestionValue(selectedItem) === inputValue) {
      setSuggestions(null);
      return;
    }

    setIsLoading(true);

    try {
      const results = await getSuggestions(inputValue);
      const uniqueResults = differenceWith(results, selectedItems, isEqual);
      setIsLoading(false);
      setSuggestions(uniqueResults);
    } catch (error) {
      setIsLoading(false);
    }
  };

  const removeItem = index => {
    const filteredItems = selectedItems.filter((item, itemIndex) => itemIndex !== index);
    setSelectedItems(filteredItems);
    onComponentChange(filteredItems);
  };

  const onSelect = (selectedItem, {
    setState
  }) => {
    if (!selectedItem) {
      return;
    }

    const itemAlreadySelected = find$1(selectedItems, item => isEqual(item, selectedItem));
    const items = [...selectedItems, selectedItem];

    if (!itemAlreadySelected) {
      setSelectedItems(items);
    }

    if (items.length) {
      onComponentChange(items);
    }

    setState({
      inputValue: ''
    });
    setSuggestions(null);
  };

  const renderSelectedItems = () => {
    return selectedItems.map((item, index) => {
      if (renderSelectedItem) {
        return /*#__PURE__*/React.createElement("div", {
          className: styles$g.selectedTag,
          key: `${item}${index}`
        }, renderSelectedItem({
          item,
          index,
          isLoading
        }, {
          removeItem
        }));
      }

      return /*#__PURE__*/React.createElement(Tag, {
        dismissable: !disabled,
        key: `${item}${index}`,
        onDismiss: () => removeItem(index),
        className: styles$g.selectedTag,
        ...tagProps
      }, getSuggestionValue(item), warning && /*#__PURE__*/React.createElement(Tooltip, {
        placement: "top",
        content: /*#__PURE__*/React.createElement("span", null, warning)
      }, /*#__PURE__*/React.createElement(Icon, {
        size: "s",
        icon: "warning-outline",
        color: "yellow",
        className: styles$g.tagWarning
      })), item.is_new && /*#__PURE__*/React.createElement(Badge, {
        color: "blue"
      }, translator.gettext('new')));
    });
  };

  const addNewItem = (newValue, state) => {
    const newItem = {
      [suggestionValueKey]: newValue,
      is_new: true
    };
    onSelect(newItem, state);
  };

  const renderDefaultSuggestions = (getItemProps, highlightedIndex) => {
    return (suggestions || []).map((item, index) => /*#__PURE__*/React.createElement("div", { ...getItemProps({
        item,
        index
      }),
      key: `${item}${index}`
    }, /*#__PURE__*/React.createElement(Option, {
      highlighted: highlightedIndex === index,
      className: classNames(styles$g.suggestion)
    }, suggestionIcon && /*#__PURE__*/React.createElement(Icon, {
      icon: getSuggestionIcon(item),
      size: "s",
      color: "black-64",
      className: styles$g.suggestionIcon
    }), getSuggestionValue(item))));
  };

  const renderInput = state => {
    const {
      getInputProps,
      setState,
      clearSelection
    } = state;
    const {
      ref,
      value: inputValue,
      onKeyDown,
      ...restDownshiftInputProps
    } = getInputProps();
    const {
      allowClear,
      className: inputClassName,
      icon,
      onBlur,
      ...restCuiInputProps
    } = inputProps;
    const isDisabled = isNumber(maxSelectedItems) && selectedItems.length >= maxSelectedItems || disabled;

    const clearInput = () => {
      clearSelection();
      setState({
        inputValue: ''
      });
    };

    return /*#__PURE__*/React.createElement("div", {
      className: classNames(className, 'cui4-input__box')
    }, /*#__PURE__*/React.createElement("div", {
      className: classNames('cui4-input', styles$g.input, inputClassName)
    }, /*#__PURE__*/React.createElement("div", {
      className: classNames(styles$g.wrapper, isDisabled && styles$g.disabledInputWrapper, error && styles$g.errorWrapper),
      ref: inputRef
    }, !!icon && /*#__PURE__*/React.createElement(Icon, {
      icon: icon,
      size: "s",
      className: styles$g.inputIcon
    }), renderSelectedItems(), /*#__PURE__*/React.createElement(Input, {
      className: classNames(inputClassName, styles$g.input),
      style: {
        paddingRight: allowClear ? '26px' : '12px'
      },
      placeholder: placeholder,
      value: inputValue,
      disabled: isDisabled,
      ...restCuiInputProps,
      ...restDownshiftInputProps,
      onKeyDown: event => {
        onKeyDown(event);

        if (event.key === 'Enter' && allowNewItems && !(suggestions !== null && suggestions !== void 0 && suggestions.length) && inputValue) {
          addNewItem(inputValue, state);
          clearInput();
        }
      },
      onBlur: event => {
        if (onBlur) {
          onBlur(event);
        }

        if (allowNewItems && inputValue) {
          addNewItem(inputValue, state);
        }

        clearInput();
      }
    })), /*#__PURE__*/React.createElement(ClearIcon, {
      isLoading: isLoading,
      allowClear: allowClear,
      selectedItems: selectedItems,
      setSelectedItems: setSelectedItems,
      onComponentChange: onComponentChange,
      clearInput: clearInput
    }), isLoading && /*#__PURE__*/React.createElement(Spinner, {
      className: styles$g.loadingSpinner,
      size: "s"
    })));
  };

  const renderDropMenu = (state, children) => {
    const {
      isOpen,
      highlightedIndex,
      getItemProps,
      setHighlightedIndex,
      inputValue
    } = state;
    const width = inputRef.current ? inputRef.current.clientWidth : 'auto';
    const renderDropmenuSuggestions = renderSuggestions ? renderSuggestions(suggestions || []) : renderDefaultSuggestions;
    const isVisible = isOpen && !!inputValue && inputValue.length >= dropdownTrigger && !!suggestions;
    return /*#__PURE__*/React.createElement(Dropmenu, {
      content: /*#__PURE__*/React.createElement("div", {
        style: {
          width
        }
      }, isOpen && renderDropmenuSuggestions(getItemProps, highlightedIndex, setHighlightedIndex, inputValue || '')),
      popoverProps: {
        className: styles$g.popover,
        portalTo,
        placement,
        spacing: 'none',
        visible: isVisible
      },
      ...dropmenuProps
    }, children);
  };

  const stateReducer = (state, changes) => {
    switch (changes.type) {
      case Downshift.stateChangeTypes.mouseUp:
      case Downshift.stateChangeTypes.keyDownEscape:
        return { ...changes,
          inputValue: ''
        };

      default:
        return changes;
    }
  };

  return /*#__PURE__*/React.createElement(Downshift, {
    onInputValueChange: useCallback(debounce(onInputValueChange, searchDelay), []),
    stateReducer: stateReducer,
    itemToString: getSuggestionValue,
    onSelect: onSelect,
    defaultHighlightedIndex: 0,
    ...downshiftProps
  }, state => {
    return /*#__PURE__*/React.createElement("div", null, renderDropMenu(state, renderInput(state)));
  });
}

var SearchDataTypes;

(function (SearchDataTypes) {
  SearchDataTypes["organization"] = "organizations";
  SearchDataTypes["person"] = "persons";
})(SearchDataTypes || (SearchDataTypes = {}));

var css_248z$f = ".ff_v531__MultipleContacts__squeezedInput__3ot input{\n\tmax-height:30px;\n}\n";
var styles$f = {
  "squeezedInput": "ff_v531__MultipleContacts__squeezedInput__3ot"
};
styleInject(css_248z$f);

const MultipleContacts = ({
  onComponentChange,
  allowClear = false,
  allowNewItems = false,
  searchType = SearchDataTypes.person,
  getSuggestions,
  ...restProps
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);

  const renderContactSuggestions = persons => (getItemProps, highlightedIndex, setHighlightedIndex, inputValue) => {
    return /*#__PURE__*/React.createElement(EntitySuggestions, {
      inputValue: inputValue,
      items: persons,
      highlightedIndex: highlightedIndex,
      setHighlightedIndex: setHighlightedIndex,
      getItemProps: getItemProps,
      type: "person",
      allowNewItem: allowNewItems,
      texts: {
        tooltip: translator.gettext('Show organization details'),
        addNew: translator.gettext("Add '%s' as new contact", inputValue)
      },
      suggestionValueKey: "name"
    });
  };

  const validate = event => {
    handleValidation({
      formValue: event,
      validate: getValidation
    });
  };

  const getSuggestionValue = person => {
    if (person.is_hidden) {
      return translator.gettext('(hidden)');
    }

    return person.name;
  };

  const isPersonDataType = searchType === SearchDataTypes.person;
  return /*#__PURE__*/React.createElement(InputMultiSelect, {
    getSuggestionValue: getSuggestionValue,
    suggestionValueKey: "name",
    getSuggestions: isPersonDataType ? getPersons : getOrganizations,
    renderSuggestions: renderContactSuggestions,
    dropdownTrigger: 2,
    inputProps: {
      onBlur: validate,
      icon: isPersonDataType ? 'person' : 'organization',
      allowClear,
      className: styles$f.squeezedInput
    },
    onComponentChange: onComponentChange,
    allowNewItems: allowNewItems,
    ...restProps
  });
};

var css_248z$e = ".ff_v531__MultipleOptions__container__M1Q{\n\twidth:100%;\n}\n\n.ff_v531__MultipleOptions__tag__3yR{\n\tmargin-left:5px;\n\tmargin-top:5px;\n}\n\n.ff_v531__MultipleOptions__row__26w{\n\tdisplay:flex;\n\tflex-wrap:wrap;\n}\n\n.ff_v531__MultipleOptions__readWrapper__11P{\n\tdisplay:flex;\n\tflex-wrap:wrap;\n\tmargin:0;\n}\n\n.ff_v531__MultipleOptions__readWrapper__11P li{\n\t\tmargin-right:4px;\n\t\tmargin-bottom:4px;\n\t}\n";
var styles$e = {
  "container": "ff_v531__MultipleOptions__container__M1Q",
  "tag": "ff_v531__MultipleOptions__tag__3yR",
  "row": "ff_v531__MultipleOptions__row__26w",
  "readWrapper": "ff_v531__MultipleOptions__readWrapper__11P"
};
styleInject(css_248z$e);

function getInitValues(value) {
  if (isString(value)) {
    return value.split(',');
  }

  if (isArray(value) && isObject(value[0])) {
    return value.map(({
      id
    }) => String(id));
  }

  if (isArray(value)) {
    return value.map(val => String(val));
  }

  return value;
}

const getSelectedOptions = (values, options) => {
  if (isArray(values) && options) {
    return filter(options, option => values.includes(String(option.id))) || [];
  }

  return [];
};

const MultipleOptionsRead = ({
  value,
  options,
  fieldType,
  fieldKey
}) => {
  const {
    fields
  } = parseContext(useContext(FormFieldsContext));
  const [optionsState] = useState(() => initOptions(fields, options, fieldType, fieldKey));

  if (!value) {
    return null;
  }

  const selectedOptions = getSelectedOptions(getInitValues(value), optionsState);
  const selectedTags = selectedOptions.map((tag, index) => /*#__PURE__*/React.createElement("li", {
    key: index,
    className: styles$e.choiceItem
  }, /*#__PURE__*/React.createElement(Tag, null, tag.label)));
  return /*#__PURE__*/React.createElement("ul", {
    className: styles$e.readWrapper
  }, selectedTags);
};

const MultipleOptions = ({
  onComponentChange,
  disabled = false,
  selectProps,
  placeholder = '  ',
  defaultValue,
  value = defaultValue,
  options,
  filter: filterProp = options.length >= 5,
  fieldType,
  fieldKey,
  error,
  portalTo
}) => {
  const {
    fields
  } = parseContext(useContext(FormFieldsContext));
  const [optionsState] = useState(() => initOptions(fields, options, fieldType, fieldKey));

  const initTags = () => {
    if (value && optionsState) {
      const values = getInitValues(value);
      const initValues = filter(optionsState, option => {
        return values.includes(String(option.id));
      });
      return initValues || [];
    }

    return [];
  };

  const [tagsState, setTags] = useState(initTags);
  useEffect(() => {
    setTags(initTags());
  }, [value]);

  const handleChange = tags => {
    setTags(tags);

    if (onComponentChange) {
      onComponentChange(tags);
    }
  };

  const onSuggestionSelected = data => {
    const selectedValue = optionsState.filter(option => data && data.includes(option.id));

    if (onComponentChange) {
      onComponentChange(selectedValue);
    }
  };

  const autocompleteRenderInput = ({
    addTag
  }) => {
    const selectedIds = tagsState.map(tag => tag.id);

    const onSelectChange = data => onSuggestionSelected(data);

    const className = `${styles$e.container} ${error ? errorStyles.select : ''}`;
    return /*#__PURE__*/React.createElement(Select, {
      disabled: disabled,
      popperProps: popperProps,
      portalTo: portalTo,
      className: className,
      allowClear: true,
      placeholder: placeholder,
      filter: filterProp,
      multiple: true,
      onChange: onSelectChange,
      ...getValue$3({
        value,
        defaultValue,
        callback: () => selectedIds
      }),
      ...selectProps
    }, optionsState.map(el => /*#__PURE__*/React.createElement(Select.Option, {
      key: el.id,
      value: el.id
    }, el.label)));
  };

  const renderLayout = (tagComponents, inputComponent) => {
    return /*#__PURE__*/React.createElement("div", {
      tabIndex: 1
    }, /*#__PURE__*/React.createElement("div", {
      className: styles$e.row
    }, inputComponent));
  };

  const renderTag = renderProps => {
    const {
      tag,
      key,
      onRemove,
      getTagDisplayValue
    } = renderProps;

    const onDismiss = () => onRemove(key);

    return /*#__PURE__*/React.createElement(Tag, {
      key: key,
      disabled: disabled,
      className: styles$e.tag,
      dismissable: true,
      onDismiss: onDismiss
    }, getTagDisplayValue(tag.label));
  };

  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(TagsInput, {
    value: tagsState,
    renderInput: autocompleteRenderInput,
    onChange: handleChange,
    renderLayout: renderLayout,
    renderTag: renderTag,
    disabled: disabled
  }), /*#__PURE__*/React.createElement(Error$1, {
    message: error
  }));
};

const NumberRead = ({
  value
}) => {
  const {
    formatter
  } = parseContext(useContext(FormFieldsContext));

  if (isNil(value)) {
    return null;
  } // @ts-expect-error TODO: fix needed in library as code marks `decimals Decimal places (optional)`


  const numberValue = formatter.formatNumber(value);
  return /*#__PURE__*/React.createElement(React.Fragment, null, numberValue);
};

const NumberComponent = ({
  value,
  defaultValue,
  disabled,
  autofocus,
  onComponentChange,
  error,
  inputProps,
  placeholder,
  onValidation
}) => {
  const {
    translator,
    formatter
  } = parseContext(useContext(FormFieldsContext));
  const [validationError, setValidationError] = useState('');
  const {
    getNumberValidation,
    handleValidation
  } = useValidation(translator);

  const onChange = event => {
    onComponentChange(event.currentTarget.value);
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getNumberValidation,
      monetary: false,
      formatter
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  return /*#__PURE__*/React.createElement(Input, { ...getValue$3({
      value,
      defaultValue
    }),
    autoFocus: autofocus,
    type: "text",
    message: error || validationError,
    color: error || validationError ? 'red' : undefined,
    onBlur: validate,
    onMouseOut: validate,
    onChange: onChange,
    disabled: disabled,
    placeholder: placeholder,
    ...inputProps
  });
};

const OrganizationRead = ({
  value,
  openLinksInNewTab
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  if (value.is_hidden) {
    return /*#__PURE__*/React.createElement("span", null, "(", translator.gettext('hidden'), ")");
  }

  return /*#__PURE__*/React.createElement(Link, {
    openLinksInNewTab: openLinksInNewTab,
    href: `/organization/${value.id}`
  }, value.name);
};

const Organization = ({
  disabled = false,
  value,
  error,
  showNewLabel = false,
  allowNewItem,
  onBlur = noop,
  onValidation,
  ...restProps
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const [validationError, setValidationError] = useState('');
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);

  const renderOrgSuggestions = organizations => (getItemProps, highlightedIndex, setHighlightedIndex, inputValue) => {
    return /*#__PURE__*/React.createElement(EntitySuggestions, {
      inputValue: inputValue,
      items: organizations,
      highlightedIndex: highlightedIndex,
      setHighlightedIndex: setHighlightedIndex,
      getItemProps: getItemProps,
      type: "organization",
      allowNewItem: allowNewItem,
      texts: {
        tooltip: translator.gettext('Show organization details'),
        addNew: translator.gettext("Add '%s' as new organization", inputValue)
      }
    });
  };

  const getSuggestionValue = suggestion => {
    if (typeof suggestion === 'string') {
      return suggestion;
    }

    return suggestion.name;
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const getIsOrgNew = orgValue => {
    if (isObject(orgValue)) {
      return !orgValue.id;
    }

    if (isString(orgValue)) {
      return true;
    }

    return false;
  };

  const getSuggestions = async searchValue => {
    const organizations = await getOrganizations(searchValue);

    if (allowNewItem) {
      organizations.push(ADD_NEW_DUMMY_ITEM);
    }

    return organizations;
  };

  return /*#__PURE__*/React.createElement(InputSelect, {
    inputProps: {
      onBlur: event => {
        event.persist();
        defer(() => {
          validate(event);
          onBlur(event);
        });
      },
      icon: 'organization',
      message: error || validationError
    },
    getSuggestionValue: getSuggestionValue,
    getSuggestions: getSuggestions,
    renderSuggestions: renderOrgSuggestions,
    isNewValue: isString,
    dropdownTrigger: 2,
    allowNewItem: allowNewItem,
    showNewLabel: showNewLabel || getIsOrgNew(value),
    value: value,
    disabled: disabled,
    ...restProps
  });
};

const PercentageRead = ({
  value
}) => {
  if (!value) {
    return null;
  }

  return /*#__PURE__*/React.createElement(React.Fragment, null, `${value || ''}%`);
};

var css_248z$d = ".ff_v531__Percentage__percentage__1V0 input::-webkit-outer-spin-button, .ff_v531__Percentage__percentage__1V0 input::-webkit-inner-spin-button{\n\t\t-webkit-appearance:none;\n\t\tmargin:0;\n\t}\n";
var styles$d = {
  "percentage": "ff_v531__Percentage__percentage__1V0"
};
styleInject(css_248z$d);

const PercentageComponent = ({
  value,
  defaultValue,
  disabled,
  onComponentChange,
  inputProps,
  error,
  placeholder,
  onValidation
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getPercentageValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState('');

  const onChange = event => {
    if (onComponentChange) {
      onComponentChange(event.currentTarget.value);
    }
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getPercentageValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  return /*#__PURE__*/React.createElement("div", {
    className: classNames('ff_editMode', styles$d.percentage)
  }, /*#__PURE__*/React.createElement(Input, { ...getValue$3({
      value,
      defaultValue,
      callback: toString
    }),
    message: error || validationError,
    disabled: disabled,
    color: error || validationError ? 'red' : undefined,
    type: "number",
    onChange: onChange,
    onBlur: validate,
    onMouseOut: validate,
    placeholder: placeholder,
    ...inputProps
  }));
};

const PersonRead = ({
  value,
  openLinksInNewTab
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  if (value.is_hidden) {
    return /*#__PURE__*/React.createElement("span", null, "(", translator.gettext('hidden'), ")");
  }

  return /*#__PURE__*/React.createElement(Link, {
    openLinksInNewTab: openLinksInNewTab,
    href: `/person/${value.id}`
  }, value.name);
};

const Person = ({
  error,
  value,
  onComponentChange,
  showNewLabel = false,
  allowNewItem,
  onBlur = noop,
  onValidation,
  ...restProps
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState('');

  const renderPersonSuggestions = persons => (getItemProps, highlightedIndex, setHighlightedIndex, inputValue) => {
    return /*#__PURE__*/React.createElement(EntitySuggestions, {
      inputValue: inputValue,
      items: persons,
      highlightedIndex: highlightedIndex,
      setHighlightedIndex: setHighlightedIndex,
      getItemProps: getItemProps,
      type: "person",
      allowNewItem: allowNewItem,
      texts: {
        tooltip: translator.gettext('Show contact details'),
        addNew: translator.pgettext('Text for adding new person button"', "Add '%s' as new contact", inputValue)
      }
    });
  };

  const getSuggestionValue = entity => {
    if (typeof entity === 'string') {
      return entity;
    }

    if (entity.is_hidden) {
      return translator.gettext('(hidden)');
    }

    return entity.name;
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const getIsPersonNew = personValue => {
    if (isObject(personValue)) {
      return !personValue.id;
    }

    if (isString(personValue)) {
      return true;
    }

    return false;
  };

  const getSuggestions = async searchValue => {
    const persons = await getPersons(searchValue);

    if (allowNewItem) {
      persons.push(ADD_NEW_DUMMY_ITEM);
    }

    return persons;
  };

  return /*#__PURE__*/React.createElement(InputSelect, {
    inputProps: {
      onBlur: event => {
        event.persist();
        defer(() => {
          validate(event);
          onBlur(event);
        });
      },
      icon: 'person',
      message: error || validationError
    },
    getSuggestionValue: getSuggestionValue,
    getSuggestions: getSuggestions,
    renderSuggestions: renderPersonSuggestions,
    isNewValue: isString,
    dropdownTrigger: 2,
    allowNewItem: allowNewItem,
    onComponentChange: onComponentChange,
    showNewLabel: showNewLabel || getIsPersonNew(value),
    value: value,
    ...restProps
  });
};

const PhoneRead = ({
  value,
  settings,
  caller
}) => {
  const {
    locale = '',
    phoneSettings
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  const valueObj = typeof value === 'string' ? {
    value,
    label: null
  } : value;
  const format = settings && settings.format_phone_numbers_enabled;

  if (caller) {
    return /*#__PURE__*/React.createElement(Caller, {
      value: valueObj,
      settings: settings,
      format: format,
      locale: locale
    });
  }

  return /*#__PURE__*/React.createElement(Link, {
    href: createPhoneLink(valueObj.value, settings, phoneSettings)
  }, formatPhoneNumber(valueObj.value, locale, format));
};

const Phone = ({
  defaultValue,
  value,
  disabled = false,
  onComponentChange,
  inputProps,
  error,
  placeholder,
  onValidation
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState('');

  const onChange = event => {
    if (onComponentChange) {
      onComponentChange(event.currentTarget.value);
    }
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  return /*#__PURE__*/React.createElement(Input, {
    className: "ff_editMode",
    ...getValue$3({
      value,
      defaultValue
    }),
    onBlur: validate,
    onMouseOut: validate,
    message: error || validationError,
    color: error || validationError ? 'red' : undefined,
    disabled: disabled,
    onChange: onChange,
    placeholder: placeholder,
    ...inputProps
  });
};

var css_248z$c = ".ff_v531__Pipelines__select__3hr{\n\twidth:100%;\n}\n";
var styles$c = {
  "select": "ff_v531__Pipelines__select__3hr"
};
styleInject(css_248z$c);

const Pipelines = ({
  onComponentChange,
  selectedId
}) => {
  const {
    pipelines
  } = parseContext(useContext(FormFieldsContext));

  const onChange = pipelineId => {
    onComponentChange(pipelineId);
  };

  return /*#__PURE__*/React.createElement(Select, {
    value: selectedId,
    onChange: onChange,
    className: styles$c.select,
    "data-test": "pipeline_id"
  }, pipelines === null || pipelines === void 0 ? void 0 : pipelines.map(pipeline => {
    return /*#__PURE__*/React.createElement(Select.Option, {
      key: pipeline.id,
      value: pipeline.id,
      "data-test": `pipeline-option-${pipeline.id}`
    }, pipeline.name);
  }));
};

var css_248z$b = ".ff_v531__PipelinesAndStages__label__3h1{\n\tmargin-bottom:4px;\n\tcolor:#747678;\n}\n.ff_v531__PipelinesAndStages__noStagesMessage__3Vr{\n\twidth:100%;\n\theight:20px;\n\tpadding:4px;\n\tpadding-left:0;\n}\n.ff_v531__PipelinesAndStages__noStagesErrorMessage__3CH{\n\tborder:1px solid #f94839;\n\tcolor:#f94839;\n\tpadding-left:4px;\n\tmargin-bottom:4px;\n}\n";
var styles$b = {
  "label": "ff_v531__PipelinesAndStages__label__3h1",
  "noStagesMessage": "ff_v531__PipelinesAndStages__noStagesMessage__3Vr",
  "noStagesErrorMessage": "ff_v531__PipelinesAndStages__noStagesErrorMessage__3CH"
};
styleInject(css_248z$b);

const getFilteredStages = (stages, pipelineId) => {
  return (stages === null || stages === void 0 ? void 0 : stages.filter(stage => stage.pipeline_id === pipelineId)) || [];
};
const isPipelinesOrStagesEmpty = value => {
  return !(value !== null && value !== void 0 && value.pipeline_id) || !(value !== null && value !== void 0 && value.stage_id);
};

const PipelinesAndStages = ({
  value,
  error,
  onComponentChange
}) => {
  const {
    translator,
    stages,
    pipelines
  } = parseContext(useContext(FormFieldsContext));
  const [localState, setLocalState] = useState({
    pipelineId: (value === null || value === void 0 ? void 0 : value.pipeline_id) || pipelines && pipelines[0].id || 0,
    stageId: (value === null || value === void 0 ? void 0 : value.stage_id) || stages && stages[0].id || 0
  });

  const onChange = (pipelineId, stageId) => {
    if (onComponentChange) {
      onComponentChange({
        pipeline_id: {
          key: 'pipeline_id',
          value: pipelineId,
          type: 'pipeline_id'
        },
        stage_id: {
          key: 'stage_id',
          value: stageId,
          type: 'stage_id'
        }
      });
    }
  };

  useEffect(() => {
    isPipelinesOrStagesEmpty(value) && onChange(localState.pipelineId, localState.stageId);
  }, []);

  const onPipelineUpdate = pipelineId => {
    const filteredStages = getFilteredStages(stages || [], pipelineId);
    const stageId = filteredStages.length > 0 ? filteredStages[0].id : 0;
    setLocalState({
      stageId,
      pipelineId
    });
    onChange(pipelineId, stageId);
  };

  const onStageUpdate = stageId => () => {
    setLocalState({
      stageId,
      pipelineId: localState.pipelineId
    });
    onChange(localState.pipelineId, stageId);
  };

  const stagesForPipeline = getFilteredStages(stages, localState.pipelineId);
  const errorClass = `${styles$b.noStagesMessage} ${error ? styles$b.noStagesErrorMessage : ''}`;
  return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement(Pipelines, {
    onComponentChange: onPipelineUpdate,
    selectedId: localState.pipelineId
  }), /*#__PURE__*/React.createElement(Spacing, {
    top: "s"
  }, /*#__PURE__*/React.createElement("div", {
    className: styles$b.label
  }, translator.gettext('Pipeline stage')), stagesForPipeline.length > 0 ? /*#__PURE__*/React.createElement(StageSelector, {
    dealStageId: localState.stageId
  }, stagesForPipeline.map(stage =>
  /*#__PURE__*/
  // @ts-expect-error TODO: check CUI requirements as `dealStageId` is required
  React.createElement(StageSelector.Stage, {
    key: stage.id,
    id: stage.id,
    tooltip: stage.name,
    onClick: onStageUpdate(stage.id)
  }))) : /*#__PURE__*/React.createElement("div", {
    className: errorClass
  }, translator.gettext('This pipeline has no stages.')), error && /*#__PURE__*/React.createElement(Error$1, {
    message: error
  })));
};

var css_248z$a = ".ff_v531__RadioGroup__wrapper__1pr{\n\tborder:none;\n}\n\n\t.ff_v531__RadioGroup__wrapper__1pr legend{\n\t\tfont:400 15px/20px 'Source Sans Pro',sans-serif;\n\t\tpadding:0;\n\t\tmargin:0 0 4px;\n\t\tcolor:#26292c;\n\t}\n\n\t.ff_v531__RadioGroup__wrapper__1pr label{\n\t\tmargin-right:8px;\n\t}\n";
var styles$a = {
  "wrapper": "ff_v531__RadioGroup__wrapper__1pr"
};
styleInject(css_248z$a);

const RadioGroup = ({
  options,
  onComponentChange,
  name,
  className,
  value: checkedValue,
  error,
  disabled,
  legend
}) => {
  if (!options) {
    return null;
  }

  return /*#__PURE__*/React.createElement("fieldset", {
    className: `${styles$a.wrapper} ${className || ''}`
  }, legend && /*#__PURE__*/React.createElement("legend", null, legend), options.map(({
    label,
    disabled: singleDisabledRadio,
    value
  }) => /*#__PURE__*/React.createElement(Radio, {
    key: value,
    name: name,
    value: value,
    checked: value === checkedValue,
    disabled: disabled || singleDisabledRadio,
    onChange: onComponentChange
  }, label)), /*#__PURE__*/React.createElement(Error$1, {
    message: error
  }));
};

var css_248z$9 = ".ff_v531__CheckboxGroup__wrapper__cK0{\n\tborder:none;\n}\n\n\t.ff_v531__CheckboxGroup__wrapper__cK0 legend{\n\t\tfont:400 15px/20px 'Source Sans Pro',sans-serif;\n\t\tpadding:0;\n\t\tmargin:0 0 4px;\n\t\tcolor:#26292c;\n\t}\n\n\t.ff_v531__CheckboxGroup__wrapper__cK0 label{\n\t\tmargin-right:8px;\n\t}\n";
var styles$9 = {
  "wrapper": "ff_v531__CheckboxGroup__wrapper__cK0"
};
styleInject(css_248z$9);

function CheckboxGroup({
  options,
  onComponentChange,
  className,
  error,
  values = [],
  disabled,
  legend
}) {
  const onChange = e => {
    const value = e.target.value;
    const newValues = values.includes(value) ? values.filter(v => v !== value) : [...values, value];
    onComponentChange(newValues);
  };

  if (!options) {
    return null;
  }

  return /*#__PURE__*/React.createElement("fieldset", {
    className: `${styles$9.wrapper} ${className || ''}`
  }, legend && /*#__PURE__*/React.createElement("legend", null, legend), options.map(({
    label,
    disabled: singleDisabledCheckbox,
    value,
    type
  }) => /*#__PURE__*/React.createElement(Checkbox, {
    key: label,
    disabled: disabled || singleDisabledCheckbox,
    value: value,
    checked: values.includes(value),
    type: type,
    onChange: onChange
  }, label)), /*#__PURE__*/React.createElement(Error$1, {
    message: error
  }));
}

function isWordsAboveLimit(options, labelLetterLimit) {
  let isAboveLimit = false;
  let letterCounter = 0;

  for (const index in options) {
    if (options.hasOwnProperty(index)) {
      letterCounter += options[index].label.length;

      if (letterCounter > labelLetterLimit) {
        isAboveLimit = true;
        break;
      }
    }
  }

  return isAboveLimit;
}
const initValue = value => {
  if (typeof value === 'object') {
    return value;
  } else if (value) {
    if (!isNil(value) && !isNaN(+value)) {
      value = Number(value);
    }

    return {
      id: value
    };
  }
};
const getOptionsFromChildren = children => {
  return React.Children.map(children, child => {
    const {
      props: {
        children: childrenComponent,
        id
      }
    } = child;
    return {
      id,
      label: childrenComponent
    };
  }) || [];
};
const getOptions = (options, children) => {
  const hasOptionsFromProps = !!options.length;

  if (hasOptionsFromProps) {
    return options;
  }

  if (children) {
    return getOptionsFromChildren(children);
  }

  return [];
};

const SingleOptionRead = ({
  value,
  options,
  fieldType,
  fieldKey
}) => {
  const {
    fields
  } = parseContext(useContext(FormFieldsContext));
  const [optionsState] = useState(() => initOptions(fields, options, fieldType, fieldKey));
  const newValue = initValue(value);

  if (!newValue) {
    return null;
  }

  if (!(optionsState !== null && optionsState !== void 0 && optionsState.length)) {
    return /*#__PURE__*/React.createElement(React.Fragment, null, newValue.label);
  }

  const selectedOption = optionsState.find(option => option.id === Number(newValue.id));
  return /*#__PURE__*/React.createElement(React.Fragment, null, selectedOption && selectedOption.label);
};

var css_248z$8 = ".ff_v531__SingleOption__wrapper__2z1{\n\twidth:100%;\n}\n.ff_v531__SingleOption__error__2-J{\n\tborder:1px solid #f94839;\n\tborder-right:none;\n\tbox-shadow:none !important;\n}\n.ff_v531__SingleOption__error__2-J:last-of-type{\n\t\tborder-right:1px solid #f94839;\n\t}\n.ff_v531__SingleOption__error__2-J > span{\n\t\tbox-shadow:none;\n\t}\n.ff_v531__SingleOption__button__2Uw span{\n\t\tpadding:0;\n\t\tcolor:rgba(38,41,44,.64);\n\t}\n.ff_v531__SingleOption__button__2Uw span:last-child{\n\t\tpadding-right:0;\n\t}\n.ff_v531__SingleOption__button__2Uw span:first-child{\n\t\tpadding-left:0;\n\t}\n";
var styles$8 = {
  "wrapper": "ff_v531__SingleOption__wrapper__2z1",
  "error": "ff_v531__SingleOption__error__2-J",
  "button": "ff_v531__SingleOption__button__2Uw"
};
styleInject(css_248z$8);

const SingleOption = ({
  value,
  options = [],
  children,
  onComponentChange,
  buttonGroupProps,
  disabled = false,
  portalTo,
  threshold = 5,
  placeholder = ' ',
  labelLetterLimit = 25,
  filter = false,
  selectProps,
  fieldType,
  fieldKey,
  error,
  allowEmpty = true
}) => {
  const initialOption = {
    label: '(None)',
    id: 0
  };
  const {
    translator,
    fields
  } = parseContext(useContext(FormFieldsContext));
  const [valueState, setValueState] = useState(initValue(value) || null);
  const [optionsState, setOptionsState] = useState(() => initOptions(fields, options, fieldType, fieldKey));

  const setOptions = singleOptions => {
    setOptionsState(allowEmpty ? [initialOption, ...singleOptions] : singleOptions);
  };

  useEffect(() => {
    setOptions(getOptions(options, children));
  }, []);
  useEffect(() => {
    setValueState(initValue(value) || null);
  }, [value]);

  const onChange = item => {
    setValueState({
      id: item
    });
    onComponentChange(item);
  };

  const onButtonClick = item => () => {
    setValueState(item);
    onComponentChange(item.id);
  };

  const renderButtonGroup = () => {
    const buttons = optionsState.map((item, index) => {
      const {
        id,
        label
      } = item;
      const itemId = id || 0;
      const isActive = itemId === (valueState && valueState.id);
      const className = `${styles$8.button} ${error ? styles$8.error : ''}`;
      return /*#__PURE__*/React.createElement(Button, {
        key: index,
        active: isActive,
        onClick: onButtonClick(item),
        disabled: disabled,
        className: className
      }, label);
    });
    return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement(ButtonGroup, { ...buttonGroupProps
    }, buttons), /*#__PURE__*/React.createElement(Error$1, {
      message: error
    }));
  };

  const renderSelectMenu = () => {
    const selectOptions = optionsState.map((item, index) => {
      const {
        id,
        label
      } = item;
      return /*#__PURE__*/React.createElement(Select.Option, {
        key: index,
        value: id
      }, label);
    });
    const className = `${styles$8.wrapper} ${error ? errorStyles.select : ''}`;
    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Select, {
      filter: filter || optionsState.length >= 5,
      filterPlaceholder: translator.gettext('Search'),
      popperProps: popperProps,
      portalTo: portalTo,
      onChange: onChange,
      placeholder: placeholder,
      className: className,
      disabled: disabled,
      value: (valueState === null || valueState === void 0 ? void 0 : valueState.id) || '',
      ...selectProps
    }, selectOptions), /*#__PURE__*/React.createElement(Error$1, {
      message: error
    }));
  };

  const isButtonGroup = optionsState.length < threshold && !isWordsAboveLimit(optionsState, labelLetterLimit);

  if (isButtonGroup) {
    return renderButtonGroup();
  }

  return renderSelectMenu();
};

const TextAreaLineBreaker = props => {
  var _props$value;

  const htmlBreakElement = /*#__PURE__*/React.createElement("br", null);
  const lines = (_props$value = props.value) === null || _props$value === void 0 ? void 0 : _props$value.split(/\r?\n/);
  const spanStyle = {
    display: 'block'
  };
  const handleLineBreak = lines.map((line, index) => {
    return /*#__PURE__*/React.createElement(Linkify, {
      key: index,
      properties: {
        target: '_blank'
      }
    }, /*#__PURE__*/React.createElement("span", {
      style: index === 1 ? spanStyle : undefined
    }, line, index < lines.length - 1 ? htmlBreakElement : null));
  });
  return /*#__PURE__*/React.createElement(React.Fragment, null, handleLineBreak);
};

const TextAreaRead = ({
  value
}) => {
  if (!value) {
    return null;
  }

  return /*#__PURE__*/React.createElement(Linkify, {
    properties: {
      target: '_blank'
    }
  }, /*#__PURE__*/React.createElement(TextAreaLineBreaker, {
    value: value
  }));
};

const TextAreaComponent = ({
  defaultValue,
  value,
  disabled = false,
  className,
  autofocus = false,
  onComponentChange,
  error,
  placeholder,
  textAreaProps,
  onValidation
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getTextAreaValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState('');

  const onChange = event => {
    if (onComponentChange) {
      onComponentChange(event.currentTarget.value);
    }
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getTextAreaValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const callback = val => {
    if (!val) {
      return '';
    }

    return val;
  };

  return /*#__PURE__*/React.createElement(Textarea, { ...getValue$3({
      value,
      defaultValue,
      callback
    }),
    autoFocus: autofocus,
    className: className,
    message: error || validationError,
    disabled: disabled,
    color: error || validationError ? 'red' : undefined,
    onBlur: validate,
    onMouseOut: validate,
    onChange: onChange,
    placeholder: placeholder,
    ...textAreaProps
  });
};

const TextFieldRead = ({
  value,
  linkify = true,
  onClick
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getEmailValidation
  } = useValidation(translator);

  if (!value) {
    return null;
  }

  if (!linkify) {
    return value;
  } // if getEmailValidation returns undefined, then email is valid
  // otherwise it returns object with error message


  const isEmail = typeof getEmailValidation({
    value,
    translator
  }) === 'undefined';

  if (isEmail) {
    return /*#__PURE__*/React.createElement(Link, {
      onClick: onClick,
      href: `mailto:${value}`,
      value: value
    }, value);
  }

  return /*#__PURE__*/React.createElement(Linkify, {
    properties: {
      target: '_blank',
      rel: 'noopener noreferrer'
    }
  }, value);
};

const TextField = ({
  value,
  autofocus,
  actionIcon,
  disabled,
  placeholder,
  onComponentChange,
  inputProps,
  defaultValue,
  error,
  onValidation
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState();

  const onChange = event => {
    const eventValue = event.currentTarget.value;

    if (onComponentChange) {
      onComponentChange(eventValue);
    }
  };

  const validate = event => {
    handleValidation({
      formValue: event,
      validate: getValidation
    });
    const errorMessage = handleValidation({
      formValue: event,
      validate: getValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const parsedValue = isNull(value) ? '' : value;
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Input, {
    autoFocus: autofocus,
    className: "ff_editMode",
    type: "text",
    ...getValue$3({
      value: parsedValue,
      defaultValue
    }),
    onBlur: validate,
    onMouseOut: validate,
    onChange: onChange,
    message: error || validationError,
    color: error || validationError ? 'red' : undefined,
    disabled: disabled,
    placeholder: placeholder,
    ...inputProps
  }), actionIcon);
};

const ISO_24H_TIME_FORMAT = 'HH:mm';
class TimeFormatter {
  // format: string;
  constructor(locale) {
    this.format = localeMomentFormat(locale, 'LT') || ISO_24H_TIME_FORMAT;
  }

  getFormat() {
    return this.format;
  }

  formatTime(selectedTime) {
    if (selectedTime) {
      var _this$formatMomentTim;

      return (_this$formatMomentTim = this.formatMomentTime(selectedTime)) === null || _this$formatMomentTim === void 0 ? void 0 : _this$formatMomentTim.format(this.format);
    }

    return null;
  }

  formatMomentTime(selectedTime) {
    if (selectedTime) {
      return moment$1(selectedTime, this.format);
    }

    return null;
  }

}

const TimePickerRead = ({
  value
}) => {
  const {
    locale
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  const timeFormatter = new TimeFormatter(locale);
  return /*#__PURE__*/React.createElement(React.Fragment, null, timeFormatter.formatTime(value));
};

const TimePickerInput = /*#__PURE__*/forwardRef(({
  onChange,
  error,
  inputProps,
  inputValue,
  timePickerPlaceholder,
  ...restProps
}, ref) => {
  const handleChange = event => {
    if (onChange) {
      onChange(event);
    }
  };

  const color = error ? 'red' : undefined;
  return /*#__PURE__*/React.createElement(Input, { ...restProps,
    ref: ref,
    onChange: handleChange,
    color: color,
    placeholder: timePickerPlaceholder,
    ...inputProps
  });
});

var css_248z$7 = ".ff_v531__TimePicker__popper__hlr[data-placement^='bottom']{\n\t\tmargin-top:0;\n\t}\n\t.ff_v531__TimePicker__popper__hlr[data-placement]{\n\t\tz-index:6001;\n\t}\n\t.ff_v531__TimePicker__errorWrapper__1Tv{\n\tborder:1px solid;\n\tborder-color:#f94839 !important;\n}\n\t.ff_v531__TimePicker__errorMsg__K-k{\n\tcolor:#f94839;\n\tmargin-top:4px;\n\tfont-size:13px;\n}\n\t.ff_v531__TimePicker__input__9pn .react-datepicker-wrapper, .ff_v531__TimePicker__input__9pn .react-datepicker__input-container{\n\t\t\twidth:100%;\n\t\t}\n\t.ff_v531__TimePicker__input__9pn .react-datepicker-wrapper input:disabled, .ff_v531__TimePicker__input__9pn .react-datepicker__input-container input:disabled{\n\t\t\t\tbackground-color:#f7f7f7;\n\t\t\t}\n\t.ff_v531__TimePicker__input__9pn .react-datepicker__close-icon::after{\n\t\t\t\tcolor:#747678;\n\t\t\t\tbackground-color:transparent;\n\t\t\t\tfont-size:23px;\n\t\t\t\theight:auto;\n\t\t\t\twidth:auto;\n\t\t\t\ttop:3px;\n\t\t\t\tright:2px;\n\t\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker\\--time-only{\n\t\t\tborder:0 !important;\n\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker__header{\n\t\t\theight:69px;\n\t\t\tbackground-color:#ffffff;\n\t\t\tborder:0;\n\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker__header\\--time{\n\t\t\t\tdisplay:none;\n\t\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker__header\\--time-box{\n\t\t\t\t\twidth:100px;\n\t\t\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker__triangle{\n\t\t\tdisplay:none;\n\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker__time{\n\t\t\twidth:100px !important;\n\t\t\tborder-radius:0;\n\t\t\tborder:1px solid #b9babb;\n\t\t\tbox-shadow:0 5px 15px -5px #747678;\n\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker__time-container{\n\t\t\t\tborder:0;\n\t\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker__time-box{\n\t\t\t\tborder-radius:0;\n\t\t\t\twidth:100px !important;\n\t\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker__time-list-item{\n\t\t\t\theight:auto !important;\n\t\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker__time-list-item\\--selected{\n\t\t\t\t\tbackground-color:#317ae2 !important;\n\t\t\t\t}\n\t.ff_v531__TimePicker__timepicker__98G .react-datepicker__time-list-item:hover{\n\t\t\t\t\tbackground-color:#317ae2 !important;\n\t\t\t\t\tcolor:#ffffff;\n\t\t\t\t}\n";
var styles$7 = {
  "popper": "ff_v531__TimePicker__popper__hlr",
  "errorWrapper": "ff_v531__TimePicker__errorWrapper__1Tv",
  "errorMsg": "ff_v531__TimePicker__errorMsg__K-k",
  "input": "ff_v531__TimePicker__input__9pn",
  "timepicker": "ff_v531__TimePicker__timepicker__98G"
};
styleInject(css_248z$7);

const TimePicker = ({
  value,
  portalTo,
  onComponentChange,
  onRawChange,
  timeFormat,
  startOpen = false,
  timeIntervals = 15,
  error,
  className,
  placeholder,
  allowClear = true,
  ...rest
}) => {
  const {
    locale
  } = parseContext(useContext(FormFieldsContext));
  const [startTime, setTime] = useState();
  const timeFormatter = new TimeFormatter(locale);
  const format = timeFormat || localeMomentFormat(locale, 'LT');

  const onSelectChange = selectedTime => {
    setTime(selectedTime);
    onRawChange === null || onRawChange === void 0 ? void 0 : onRawChange(selectedTime);
    onComponentChange(timeFormatter.formatTime(selectedTime));
  };

  useEffect(() => {
    setTime(timeFormatter.formatMomentTime(value));
  }, [value]);
  return /*#__PURE__*/React.createElement("div", {
    className: classNames(styles$7.input, className)
  }, /*#__PURE__*/React.createElement(Calendar, {
    selected: startTime,
    popperClassName: classNames(styles$7.timepicker, styles$7.popper),
    onChange: onSelectChange,
    showTimeSelect: true,
    showTimeSelectOnly: true,
    timeIntervals: timeIntervals,
    dateFormat: format,
    timeFormat: format,
    startOpen: startOpen,
    className: classNames(error && styles$7.errorWrapper),
    placeholderText: placeholder || format,
    isClearable: allowClear,
    customInput: /*#__PURE__*/React.createElement(TimePickerInput, {
      timePickerPlaceholder: placeholder || format,
      error: error
    }),
    ...renderPopperAttribute(portalTo),
    ...rest
  }), /*#__PURE__*/React.createElement(Error$1, {
    message: typeof error === 'string' ? error : undefined
  }));
};

const getTimeReadValue = (startTime, endTime) => {
  const defaultValueIndicator = '...';
  return `${startTime ? startTime : defaultValueIndicator} - ${endTime ? endTime : defaultValueIndicator}`;
};

const TimeRangeRead = ({
  value
}) => {
  const {
    locale
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  const {
    startTime,
    endTime
  } = value;
  const timeFormatter = new TimeFormatter(locale);
  const formattedStartTime = timeFormatter.formatTime(startTime);
  const formattedEndTime = timeFormatter.formatTime(endTime);
  return /*#__PURE__*/React.createElement(React.Fragment, null, getTimeReadValue(formattedStartTime, formattedEndTime));
};

const TimeRange = ({
  placeholderTextStart,
  placeholderTextEnd,
  startOpen = false,
  timeFormat,
  value,
  onComponentChange,
  startTime: startDate,
  endTime: endDate,
  error,
  className,
  allowClear,
  ...rest
}) => {
  const {
    locale
  } = parseContext(useContext(FormFieldsContext));
  const [startTimeState, setStartTime] = useState();
  const [endTimeState, setEndTime] = useState();
  const timeFormatter = new TimeFormatter(locale);
  useEffect(() => {
    setStartTime(timeFormatter.formatTime(value === null || value === void 0 ? void 0 : value.startTime));
    setEndTime(timeFormatter.formatTime(value === null || value === void 0 ? void 0 : value.endTime));
  }, [value]);

  const handleChangeStart = newStartTime => {
    setStartTime(timeFormatter.formatTime(newStartTime));

    if (onComponentChange) {
      onComponentChange({
        startTime: newStartTime,
        endTime: endTimeState
      });
    }
  };

  const handleChangeEnd = newEndDate => {
    setEndTime(timeFormatter.formatTime(newEndDate));

    if (onComponentChange) {
      onComponentChange({
        startTime: startTimeState,
        endTime: newEndDate
      });
    }
  };

  return /*#__PURE__*/React.createElement("div", {
    className: classNames(className)
  }, /*#__PURE__*/React.createElement("div", {
    className: styles$s.wrapper
  }, /*#__PURE__*/React.createElement(TimePicker, {
    selectsStart: true,
    placeholder: placeholderTextStart,
    startOpen: startOpen,
    timeFormat: timeFormat,
    value: startTimeState,
    onComponentChange: handleChangeStart,
    error: !!error,
    allowClear: allowClear,
    ...omit(rest, ['onComponentChange'])
  }), /*#__PURE__*/React.createElement("div", {
    className: styles$s.separator
  }, "-"), /*#__PURE__*/React.createElement(TimePicker, {
    selectsEnd: true,
    placeholder: placeholderTextEnd,
    timeFormat: timeFormat,
    value: endTimeState,
    disabled: !startTimeState,
    onComponentChange: handleChangeEnd,
    error: !!error,
    allowClear: allowClear,
    ...omit(rest, ['onComponentChange'])
  })), /*#__PURE__*/React.createElement(Error$1, {
    message: error
  }));
};

const DefaultPhoneRead = ({
  value
}) => {
  const {
    formatter,
    currencies
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  const arrayValue = isArray(value) ? value : [value];
  return /*#__PURE__*/React.createElement("div", null, arrayValue.map((price, i) => {
    const {
      label,
      value: labelValue = ''
    } = price;
    const selected = find$1(currencies, {
      code: label
    });
    let code = currencies ? currencies[0].code : 'EUR';

    if (selected) {
      code = selected.code;
    } // @ts-expect-error TODO: library defines as `Number` requirement but takes also `String`


    const formattedValue = formatter.format(labelValue, code);
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      "data-testid": "read-label"
    }, formattedValue);
  }));
};

const disableCurrencies = (optionsProp = [], valueProp) => {
  return optionsProp.map(currency => {
    currency.disabled = false;
    valueProp.forEach(option => {
      if ((option === null || option === void 0 ? void 0 : option.label) === currency.value) {
        currency.disabled = true;
      }
    });
    return currency;
  });
};

const UnitPrices = ({
  onComponentChange,
  single = false,
  value,
  ...restProps
}) => {
  const {
    translator,
    currencies = [],
    formatter,
    defaultCurrency
  } = parseContext(useContext(FormFieldsContext));
  const {
    getNumberValidation
  } = useValidation(translator);
  const [valueState] = useState(value ? isArray(value) ? value : [value] : [{
    value: '',
    label: defaultCurrency
  }]);

  const initOptions = () => disableCurrencies(getMonetaryOptions(currencies), valueState);

  const [options, setOptions] = useState(initOptions());
  const disableAdd = options.every(option => option.disabled);

  const validate = ({
    value: propValue,
    custom
  }) => {
    return getNumberValidation({
      value: propValue,
      custom,
      formatter,
      monetary: true,
      translator
    });
  };

  const onChange = propValue => {
    setOptions(disableCurrencies(options, propValue));
    const prices = propValue.map(price => {
      return {
        price: price.value,
        currency: price.label
      };
    });
    onComponentChange(prices);
  };

  return /*#__PURE__*/React.createElement(InputSelectAddMore, {
    single: single,
    value: valueState,
    onComponentChange: onChange,
    validate: validate,
    disableAdd: disableAdd,
    addMoreText: translator.gettext('Add price'),
    ...restProps,
    options: options
  });
};

const UserRead = ({
  value,
  openLinksInNewTab = false
}) => {
  const {
    translator,
    users
  } = parseContext(useContext(FormFieldsContext));

  if (!value || !users) {
    return null;
  }

  const userValue = findUserById(value, users);

  if (!userValue) {
    return null;
  }

  if (userValue.is_hidden) {
    return /*#__PURE__*/React.createElement("span", null, "(", translator.gettext('hidden'), ")");
  }

  return /*#__PURE__*/React.createElement(Link, {
    openLinksInNewTab: openLinksInNewTab,
    href: `/users/details/${userValue.id}`
  }, userValue.name);
};

var css_248z$6 = ".ff_v531__User__user__1u1{\n\twidth:100%;\n}\n\n.ff_v531__User__selectPopup__11D{\n\tz-index:6001;\n}\n";
var styles$6 = {
  "user": "ff_v531__User__user__1u1",
  "selectPopup": "ff_v531__User__selectPopup__11D"
};
styleInject(css_248z$6);

const getUser = user => {
  var _user$attributes, _user$attributes2, _user$attributes3;

  return {
    id: user.id || ((_user$attributes = user.attributes) === null || _user$attributes === void 0 ? void 0 : _user$attributes.id),
    name: user.name || ((_user$attributes2 = user.attributes) === null || _user$attributes2 === void 0 ? void 0 : _user$attributes2.name),
    isYou: user.is_you || ((_user$attributes3 = user.attributes) === null || _user$attributes3 === void 0 ? void 0 : _user$attributes3.is_you)
  };
};
const getIsUserOwner = (isOwner, usersCollection) => {
  var _usersCollection$find;

  if (!isOwner) {
    return false;
  }

  return usersCollection === null || usersCollection === void 0 ? void 0 : (_usersCollection$find = usersCollection.find(user => getUser(user).isYou)) === null || _usersCollection$find === void 0 ? void 0 : _usersCollection$find.id;
};
const getDefaultHighlightedIndex = (children, usersCollection, value, isUserOwner) => {
  const initialValue = value || isUserOwner;

  if (!initialValue) {
    return 0;
  }

  if (children) {
    return findIndex(React.Children.toArray(children), child => child.props.value === initialValue);
  }

  if (usersCollection) {
    return findIndex(usersCollection, user => user.id === initialValue);
  }

  return 0;
};

const User = ({
  disabled = false,
  portalTo,
  filter = true,
  placeholder = ' ',
  onComponentChange,
  children,
  isOwner = false,
  allowClear = true,
  defaultValue,
  value,
  selectProps,
  users,
  error
}) => {
  const {
    translator,
    users: usersFromContext
  } = parseContext(useContext(FormFieldsContext));
  const usersCollection = users || usersFromContext;

  const onChange = id => {
    const user = id ? findUserById(id, usersCollection || []) : null;
    onComponentChange(user);
  };

  const isUserOwner = useMemo(() => getIsUserOwner(isOwner, usersCollection), [usersCollection]);

  const renderUsers = () => {
    if (children) {
      return children;
    }

    if (!usersCollection) {
      return null;
    }

    return usersCollection.map(user => {
      const userData = getUser(user);
      return /*#__PURE__*/React.createElement(Select.Option, {
        key: user.id,
        value: user.id,
        itemToString: stringifyUserName(userData.name)
      }, /*#__PURE__*/React.createElement("div", null, userData.name, " ", userData.isYou ? translator.gettext('(You)') : null));
    });
  };

  const className = `${styles$6.user} ${error ? errorStyles.select : ''}`;
  const userValue = getValue$3({
    value: isObject(value) ? value.id : value,
    defaultValue: isObject(defaultValue) ? defaultValue.id : defaultValue,
    callback: val => val || isUserOwner,
    defaultReturn: {
      defaultValue: isUserOwner || ''
    }
  });
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Select, { ...userValue,
    popperProps: popperProps,
    portalTo: portalTo,
    // @ts-expect-error TODO: Validate CUI types
    onChange: onChange,
    disabled: disabled,
    allowClear: allowClear,
    placeholder: placeholder,
    popupClassName: styles$6.selectPopup,
    filter: filter,
    className: className,
    downShiftProps: {
      defaultHighlightedIndex: getDefaultHighlightedIndex(children, usersCollection, (userValue === null || userValue === void 0 ? void 0 : userValue.value) || (userValue === null || userValue === void 0 ? void 0 : userValue.defaultValue), isUserOwner)
    },
    ...selectProps
  }, renderUsers()), /*#__PURE__*/React.createElement(Error$1, {
    message: error
  }));
};

const getRoles = (advancedPermissions, translator) => {
  if (advancedPermissions) {
    return {
      1: {
        title: translator.gettext('Owner only'),
        squares: 1,
        subTitle: translator.gettext('Only the owner, admins and users in the parent groups can see and edit the details')
      },
      3: {
        title: translator.gettext("Owner's visibility group"),
        squares: 2,
        subTitle: translator.gettext('Users in the same visibility group, admins and users in the parent groups can see and edit the details')
      },
      5: {
        title: translator.gettext("Owner's group, and sub-groups"),
        squares: 3,
        subTitle: translator.gettext('Users in the same visibility group, sub-groups, admins and users in the parent groups can see and edit details')
      },
      7: {
        title: translator.gettext('Entire company'),
        squares: 4,
        subTitle: translator.gettext('All users in the company can see and edit the details')
      }
    };
  }

  return {
    1: {
      title: translator.gettext('Owner & followers'),
      squares: 2,
      subTitle: translator.gettext('Only the owner & followers can see and edit the details')
    },
    3: {
      title: translator.gettext('Entire company'),
      squares: 4,
      subTitle: translator.gettext('All users in the company can see and edit the details')
    }
  };
};

const VisibilitySwitchRead = ({
  value,
  advancedPermissions = false
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));

  if (!value) {
    return null;
  }

  const roles = getRoles(advancedPermissions, translator);
  const role = roles[value] ? roles[value].title : '';
  return /*#__PURE__*/React.createElement(React.Fragment, null, role);
};

var css_248z$5 = ".ff_v531__VisibilityIcon__title__2UT{\n\tfont-weight:bold;\n}\n.ff_v531__VisibilityIcon__svg__3nk{\n\twidth:14px;\n\tmin-width:14px;\n\theight:14px;\n\tmin-height:14px;\n}\n.ff_v531__VisibilityIcon__fill__3Fd{\n\tfill:rgb(47, 108, 197);\n}\n.ff_v531__VisibilityIcon__empty__32_{\n\tfill:rgba(38, 41, 44, .24);\n}\n";
var styles$5 = {
  "title": "ff_v531__VisibilityIcon__title__2UT",
  "svg": "ff_v531__VisibilityIcon__svg__3nk",
  "fill": "ff_v531__VisibilityIcon__fill__3Fd",
  "empty": "ff_v531__VisibilityIcon__empty__32_"
};
styleInject(css_248z$5);

const iconClassName = fill => {
  if (fill > 0) {
    return `${styles$5.fill} vg__icon--fill`;
  }

  return `${styles$5.empty} vg__icon--empty`;
};

const VisibilityIcon = ({
  className,
  filledSquare = 0,
  w = 2,
  h = 2
}) => {
  const rectangles = [];
  const squareSize = 8;
  let fill = filledSquare;

  for (let i = 0; i < w; i = i + 1) {
    for (let j = 0; j < h; j = j + 1) {
      rectangles.push( /*#__PURE__*/React.createElement("rect", {
        key: rectangles.length,
        width: "6",
        height: "6",
        id: "Rectangle",
        y: i * squareSize,
        x: j * squareSize,
        className: iconClassName(fill)
      }));
      fill = fill - 1;
    }
  }

  return /*#__PURE__*/React.createElement("svg", {
    className: classNames(className, styles$5.svg)
  }, /*#__PURE__*/React.createElement("g", {
    id: "vg_icons"
  }, rectangles));
};

var css_248z$4 = ".ff_v531__VisibilityOptions__title__3IN:hover{\n\t\tcolor:#ffffff;\n\t}\n.ff_v531__VisibilityOptions__selected__1xF{\n\tfont-weight:600;\n}\n.ff_v531__VisibilityOptions__subTitle__1Nw{\n\tfont-size:13px;\n\tcolor:#747678;\n}\n.ff_v531__VisibilityOptions__option__1Z4{\n\tcursor:pointer;\n\tdisplay:flex;\n}\n.ff_v531__VisibilityOptions__option__1Z4:hover .ff_v531__VisibilityOptions__title__3IN, .ff_v531__VisibilityOptions__option__1Z4:hover .ff_v531__VisibilityOptions__subTitle__1Nw{\n\t\t\tcolor:#ffffff;\n\t\t}\n.ff_v531__VisibilityOptions__option__1Z4:hover .vg__icon--fill{\n\t\t\tfill:rgb(255, 255, 255) !important;\n\t\t}\n.ff_v531__VisibilityOptions__option__1Z4:hover .vg__icon--empty{\n\t\t\tfill:rgba(38, 41, 44, .32);\n\t\t}\n.ff_v531__VisibilityOptions__textWrap__2s8{\n\tdisplay:flex;\n\tflex-direction:column;\n\tpadding-left:12px;\n\ttext-align:left;\n}\n.ff_v531__VisibilityOptions__icon__2PQ{\n\tdisplay:flex;\n\tpadding-top:4px;\n}\n";
var styles$4 = {
  "title": "ff_v531__VisibilityOptions__title__3IN",
  "selected": "ff_v531__VisibilityOptions__selected__1xF",
  "subTitle": "ff_v531__VisibilityOptions__subTitle__1Nw",
  "option": "ff_v531__VisibilityOptions__option__1Z4",
  "textWrap": "ff_v531__VisibilityOptions__textWrap__2s8",
  "icon": "ff_v531__VisibilityOptions__icon__2PQ"
};
styleInject(css_248z$4);

const VisibilityOptions = ({
  roles,
  selectedVisibility,
  handleChange,
  children
}) => {
  const onClickHandler = role => () => handleChange(Number(role));

  return /*#__PURE__*/React.createElement("div", null, Object.keys(roles).map(role => {
    const isSelected = selectedVisibility === Number(role);
    return /*#__PURE__*/React.createElement(Option, {
      key: role,
      className: styles$4.option,
      onClick: onClickHandler(role),
      selected: isSelected
    }, children && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
      className: styles$4.icon
    }, /*#__PURE__*/React.cloneElement(children, {
      filledSquare: roles[Number(role)].squares
    })), /*#__PURE__*/React.createElement("div", {
      className: `${styles$4.textWrap} cui4-text`
    }, /*#__PURE__*/React.createElement("div", {
      className: classNames({
        [styles$4.title]: true,
        [styles$4.selected]: isSelected
      })
    }, roles[Number(role)].title), /*#__PURE__*/React.createElement("span", {
      className: `${styles$4.subTitle} vs__subtext`
    }, roles[Number(role)].subTitle))));
  }));
};

var css_248z$3 = ".ff_v531__VisibilitySwitch__select__2r7{\n\twidth:100%;\n\talign-items:center;\n\tpadding-left:10px;\n}\n.ff_v531__VisibilitySwitch__select__2r7 span{\n\t\ttext-align:left;\n\t\tfont-weight:400;\n\t}\n.ff_v531__VisibilitySwitch__icon__1TH{\n\tpadding-right:8px;\n}\n";
var styles$3 = {
  "select": "ff_v531__VisibilitySwitch__select__2r7",
  "icon": "ff_v531__VisibilitySwitch__icon__1TH"
};
styleInject(css_248z$3);

const VisibilitySwitchComponent = ({
  advancedPermissions = false,
  disabled = false,
  portalTo = () => window.document.body,
  popperProps = {},
  value = 1,
  onComponentChange,
  placement = 'bottom',
  className,
  style = {},
  children
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const [selectedVisibilityState, setSelectedVisibility] = useState(value);
  useEffect(() => {
    setSelectedVisibility(value);
  }, [value]);

  const handleVisibilityChange = selectedVisibility => {
    setSelectedVisibility(selectedVisibility);
    onComponentChange(selectedVisibility);
  };

  const roles = getRoles(advancedPermissions, translator);
  const currentRole = roles[selectedVisibilityState] || roles[1];
  return /*#__PURE__*/React.createElement(Dropmenu, {
    className: className,
    closeOnClick: true,
    style: {
      width: 350,
      ...style
    },
    popoverProps: {
      placement,
      portalTo,
      popperProps
    },
    content: /*#__PURE__*/React.createElement(VisibilityOptions, {
      roles: roles,
      selectedVisibility: selectedVisibilityState,
      handleChange: handleVisibilityChange,
      advancedPermissions: advancedPermissions
    }, /*#__PURE__*/React.createElement(VisibilityIcon, {
      className: styles$3.icon
    }))
  }, isFunction(children) ? children(currentRole) : children || /*#__PURE__*/React.createElement(Button, {
    className: styles$3.select,
    disabled: disabled
  }, /*#__PURE__*/React.createElement(VisibilityIcon, {
    className: styles$3.icon,
    filledSquare: currentRole.squares
  }), currentRole.title, /*#__PURE__*/React.createElement(Icon, {
    size: "s",
    icon: "triangle-down"
  })));
};
const VisibilitySwitch = VisibilitySwitchComponent;
VisibilitySwitch.Icon = VisibilityIcon;

var css_248z$2 = ".ff_v531__ActionFooter__footerWrapper__2mX{\n\tmargin-top:8px;\n\talign-self:flex-end;\n}\n\n\t.ff_v531__ActionFooter__footerWrapper__2mX .ff_v531__ActionFooter__saveButton__2Ix{\n\t\tmargin-left:4px;\n\t}\n";
var styles$2 = {
  "footerWrapper": "ff_v531__ActionFooter__footerWrapper__2mX",
  "saveButton": "ff_v531__ActionFooter__saveButton__2Ix"
};
styleInject(css_248z$2);

/**
 * Provides a simple component with "Cancel" and "Save" buttons.
 *
 * @param {ActionFooterProps} props - Props for ActionFooter
 * @returns {React.ReactElement<ActionFooterProps>} ActionFooter component
 */

const ActionFooter = ({
  isLoading,
  onSave,
  onCancel,
  saveDisabled
}) => {
  const {
    translator
  } = useContext(FormFieldsContext);
  return /*#__PURE__*/React.createElement("footer", {
    className: `${styles$2.footerWrapper} ff_footer`
  }, /*#__PURE__*/React.createElement(Button, {
    size: "s",
    onClick: onCancel,
    disabled: isLoading
  }, translator.gettext('Cancel')), /*#__PURE__*/React.createElement(Button, {
    className: styles$2.saveButton,
    size: "s",
    color: "green",
    onClick: onSave,
    loading: isLoading,
    disabled: saveDisabled
  }, translator.gettext('Save')));
};

var css_248z$1 = ".ff_v531__ComponentState__wrapperAdd__1hg .ff_v531__ComponentState__addValue__1BG{\n\tfont:600 15px/20px 'Source Sans Pro', sans-serif;\n\tcolor:#317ae2;\n\ttext-decoration:none;\n}\n.ff_v531__ComponentState__wrapperEdit__2hf{\n\tposition:relative;\n\tdisplay:flex;\n\talign-items:center;\n\twidth:100%;\n\tjustify-content:space-between;\n}\n.ff_v531__ComponentState__wrapperEdit__2hf .ff_v531__ComponentState__edit__30n{\n\t\tvisibility:hidden;\n\t}\n.ff_v531__ComponentState__wrapperEdit__2hf .ff_v531__ComponentState__cuiText__2C2{\n\t\twidth:100%;\n\t}\n.ff_v531__ComponentState__wrapperEdit__2hf .ff_v531__ComponentState__addValue__1BG{\n\t\tvisibility:hidden;\n\t\twidth:100%;\n\t\tdisplay:inline-block;\n\t}\n.ff_v531__ComponentState__wrapperEdit__2hf .ff_v531__ComponentState__valueText__13q{\n\t\tword-break:break-word;\n\t}\n.ff_v531__ComponentState__wrapperEdit__2hf .ff_v531__ComponentState__showValue__W4L{\n\t\twidth:100%;\n\t\tmargin-right:8px;\n\t}\n.ff_v531__ComponentState__wrapperEdit__2hf:hover .ff_v531__ComponentState__edit__30n{\n\t\t\tvisibility:visible;\n\t\t}\n.ff_v531__ComponentState__wrapperEdit__2hf:hover .ff_v531__ComponentState__icon__e8A{\n\t\t\tvisibility:hidden;\n\t\t}\n.ff_v531__ComponentState__wrapperAdd__1hg{\n\tdisplay:flex;\n\talign-items:baseline;\n}\n.ff_v531__ComponentState__wrapperAdd__1hg .ff_v531__ComponentState__addValue__1BG{\n\t\tvisibility:hidden;\n\t\tcursor:pointer;\n\t}\n.ff_v531__ComponentState__wrapperAdd__1hg .ff_v531__ComponentState__placeholder__5aG{\n\t\tposition:absolute;\n\t\tcolor:#b9babb;\n\t}\n.ff_v531__ComponentState__wrapperAdd__1hg:hover .ff_v531__ComponentState__addValue__1BG{\n\t\t\tvisibility:visible;\n\t\t}\n.ff_v531__ComponentState__wrapperAdd__1hg:hover .ff_v531__ComponentState__placeholder__5aG{\n\t\t\tvisibility:hidden;\n\t\t}\n.ff_v531__ComponentState__wrapperAdd__1hg:hover .ff_v531__ComponentState__showValue__W4L{\n\t\t\tdisplay:none;\n\t\t}\n.ff_v531__ComponentState__alignCenter__1AD{\n\tdisplay:flex;\n\talign-items:center;\n}\n.ff_v531__ComponentState__sidebarField__usY .ff_v531__ComponentState__name__31Y{\n\t\tflex:2;\n\t\tjustify-content:flex-end;\n\t\tmargin-right:8px;\n\t\tfont-size:13px;\n\t\tfont-weight:600;\n\t}\n.ff_v531__ComponentState__sidebarField__usY .ff_v531__ComponentState__field__3EV{\n\t\tflex:3;\n\t\tdisplay:flex;\n\t\tflex-direction:column;\n\t\tjustify-content:center;\n\t}\n.ff_v531__ComponentState__sidebarField__usY .ff_v531__ComponentState__fieldIcon__2sQ{\n\t\tmargin-right:8px;\n\t}\n.ff_v531__ComponentState__sidebarField__usY .ff_v531__ComponentState__dot__2Md{\n\t\tmargin-right:8px;\n\t\twidth:9px;\n\t\theight:9px;\n\t\tflex:none;\n\t}\n.ff_v531__ComponentState__sidebarField__usY .ff_v531__ComponentState__dot__2Md.ff_v531__ComponentState__red__25L{\n\t\t\tbackground-color:#f94839;\n\t\t\tborder-radius:50%;\n\t\t}\n.ff_v531__ComponentState__sidebarField__usY .ff_v531__ComponentState__dot__2Md.ff_v531__ComponentState__yellow__32Y{\n\t\t\tbackground-color:#ffcc00;\n\t\t\tborder-radius:50%;\n\t\t}\n.ff_v531__ComponentState__sidebarField__usY .ff_v531__ComponentState__dndicon__3Wa{\n\t\topacity:0;\n\t\tmargin-left:16px;\n\t}\n.ff_v531__ComponentState__sidebarField__usY .ff_v531__ComponentState__leftSection__3T8{\n\t\theight:32px;\n\t\tdisplay:flex;\n\t\tmargin-bottom:auto;\n\t}\n.ff_v531__ComponentState__sidebarField__usY:hover .ff_v531__ComponentState__dndicon__3Wa{\n\t\t\topacity:1;\n\t\t\tcursor:pointer;\n\t\t}\n";
var styles$1 = {
  "wrapperEdit": "ff_v531__ComponentState__wrapperEdit__2hf",
  "edit": "ff_v531__ComponentState__edit__30n",
  "cuiText": "ff_v531__ComponentState__cuiText__2C2",
  "addValue": "ff_v531__ComponentState__addValue__1BG",
  "valueText": "ff_v531__ComponentState__valueText__13q",
  "showValue": "ff_v531__ComponentState__showValue__W4L",
  "icon": "ff_v531__ComponentState__icon__e8A",
  "wrapperAdd": "ff_v531__ComponentState__wrapperAdd__1hg",
  "placeholder": "ff_v531__ComponentState__placeholder__5aG",
  "alignCenter": "ff_v531__ComponentState__alignCenter__1AD",
  "sidebarField": "ff_v531__ComponentState__sidebarField__usY",
  "name": "ff_v531__ComponentState__name__31Y",
  "field": "ff_v531__ComponentState__field__3EV",
  "fieldIcon": "ff_v531__ComponentState__fieldIcon__2sQ",
  "dot": "ff_v531__ComponentState__dot__2Md",
  "red": "ff_v531__ComponentState__red__25L",
  "yellow": "ff_v531__ComponentState__yellow__32Y",
  "dndicon": "ff_v531__ComponentState__dndicon__3Wa",
  "leftSection": "ff_v531__ComponentState__leftSection__3T8"
};
styleInject(css_248z$1);

const AddButton = ({
  onClick,
  placeholder
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  return /*#__PURE__*/React.createElement("div", {
    className: styles$1.wrapperAdd
  }, /*#__PURE__*/React.createElement(Text, {
    className: styles$1.cuiText
  }, placeholder && /*#__PURE__*/React.createElement("span", {
    className: `${styles$1.placeholder} ff__placeholder`
  }, placeholder), /*#__PURE__*/React.createElement("span", {
    className: `${styles$1.addValue} ff__addValue`,
    onClick: onClick
  }, `+  ${translator.gettext('Add value')}`)));
};
const WithEditButton = props => {
  return /*#__PURE__*/React.createElement("div", {
    className: `${styles$1.wrapperEdit} ff__edit`
  }, /*#__PURE__*/React.createElement(Text, {
    className: styles$1.showValue
  }, /*#__PURE__*/React.createElement("span", {
    className: styles$1.valueText
  }, props.children)), /*#__PURE__*/React.createElement("div", {
    className: styles$1.edit
  }, /*#__PURE__*/React.createElement(Button, {
    size: "s",
    onClick: props.onClick
  }, /*#__PURE__*/React.createElement(Icon, {
    icon: "pencil",
    size: "s"
  }))));
};
const SidebarField = ({
  name,
  icon,
  dot,
  onClick,
  draggable,
  children,
  avatar,
  className
}) => {
  return /*#__PURE__*/React.createElement("div", {
    className: classNames(styles$1.sidebarField, styles$1.alignCenter, className),
    onClick: onClick
  }, /*#__PURE__*/React.createElement("div", {
    className: classNames(styles$1.leftSection, styles$1.alignCenter, name && styles$1.name)
  }, dot && /*#__PURE__*/React.createElement("div", {
    className: classNames(styles$1.dot, styles$1[dot])
  }), icon && /*#__PURE__*/React.createElement(Icon, {
    icon: icon,
    size: "s",
    className: styles$1.fieldIcon
  }), avatar && /*#__PURE__*/React.createElement(Avatar, {
    type: avatar,
    size: "s",
    className: styles$1.fieldIcon
  }), name && /*#__PURE__*/React.createElement("span", null, name)), /*#__PURE__*/React.createElement("div", {
    className: styles$1.field
  }, children), draggable && /*#__PURE__*/React.createElement("div", {
    className: classNames(styles$1.alignCenter, styles$1.dndicon)
  }, /*#__PURE__*/React.createElement(Icon, {
    icon: "drag-handle"
  })));
};

const isEnumFieldValueNone = fieldValue => {
  return fieldValue === 0;
};

const format = (value, formatter, currency) => {
  if (formatter) {
    if (currency) {
      // @ts-expect-error TODO: library defines as `Number` requirement but takes also `String`
      return formatter.format(value, currency);
    } // @ts-expect-error TODO: fix needed in library as code marks `decimals Decimal places (optional)`


    return formatter.formatNumber(toString(value));
  }

  return value;
}; // tslint:disable-next-line: cyclomatic-complexity
// eslint-disable-next-line complexity


function useDataMapping( // NOSONAR
fieldKey, value, fieldType, formatter) {
  if (value === null) {
    return {
      [fieldKey]: value
    };
  }

  let returnValue;

  switch (fieldType) {
    case 'set':
      returnValue = {
        [fieldKey]: value.map(val => {
          return (val === null || val === void 0 ? void 0 : val.id) || val;
        })
      };
      break;

    case 'monetary':
      if (fieldKey === 'value') {
        returnValue = {
          value: format(value.value, formatter, value.label),
          currency: value.label
        };
      } else {
        returnValue = {
          [fieldKey]: format(value.value, formatter, value.label),
          [`${fieldKey}_currency`]: value.label
        };
      }

      break;

    case 'user':
    case 'person':
    case 'organization':
    case 'org_id':
    case 'person_id':
    case 'owner_id':
    case 'owner':
    case 'deal':
      returnValue = {
        [fieldKey]: value.id || value
      };
      break;

    case 'address':
      if (value.description) {
        var _value$geocoded;

        returnValue = {
          [fieldKey]: value.description,
          [`${fieldKey}_geocoded`]: (_value$geocoded = value.geocoded) === null || _value$geocoded === void 0 ? void 0 : _value$geocoded[0]
        };
      } else {
        returnValue = {
          [fieldKey]: value
        };
      }

      break;

    case 'default_phone':
    case 'email':
      returnValue = {
        [fieldKey]: value.reduce((arr, email, i) => {
          arr.push({
            label: email.label,
            value: email.value,
            primary: i === 0
          });
          return arr;
        }, [])
      };
      break;

    case 'enum':
      if (fieldKey === 'label' || fieldKey === 'category') {
        returnValue = {
          [fieldKey]: value.id
        };
        break;
      } else if (isEnumFieldValueNone(value)) {
        returnValue = {
          [fieldKey]: ''
        };
        break;
      } else {
        returnValue = {
          [fieldKey]: value
        };
      }

      break;

    case 'label':
      returnValue = {
        [fieldKey]: value.id
      };
      break;

    case 'timerange':
      returnValue = {
        [fieldKey]: value.startTime,
        [`${fieldKey}_until`]: value.endTime
      };
      break;

    case 'daterange':
      returnValue = {
        [fieldKey]: value.startDate,
        [`${fieldKey}_until`]: value.endDate
      };
      break;

    case 'multiple_contacts':
      returnValue = {
        [fieldKey]: value.reduce((arr, contact, i) => {
          arr.push(contact.id);
          return arr;
        }, [])
      };
      break;

    case 'int':
    case 'double':
      returnValue = {
        [fieldKey]: format(value, formatter)
      };
      break;

    case 'varchar_auto':
      if (isObject(value)) {
        returnValue = {
          [fieldKey]: value[fieldKey]
        };
      } else {
        returnValue = {
          [fieldKey]: value
        };
      }

      break;

    default:
      returnValue = {
        [fieldKey]: value
      };
      break;
  }

  return returnValue;
}

const Owner = props => {
  return /*#__PURE__*/React.createElement(User, {
    isOwner: true,
    ...props
  });
};

const CategorySelectRead = ({
  value
}) => {
  return /*#__PURE__*/React.createElement(React.Fragment, null, value ? value.label : '');
};

const CategoryDialog = ({
  action
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const [visible, setVisible] = useState(false);

  const openDialog = () => setVisible(true);

  const closeDialog = () => setVisible(false);

  const onConfirm = async () => {
    await action();
    closeDialog();
  };

  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {
    key: "category-delete",
    color: "ghost-alternative",
    onClick: openDialog
  }, /*#__PURE__*/React.createElement(Icon, {
    icon: "trash"
  })), /*#__PURE__*/React.createElement(Dialog, {
    title: translator.gettext('Are you sure?'),
    actions: /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {
      onClick: closeDialog
    }, " ", translator.gettext('Cancel')), /*#__PURE__*/React.createElement(Button, {
      onClick: onConfirm,
      color: "red"
    }, translator.gettext('Confirm'))),
    visible: visible,
    closeOnEsc: true,
    onClose: closeDialog
  }, translator.gettext("You're about to delete a Product category. This action cannot be undone.")));
};

var css_248z = ".ff_v531__Category__wrapper__2Wj{\n\twidth:100%;\n}\n.ff_v531__Category__editButton__21Z{\n\tdisplay:none;\n\tposition:absolute;\n\ttop:4px;\n\tright:12px;\n\tz-index:1;\n}\n.ff_v531__Category__option__3D7{\n\tdisplay:flex;\n\tjustify-content:space-between;\n}\n.ff_v531__Category__option__3D7:hover .ff_v531__Category__editButton__21Z{\n\t\t\tdisplay:flex;\n\t\t}\n.ff_v531__Category__section__eOG{\n\tdisplay:flex;\n\talign-items:center;\n\tjustify-content:space-between;\n\tflex:1;\n}\n.ff_v531__Category__saveButton__3FH{\n\tmargin-left:8px;\n}\n";
var styles = {
  "wrapper": "ff_v531__Category__wrapper__2Wj",
  "editButton": "ff_v531__Category__editButton__21Z",
  "option": "ff_v531__Category__option__3D7",
  "section": "ff_v531__Category__section__eOG",
  "saveButton": "ff_v531__Category__saveButton__3FH"
};
styleInject(css_248z);

const categoryOptions = ({
  options,
  canCreateCategories,
  filter,
  value,
  onClickEdit,
  translator
}) => {
  const isFilterTextCategoryUnique = () => {
    return !options.find(option => option.label === filter);
  };

  const isSelectedOptionNew = option => option.isNew && option.id === value;

  return /*#__PURE__*/React.createElement(React.Fragment, null, options.map(option => {
    return /*#__PURE__*/React.createElement(Select.Option, {
      className: styles.option,
      value: option.id,
      key: option.id,
      itemToString: () => option.label
    }, /*#__PURE__*/React.createElement("div", {
      className: styles.section
    }, /*#__PURE__*/React.createElement("span", null, option.label), isSelectedOptionNew(option) && /*#__PURE__*/React.createElement(Pill, {
      color: "blue",
      size: "s"
    }, translator.gettext('new'))), canCreateCategories && /*#__PURE__*/React.createElement(Button, {
      size: "s",
      onClick: e => onClickEdit(e, option),
      className: styles.editButton
    }, /*#__PURE__*/React.createElement(Icon, {
      icon: "pencil",
      size: "s"
    })));
  }), canCreateCategories && filter.length > 0 && isFilterTextCategoryUnique() && /*#__PURE__*/React.createElement(Select.Option, {
    value: 'new_category',
    itemToString: () => {
      return filter;
    }
  }, translator.gettext('+ Add "%s" as a new category', filter)));
};

const Category = ({
  onComponentChange,
  value: valueProp,
  canCreateCategories = true,
  options: optionsProp,
  onModalChange,
  fieldId
}) => {
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const [filter, setFilter] = useState('');
  const [modal, setModal] = useState(null);
  const [options, setOptions] = useState(optionsProp || []);
  const [value, setValue] = useState(valueProp);
  const focusCategoryInput = /*#__PURE__*/React.createRef();
  useEffect(() => {
    if (!optionsProp) {
      (async () => {
        const result = await getCategoryOptions(fieldId);
        setOptions(result);
      })();
    }
  }, [optionsProp]);

  const closeModal = () => setModal(null);

  const openModal = option => setModal(option);

  const onClickEdit = (event, option) => {
    event.preventDefault();
    openModal(option);
  };

  const onModalInputChange = event => {
    const option = {
      id: modal === null || modal === void 0 ? void 0 : modal.id,
      label: event.currentTarget.value
    };
    setModal(option);

    if (onModalChange) {
      onModalChange(option);
    }
  };

  const onSelect = async id => {
    if (id === 'new_category') {
      const newOptions = await updateCategory(fieldId, [...options, {
        label: filter
      }]);
      const sortedById = sortBy(newOptions, 'id');
      const newOption = sortedById[sortedById.length - 1];
      newOptions.find((option, i) => {
        if (option.id === newOption.id) {
          newOptions[i] = { ...newOptions[i],
            isNew: true
          };
          return true;
        }

        return false;
      });
      setOptions(newOptions);
      setValue(newOption.id);
      setFilter('');

      if (onComponentChange) {
        onComponentChange(newOptions[newOptions.length - 1]);
      }
    } else {
      const option = options.find(item => item.id === id);
      const newOptions = options.map(option => {
        if (option.isNew) {
          delete option.isNew;
        }

        return option;
      });
      setOptions(newOptions);
      setValue(id);

      if (onComponentChange) {
        onComponentChange(option);
      }
    }
  };

  const onCategoryLabelEdit = async () => {
    const newOptions = options.map(option => {
      if ((modal === null || modal === void 0 ? void 0 : modal.id) === option.id) {
        option.label = (modal === null || modal === void 0 ? void 0 : modal.label) || '';
      }

      return option;
    });
    await updateCategory(fieldId, options);
    setOptions(newOptions);
    closeModal();
  };

  const confirmCategoryDelete = async () => {
    const newOptions = options.filter(option => option.id !== (modal === null || modal === void 0 ? void 0 : modal.id));
    await updateCategory(fieldId, options);
    setOptions(newOptions);
    closeModal();
  };

  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Select, {
    filter: true,
    popperProps: popperProps,
    placeholder: translator.gettext('Select category'),
    onChange: onSelect,
    onFilterChange: setFilter,
    allowClear: true,
    className: styles.wrapper,
    value: value,
    resetFilterOnValueChange: true
  }, categoryOptions({
    options,
    canCreateCategories,
    onClickEdit,
    filter,
    value,
    translator
  })), /*#__PURE__*/React.createElement(Modal, {
    visible: !!modal,
    header: translator.gettext('Edit category'),
    onClose: () => {
      closeModal();
    },
    onTransitionEnd: () => {
      if (modal && focusCategoryInput.current) {
        focusCategoryInput.current.focus();
      }
    },
    footer: [/*#__PURE__*/React.createElement(CategoryDialog, {
      key: 'category-dialog',
      action: confirmCategoryDelete
    }), /*#__PURE__*/React.createElement("div", {
      key: 'category-save'
    }, /*#__PURE__*/React.createElement(Button, {
      onClick: closeModal
    }, translator.gettext('Cancel')), /*#__PURE__*/React.createElement(Button, {
      color: "green",
      onClick: onCategoryLabelEdit,
      className: styles.saveButton
    }, translator.gettext('Save changes')))]
  }, /*#__PURE__*/React.createElement(Input, {
    inputRef: focusCategoryInput,
    value: modal === null || modal === void 0 ? void 0 : modal.label,
    onChange: onModalInputChange
  })));
};

const DurationRead = ({
  value
}) => {
  return /*#__PURE__*/React.createElement(React.Fragment, null, value || '');
};

const getDurations = () => {
  const durations = [];

  for (let i = 0; i <= 23; i++) {
    const hour = String(i).padStart(2, '0');

    if (i !== 0) {
      durations.push(`${hour}:00`);
    }

    durations.push(`${hour}:15`);
    durations.push(`${hour}:30`);
    durations.push(`${hour}:45`);
  }

  return durations;
};

const Duration = ({
  value,
  placeholder = '',
  error,
  onValidation,
  ...restProps
}) => {
  const suggestions = getDurations();
  const [isOpen, setIsOpen] = useState(false);
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getDurationValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState('');

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getDurationValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  const getSuggestions = async value => {
    const result = suggestions.filter(suggestion => suggestion.includes(value));
    setIsOpen(!!result.length);
    return result.length ? result : null;
  };

  return /*#__PURE__*/React.createElement(InputSelect, {
    value: value,
    getSuggestions: getSuggestions,
    alwaysGetSuggestions: true,
    initialSuggestions: suggestions,
    placeholder: placeholder,
    downshiftProps: {
      isOpen
    },
    inputProps: {
      onClick() {
        setIsOpen(!isOpen);
      },

      onBlur(event) {
        setIsOpen(false);
        validate(event);
      },

      message: error || validationError
    },
    allowNewItem: true,
    disableNewLabel: true,
    ...restProps
  });
};

const TextAndOptionsFieldRead = ({
  value
}) => {
  return value ? /*#__PURE__*/React.createElement(React.Fragment, null, value) : null;
};

const TextAndOptionsField = ({
  value,
  autofocus = true,
  actionIcon,
  disabled,
  onComponentChange,
  inputProps,
  error,
  onValidation,
  freeform,
  options = [],
  selectProps,
  freeformOptionText,
  selectPlaceholder = ' ',
  inputPlaceholder = ' '
}) => {
  const hasOptions = (options === null || options === void 0 ? void 0 : options.length) !== 0;
  const {
    translator
  } = parseContext(useContext(FormFieldsContext));
  const {
    getValidation,
    handleValidation
  } = useValidation(translator);
  const [validationError, setValidationError] = useState();
  const [inputVisible, setInputVisible] = useState(false);
  const [optionsState, setOptionsState] = useState(options);

  const getValue = someValue => {
    return (someValue === null || someValue === void 0 ? void 0 : someValue.id) || null;
  };

  const [selected, setSelected] = useState(getValue(value));
  const freeformOption = {
    label: freeformOptionText || '...',
    id: 10000
  };
  useEffect(() => {
    setInputVisible(!hasOptions);

    if (hasOptions && freeform) {
      setOptionsState([...options, freeformOption]);
    }
  }, []);

  const onInputChange = event => {
    onComponentChange === null || onComponentChange === void 0 ? void 0 : onComponentChange(event.currentTarget.value);
  };

  const onSelectChange = selectId => {
    const selectedOption = optionsState === null || optionsState === void 0 ? void 0 : optionsState.find(option => option.id === selectId);
    setSelected(getValue(selectedOption));
    setInputVisible(selectId === freeformOption.id ? true : false);
    onComponentChange === null || onComponentChange === void 0 ? void 0 : onComponentChange(selectedOption === null || selectedOption === void 0 ? void 0 : selectedOption.label);
  };

  const validate = event => {
    const errorMessage = handleValidation({
      formValue: event,
      validate: getValidation
    });
    setValidationError(errorMessage);
    onValidation && onValidation(!errorMessage);
  };

  return /*#__PURE__*/React.createElement(React.Fragment, null, hasOptions && /*#__PURE__*/React.createElement(Select, {
    value: selected,
    onChange: onSelectChange,
    placeholder: selectPlaceholder,
    style: {
      display: 'flex'
    },
    disabled: disabled,
    ...selectProps
  }, optionsState.map((option, _index) => /*#__PURE__*/React.createElement(Select.Option, {
    key: option.id,
    value: option.id
  }, option.label))), inputVisible && /*#__PURE__*/React.createElement(Spacing, {
    top: "xs"
  }, /*#__PURE__*/React.createElement(Input, {
    autoFocus: autofocus,
    type: "text",
    onBlur: validate,
    onMouseOut: validate,
    onChange: onInputChange,
    placeholder: inputPlaceholder,
    message: error || validationError,
    color: error || validationError ? 'red' : undefined,
    ...inputProps
  })), actionIcon);
};

const WHITE_LIST = {
  id: 'varchar',
  name: 'varchar',
  phone: 'default_phone',
  email: 'email',
  add_time: 'date',
  update_time: 'date',
  org_id: 'organization',
  owner_id: 'owner',
  deal_id: 'deal',
  deal: 'deal',
  person_id: 'person',
  user_id: 'user',
  open_deals_count: 'double',
  visible_to: 'visible_to',
  due_date: 'date',
  due_time: 'time',
  duration: 'duration',
  note: 'text',
  currency: 'varchar',
  created_by_user_id: 'user',
  creator_user_id: 'user',
  next_activity_date: 'date',
  last_activity_date: 'date',
  won_deals_count: 'int',
  lost_deals_count: 'int',
  closed_deals_count: 'int',
  activities_count: 'int',
  done_activities_count: 'int',
  undone_activities_count: 'int',
  email_messages_count: 'int',
  last_incoming_mail_time: 'date',
  last_outcoming_mail_time: 'date',
  last_notification_time: 'date',
  won_time: 'date',
  close_time: 'date',
  lost_time: 'date',
  lost_reason: 'varchar_options',
  label: 'label',
  im: 'im',
  postal_address: 'address',
  postal_address_subpremise: 'varchar',
  postal_address_street_number: 'varchar',
  postal_address_route: 'varchar',
  postal_address_sublocality: 'varchar',
  postal_address_locality: 'varchar',
  postal_address_admin_area_level_1: 'varchar',
  postal_address_admin_area_level_2: 'varchar',
  postal_address_country: 'varchar',
  postal_address_formatted_address: 'varchar',
  postal_address_lat: 'varchar',
  postal_address_long: 'varchar',
  subject: 'varchar',
  type: 'enum',
  done: 'enum',
  marked_as_done_time: 'date',
  weighted_value: 'monetary',
  weighted_value_currency: 'varchar',
  value: 'monetary',
  probability: 'percentage',
  pipeline_id: 'double',
  stage_id: 'stage_id',
  status: 'status',
  stage_change_time: 'date',
  expected_close_date: 'date',
  sender: 'varchar',
  // shared: 'boolean',
  // attachments: 'boolean',
  received: 'date',
  content: 'text',
  pinned_to_deal_flag: 'enum',
  pinned_to_organization_flag: 'enum',
  pinned_to_person_flag: 'enum',
  people_count: 'double',
  code: 'varchar',
  selectable: 'enum',
  price: 'double',
  unit: 'varchar',
  tax: 'double',
  last_login: 'date',
  created: 'date',
  modified: 'date',
  default_currency: 'varchar',
  locale: 'varchar',
  timezone_name: 'varchar',
  role_id: 'int',
  picture_id: 'int',
  category: 'category',
  unit_prices: 'unit_prices',
  pipelines_and_stages: 'pipelines_and_stages'
};
const mapping = {
  varchar_auto: {
    edit: Autocomplete,
    read: AutocompleteRead
  },
  int: {
    edit: NumberComponent,
    read: NumberRead
  },
  double: {
    edit: NumberComponent,
    read: NumberRead
  },
  text: {
    edit: TextAreaComponent,
    read: TextAreaRead
  },
  varchar: {
    edit: TextField,
    read: TextFieldRead
  },
  monetary: {
    edit: MonetaryComponent,
    read: MonetaryRead
  },
  date: {
    edit: DatePicker,
    read: DatePickerRead
  },
  person: {
    edit: Person,
    read: PersonRead
  },
  multiple_contacts: {
    edit: MultipleContacts,
    read: MultipleContactsRead
  },
  organization: {
    edit: Organization,
    read: OrganizationRead
  },
  user: {
    edit: User,
    read: UserRead
  },
  owner: {
    edit: Owner,
    read: UserRead
  },
  phone: {
    edit: Phone,
    read: PhoneRead
  },
  default_phone: {
    edit: DefaultPhone,
    read: DefaultPhoneRead$1
  },
  time: {
    edit: TimePicker,
    read: TimePickerRead
  },
  timerange: {
    edit: TimeRange,
    read: TimeRangeRead
  },
  daterange: {
    edit: DateRange,
    read: DateRangeRead
  },
  address: {
    edit: Address,
    read: AddressRead
  },
  postal_address: {
    edit: Address,
    read: AddressRead
  },
  label: {
    edit: Label,
    read: LabelRead
  },
  im: {
    edit: InstantMessage,
    read: InstantMessageRead
  },
  percentage: {
    edit: PercentageComponent,
    read: PercentageRead
  },
  probability: {
    edit: PercentageComponent,
    read: PercentageRead
  },
  email: {
    edit: Email,
    read: EmailRead
  },
  set: {
    edit: MultipleOptions,
    read: MultipleOptionsRead
  },
  enum: {
    edit: SingleOption,
    read: SingleOptionRead
  },
  visible_to: {
    edit: SingleOption,
    read: SingleOptionRead
  },
  status: {
    edit: SingleOption,
    read: SingleOptionRead
  },
  stage_id: {
    edit: SingleOption,
    read: TextFieldRead
  },
  pipeline_id: {
    edit: SingleOption,
    read: TextFieldRead
  },
  pipelines_and_stages: {
    edit: PipelinesAndStages,
    read: {}
  },
  weighted_value: {
    edit: TextField,
    read: TextFieldRead
  },
  varchar_options: {
    edit: TextAndOptionsField,
    read: TextAndOptionsFieldRead
  },
  deal: {
    edit: Deal,
    read: DealRead
  },
  deal_or_lead: {
    edit: DealOrLead,
    read: DealOrLeadRead
  },
  visibility: {
    edit: VisibilitySwitch,
    read: VisibilitySwitchRead
  },
  unit_prices: {
    edit: UnitPrices,
    read: DefaultPhoneRead
  },
  category: {
    edit: Category,
    read: CategorySelectRead
  },
  duration: {
    edit: Duration,
    read: DurationRead
  }
};

const mapFieldType = (key, type) => {
  if (WHITE_LIST[key]) {
    return WHITE_LIST[key];
  }

  return type;
};

const getContacts = value => {
  if (!value) {
    return [];
  }

  if (isArray(value)) {
    return value.reduce((accumulator, current) => {
      if (current.value !== '') {
        accumulator.push(current);
      }

      return accumulator;
    }, []);
  } else {
    return {
      value: value.value,
      label: value.label,
      primary: value.primary
    };
  }
};

const getContact = (value, field) => {
  return {
    is_hidden: field.is_hidden,
    id: value,
    name: field.name
  };
};

const getEnum = (value, options) => {
  if (!Array.isArray(options)) {
    return;
  }

  const selected = options.find(option => String(option.id) === String(value));
  return selected;
};

const getMonetary = (values, key) => {
  if (isNil(values[key])) {
    return;
  }

  if (key === 'value') {
    return {
      value: values[key],
      label: values.currency
    };
  }

  return {
    value: values[key],
    label: values[`${key}_currency`]
  };
};

const getDateRange = (value, key) => {
  return {
    startDate: value[key],
    endDate: value[`${key}_until`]
  };
};

const getTimeRange = (value, key) => {
  return {
    startTime: value[key],
    endTime: value[`${key}_until`]
  };
};

const getOriginalValue = value => value; // eslint-disable-next-line complexity


const getSQLmapping = ({
  field,
  values
}) => {
  const {
    key
  } = field;
  const type = mapFieldType(key, field.field_type);

  switch (type) {
    case 'monetary':
    case 'weighted_value':
      return getMonetary(values, key);

    case 'person':
    case 'organization':
      return getContact(values[key], field);

    case 'email':
    case 'default_phone':
    case 'im':
      return getContacts(values[key]);

    case 'enum':
    case 'label':
      return getEnum(values[key], field.options);

    case 'daterange':
      return getDateRange(values, key);

    case 'timerange':
      return getTimeRange(values, key);

    default:
      /** List of fileds that mapped as just simple value return */
      // user
      // address
      // varchar_auto
      // set
      // int
      // percentage
      // customfield phone
      // text
      // varchar
      // time
      // date
      // owner_id
      return getOriginalValue(values[key]);
  }
};

const getComponent = (type, key) => {
  const Element = mapping[WHITE_LIST[key] || type];
  return {
    Component: Element.edit,
    ComponentRead: Element.read
  };
};

export { ActionFooter, AddButton, Address, AddressRead, Autocomplete, AutocompleteRead, Category, CategorySelectRead as CategoryRead, CheckboxGroup, DatePicker, DatePickerRead, DateRange, DateRangeRead, Deal, DealOrLead, DealOrLeadRead, DealRead, DefaultPhone, DefaultPhoneRead$1 as DefaultPhoneRead, Duration, DurationRead, Email, EmailRead, EntitySuggestions, FormFieldsContext, InputMultiSelect, InputSelect, InstantMessage, InstantMessageRead, Label, LabelRead, Link, MonetaryComponent as Monetary, MonetaryRead, MultipleContacts, MultipleContactsRead, MultipleOptions, MultipleOptionsRead, NumberRead, NumberComponent as Numeric, Organization, OrganizationRead, PercentageComponent as Percentage, PercentageRead, Person, PersonRead, Phone, PhoneRead, PipelinesAndStages, RadioGroup, SearchDataTypes, SidebarField, SingleOption, SingleOptionRead, TextAndOptionsField, TextAndOptionsFieldRead, TextAreaComponent as TextArea, TextAreaRead, TextField, TextFieldRead, TimePicker, TimePickerRead, TimeRange, TimeRangeRead, UnitPrices, DefaultPhoneRead as UnitPricesRead, User, UserRead, VisibilitySwitch, VisibilitySwitchRead, WithEditButton, getComponent, getFFContextData, isEmpty as getFormValueIsEmpty, getSQLmapping, mapFieldType, useDataMapping };
//# sourceMappingURL=index.esm.js.map
